import"./base-23d00206.js";import"./el-scrollbar-e3b486eb.js";import{E as le}from"./el-popover-74fee5eb.js";import{y as te,b as p,i as ae,F as re,o as r,a7 as k,bI as n,B as K,bC as M,ag as a,c as o,u as e,a8 as d,af as U,bf as _,a as R,S as h,b0 as g}from"./@vue-19632928.js";/* empty css                  */import{c as P,a as se}from"./el-main-e0dc383b.js";import{a as T}from"./el-button-ded9ecc1.js";import{E as C}from"./el-divider-67eeba91.js";import{E as ie}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{E as oe}from"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import{E as w}from"./el-image-viewer-1a9f012d.js";import{E}from"./el-alert-65b82b76.js";import{E as W,a as x}from"./el-table-column-5047dc3a.js";import{E as ne}from"./el-checkbox-d46297b7.js";import"./el-tooltip-4ed993c7.js";/* empty css               */import{E as j}from"./el-form-item-62aac1b2.js";import{E as ue}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import{E as de}from"./el-input-number-815f9c07.js";import{p as pe}from"./@element-plus-a8abf029.js";import{i as N,o as fe,w as q,e as me,f as ce}from"./index-d07dfee2.js";import{u as _e}from"./stashSpace-391fdb88.js";import{S as ve}from"./StashSelect-5af938b3.js";import{R as ke}from"./ResultImgWithStash-c075e0f0.js";import{E as he}from"./index-b8931eed.js";import{_ as ge}from"./json-editor-vue3-5344cb8d.js";const we={key:0},be={key:1},ye={key:0},Ee={key:2},xe=["src"],$e={key:0},Ie={key:0,class:"demo-image__preview"},Ve={key:1,class:"demo-image__preview"},Se={key:2,class:"demo-image__preview"},Ue={key:3,class:"demo-image__preview"},Ce={key:4,class:"demo-image__preview"},Ne=te({__name:"InferImg",props:{name:{},infer_kernel:{},threshold:{},draw_box:{type:Boolean},score_type:{}},emits:["update:threshold"],setup(z,{expose:H,emit:J}){const D=_e(),v=p(!1),m=p([]),$=p(""),B=p(!1),b=p(!1),f=p([""]),F=p([""]),L=p(""),I=p([]),A=p([""]),O=p(.1),G=p(.1),l=z,Q=J,y=ae({get:()=>l.threshold??0,set:u=>Q("update:threshold",u)}),X=()=>{b.value=!1,m.value=[]},Y=async()=>{const u=fe();console.log("files ==>",m),console.log("files value ==>",m.value);try{if(v.value&&!D.currentFolderPath)return q(N.global.t("NoFile")),!1;if(!v.value&&m.value.length===0){q(N.global.t("NoFile"));return}const s=new FormData;if(v.value)s.append("folder_path",D.currentFolderPath);else for(const i of m.value){const c=await i.raw.arrayBuffer();s.append("image",new Blob([c]),i.name)}l.threshold!==void 0&&s.append("threshold",`${y.value}`),l.infer_kernel==="ad"&&(s.append("draw_box",`${l.draw_box}`),s.append("score_type",`${l.score_type}`)),s.append("name",l.name??"");const V=await me("form","/api/infer_"+l.infer_kernel,s);if(V==null)return;const t=await V.data;if(t.code!==0){ce(`API Error: ${t.code}`);return}console.log("infer result = ",t),f.value=t.result.all_names,l.infer_kernel==="ad"&&(F.value=t.result.all_results,L.value=t.result.result_distribution),l.infer_kernel==="cls"&&(A.value=t.result.all_results),(l.infer_kernel==="od"||l.infer_kernel==="seg"||l.infer_kernel==="od_cls")&&(I.value=t.result.dict_label_num),(l.infer_kernel==="ad"||l.infer_kernel==="cls"||l.infer_kernel==="od"||l.infer_kernel==="seg"||l.infer_kernel==="pose")&&(O.value=t.result.mean_time,G.value=t.result.all_time),b.value=!0}finally{u.close()}},Z=(u,s)=>{console.log(u,s)},ee=u=>{$.value=u.url,B.value=!0};return H({closeResult:()=>{b.value=!1}}),re(()=>{$.value.startsWith("blob:")&&URL.revokeObjectURL($.value)}),(u,s)=>{const V=le;return r(),k(e(se),null,{default:n(()=>[K(a(e(P),null,{default:n(()=>[l.infer_kernel==="ad"?(r(),o("div",we,[a(e(j),{label:u.$t("Threshold")},{default:n(()=>[a(e(de),{modelValue:y.value,"onUpdate:modelValue":s[0]||(s[0]=t=>y.value=t),precision:2,step:.01},null,8,["modelValue"])]),_:1},8,["label"])])):d("",!0),l.infer_kernel==="od"||l.infer_kernel==="seg"||l.infer_kernel==="cls"||l.infer_kernel==="pose"||l.infer_kernel==="od_cls"?(r(),o("div",be,[a(e(j),{label:u.$t("Threshold")},{default:n(()=>[a(e(ue),{modelValue:y.value,"onUpdate:modelValue":s[1]||(s[1]=t=>y.value=t),min:.01,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"])])):d("",!0),a(e(T),{type:"success",onClick:s[2]||(s[2]=t=>Y())},{default:n(()=>[U(_(u.$t("Upload"))+" ",1),m.value.length>0?(r(),o("p",ye,_(m.value.length),1)):d("",!0)]),_:1}),a(e(C)),a(e(ne),{modelValue:v.value,"onUpdate:modelValue":s[3]||(s[3]=t=>v.value=t)},{default:n(()=>[U(_(u.$t("Label.UsingTemporaryStorageSpace")),1)]),_:1},8,["modelValue"]),v.value?(r(),o("div",Ee,[a(ve,{"is-on-page":"","is-upload":""})])):(r(),k(e(ie),{key:3,class:"upload-drag-img","file-list":m.value,"onUpdate:fileList":s[4]||(s[4]=t=>m.value=t),action:"/api/infer_"+l.infer_kernel,"list-type":"picture-card","auto-upload":!1,"on-preview":ee,"on-remove":Z,multiple:"",drag:""},{default:n(()=>[a(e(he),null,{default:n(()=>[a(e(pe))]),_:1})]),_:1},8,["file-list","action"])),a(e(oe),{modelValue:B.value,"onUpdate:modelValue":s[5]||(s[5]=t=>B.value=t)},{default:n(()=>[R("img",{style:{width:"100%"},src:$.value,alt:"Preview Image"},null,8,xe)]),_:1},8,["modelValue"])]),_:1},512),[[M,b.value===!1]]),K(a(e(P),null,{default:n(()=>[a(e(P),null,{default:n(()=>[a(ke,{"download-link":`/api/download_result?name=${l.name??""}`,"hide-hr":!0},{before:n(()=>[a(e(T),{type:"primary",onClick:s[6]||(s[6]=t=>X())},{default:n(()=>[U(_(u.$t("ReUpload")),1)]),_:1})]),_:1},8,["download-link"]),l.infer_kernel==="ad"||l.infer_kernel==="cls"||l.infer_kernel==="od"||l.infer_kernel==="seg"||l.infer_kernel==="pose"||l.infer_kernel==="od_cls"?(r(),o("div",$e,[s[7]||(s[7]=R("br",null,null,-1)),a(e(E),{title:e(N).global.t("AllTime")+" : "+G.value+" sec",type:"info",closable:!1},null,8,["title"]),a(e(E),{title:e(N).global.t("MeanTime")+" : "+O.value+" sec",type:"info",closable:!1},null,8,["title"])])):d("",!0)]),_:1}),l.infer_kernel==="ad"?(r(),o("div",Ie,[a(e(w),{style:{width:"300px",height:"300px"},src:L.value,"preview-src-list":[L.value],fit:"scale-down"},null,8,["src","preview-src-list"]),a(e(C)),(r(!0),o(h,null,g(f.value,(t,i)=>(r(),o("div",{key:i,class:"inline-block"},[F.value[i]==="OK"?(r(),k(e(E),{key:0,title:"OK",type:"success",closable:!1})):d("",!0),F.value[i]==="NG"?(r(),k(e(E),{key:1,title:"NG",type:"error",closable:!1})):d("",!0),a(e(w),{style:{width:"100px",height:"100px",margin:"10px"},src:t,"preview-src-list":f.value,"initial-index":i,fit:"scale-down"},null,8,["src","preview-src-list","initial-index"])]))),128))])):d("",!0),l.infer_kernel==="cls"?(r(),o("div",Ve,[(r(!0),o(h,null,g(f.value,(t,i)=>(r(),o("div",{key:i,class:"inline-block"},[a(e(E),{title:A.value[i],type:"success",closable:!1},null,8,["title"]),a(e(w),{style:{width:"100px",height:"100px",margin:"10px"},src:t,"preview-src-list":f.value,"initial-index":i,fit:"scale-down"},null,8,["src","preview-src-list","initial-index"])]))),128))])):d("",!0),l.infer_kernel==="seg"||l.infer_kernel==="od"||l.infer_kernel==="od_cls"?(r(),o("div",Se,[a(e(W),{data:I.value,border:"",stripe:"",style:{width:"100%"}},{default:n(()=>[a(e(x),{prop:"image",label:u.$t("Filename"),width:"300"},null,8,["label"]),a(e(x),{prop:"number",label:u.$t("Count"),width:"100"},null,8,["label"]),a(e(x),{prop:"details",label:`${u.$t("LabelName")} (${u.$t("Count")})`,width:"300"},{default:n(t=>{var i;return[(i=t.row.details)!=null&&i.length?(r(!0),o(h,{key:0},g(t.row.details,(c,S)=>(r(),o("div",{key:S},[R("div",null,_(c.label)+" ("+_(c.count)+")",1)]))),128)):d("",!0)]}),_:1},8,["label"])]),_:1},8,["data"]),a(e(C)),(r(!0),o(h,null,g(f.value,(t,i)=>{var c,S;return r(),o("div",{key:i,class:"inline-block"},[a(e(w),{style:{width:"100%",height:"150px"},src:t,"preview-src-list":f.value,"initial-index":i,fit:"scale-down"},null,8,["src","preview-src-list","initial-index"]),(S=(c=I.value[i])==null?void 0:c.details)!=null&&S.length?(r(),k(V,{key:0,width:200},{reference:n(()=>[a(e(T),{link:""},{default:n(()=>[U(_(u.$t("Label.Label")),1)]),_:1})]),default:n(()=>[a(e(W),{data:I.value[i].details,"empty-text":"no label"},{default:n(()=>[a(e(x),{prop:"label"}),a(e(x),{prop:"count"})]),_:2},1032,["data"])]),_:2},1024)):d("",!0)])}),128))])):d("",!0),l.infer_kernel==="pose"?(r(),o("div",Ue,[a(e(C)),(r(!0),o(h,null,g(f.value,(t,i)=>(r(),o("div",{key:i,class:"inline-block"},[a(e(w),{style:{width:"100px",height:"100px",margin:"10px"},src:t,"preview-src-list":f.value,"initial-index":i,fit:"scale-down"},null,8,["src","preview-src-list","initial-index"])]))),128))])):d("",!0),l.infer_kernel==="none"?(r(),o("div",Ce,[(r(!0),o(h,null,g(f.value,(t,i)=>(r(),k(e(w),{key:i,style:{width:"100px",height:"100px",margin:"10px"},src:t,"preview-src-list":f.value,"initial-index":i,fit:"scale-down"},null,8,["src","preview-src-list","initial-index"]))),128))])):d("",!0)]),_:1},512),[[M,b.value===!0]])]),_:1})}}});const nl=ge(Ne,[["__scopeId","data-v-78276122"]]);export{nl as I};
