import{b as D}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as y}from"./el-button-ded9ecc1.js";import{E as k,a as J}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as K,a as X}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as Y}from"./el-divider-67eeba91.js";import{E as O,a as Z}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as I}from"./el-main-e0dc383b.js";import{E as x}from"./el-alert-65b82b76.js";/* empty css                */import"./el-input-51d05b2a.js";import{E as L}from"./el-input-number-815f9c07.js";import{f as g,u as ee,i as M,o as oe}from"./index-d07dfee2.js";import{b as te}from"./earthApi-baaacd65.js";import{u as ae,_ as P}from"./app_aoi_od-9abe0b5f.js";import{_ as le}from"./OdFilterSize.vue_vue_type_script_setup_true_lang-f38ed8d3.js";import{_ as z,a as re}from"./lodash-3dc9162a.js";import{a as ie}from"./label-61e62ece.js";import{I as ne}from"./InferImg-e3b2bb14.js";import{y as me,h as se,b as c,p as S,c as U,a as C,bf as b,ag as i,u as t,bI as n,a7 as h,a8 as B,S as q,o as _,b0 as de,af as $}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./typescript-defaf979.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./ImgDetectionPartition-4a04bf44.js";import"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import"./@element-plus-a8abf029.js";import"./app_camera-ba436274.js";import"./KonvaPaint-e9087f28.js";import"./vue-drag-resize-6bf710ae.js";import"./json-editor-vue3-5344cb8d.js";import"./jsoneditor-5f1e2c9e.js";import"./el-image-viewer-1a9f012d.js";import"./el-switch-30a59a69.js";import"./validator-7d68535e.js";import"./decimal.js-d133ee8e.js";import"./el-popover-74fee5eb.js";import"./dropdown-c44bb395.js";import"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import"./use-dialog-b8544ca4.js";import"./refs-e3a131a0.js";import"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import"./normalize-wheel-es-ed76fb12.js";import"./el-tooltip-4ed993c7.js";import"./el-slider-07e60acd.js";import"./stashSpace-391fdb88.js";import"./StashSelect-5af938b3.js";import"./ResultImgWithStash-c075e0f0.js";import"./el-card-a6aa41d5.js";const pe={class:"step-page"},fe={class:"step-nav"},Mo=me({__name:"AppObjectDetectionAOI",setup(ue){se(async()=>{var e,a,p,v,u;console.log("OD AOI"),await H();let o=await m.checkInfo();if(o!==0){g(`check od aoi info fail : ${o}`);return}if(m.info.load){if(r.crop_m=m.info.crop_m??-1,r.crop_n=m.info.crop_n??-1,m.info.model_name){for(;!s.value;)await new Promise(W=>setTimeout(W,1e3));m.info.model_name&&(await((e=s.value)==null?void 0:e.onChangeModelName(m.info.model_name,!1)),r.model_name=m.info.model_name)}l.cls_w_h=z(m.info.cls_w_h),l.alert_area=z(m.info.alert_area),(a=s.value)==null||a.handlePartLabel(),l.alert_area&&((p=l.alert_area)==null?void 0:p.length)>0&&(l.isSizeFilter=!0,l.draw_alert_area=m.info.draw_alert_area,((v=l.alert_area)==null?void 0:v.length)>=2&&(l.isPartitionFilter=!0),((u=l.alert_area)==null?void 0:u.length)===1&&re(l.alert_area[0],ie).length>0&&(l.isPartitionFilter=!0)),f.value=1,d.value=!0}else d.value=!1,r.model_name===""&&(r.model_name=w.value[0])});const F=ee(),m=ae(),V=c(),f=c(1),d=c(!1),w=c([""]),s=c(),r=S({model_name:"",crop_m:1,crop_n:1}),l=S({cls_w_h:void 0,alert_area:void 0,draw_alert_area:!1}),R=S({model_name:[{required:!0,message:M.global.t("NoModelName"),trigger:"blur"}]}),H=async()=>{const o=await te.api.listdirsApiListdirsPost({model:"OD"});if(o===void 0||o.data.code===void 0){g("list od weights fail");return}const e=o.data;if(console.log("result =>",e),e.code!==0){g(`list od weights fail: ${e.code}`);return}w.value=e.result.folder_list},T=async o=>{var e,a,p;if(((e=l.cls_w_h)==null?void 0:e.length)!==((a=l.alert_area)==null?void 0:a.length)){g(M.global.t("Hint.SetAllPartitionLabels")),(p=s==null?void 0:s.value)==null||p.openImgDetectionPartition();return}o&&await o.validate(async(v,u)=>{v?(console.log("submit!"),console.log(r),await N(!0)):console.log("error submit!",u)})},N=async o=>{const e=oe();try{const a=l.isSizeFilter?l.cls_w_h:void 0,p=l.isSizeFilter?l.alert_area:void 0,v=l.isSizeFilter?l.draw_alert_area:void 0,u=await m.init({model_name:r.model_name,crop_m:r.crop_m,crop_n:r.crop_n,cls_w_h:a,alert_area:p,isFinal:o,draw_alert_area:v});if(u!==0){g(`od poc model init fail : ${u}`);return}f.value=1,o&&(d.value=!0)}finally{e.close()}},j=()=>{var o;l.cls_w_h=void 0,l.alert_area=void 0,l.isPartitionFilter=!1,l.isSizeFilter=!1,r.crop_m=1,r.crop_n=1,d.value=!1,(o=s==null?void 0:s.value)==null||o.onChangeModelName(r.model_name)},G=()=>{d.value=!1},A=c(.7),E=c(),Q=()=>{d.value&&(f.value=2,E.value&&E.value.closeResult())};return(o,e)=>(_(),U(q,null,[C("h4",null,b(o.$t("Dashboard.AOI_OD")),1),i(t(Y)),C("div",pe,[C("div",fe,[i(t(Z),{active:f.value,"finish-status":"success",class:"w3-margin-bottom",direction:t(F).lt.md?"horizontal":"vertical"},{default:n(()=>[i(t(O),{title:o.$t("ModelSet"),class:"pointer",onClick:e[0]||(e[0]=a=>f.value=1)},{icon:n(()=>[i(D,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),i(t(O),{title:o.$t("Inference"),onClick:Q,class:"pointer"},{icon:n(()=>[i(D,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),f.value===1?(_(),h(t(I),{key:0},{default:n(()=>[!t(m).info.load&&w.value.length===0?(_(),h(t(I),{key:0,style:{height:"10vh"}},{default:n(()=>[i(t(x),{title:o.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(_(),h(t(I),{key:1,style:{flex:"1 1 100%"}},{default:n(()=>[i(t(J),{ref_key:"ruleFormRef",ref:V,model:r,rules:R,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:n(()=>[i(t(k),{label:o.$t("ModelName")},{default:n(()=>[i(t(K),{modelValue:r.model_name,"onUpdate:modelValue":e[1]||(e[1]=a=>r.model_name=a),onChange:e[2]||(e[2]=()=>{var a;d.value=!1,(a=s.value)==null||a.onChangeModelName(r.model_name)})},{default:n(()=>[(_(!0),U(q,null,de(w.value,(a,p)=>(_(),h(t(X),{label:a,value:a,key:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(t(k),{label:o.$t("Label.CropH")},{default:n(()=>[i(t(L),{modelValue:r.crop_m,"onUpdate:modelValue":e[3]||(e[3]=a=>r.crop_m=a),min:1,step:1},null,8,["modelValue"])]),_:1},8,["label"]),i(t(k),{label:o.$t("Label.CropV")},{default:n(()=>[i(t(L),{modelValue:r.crop_n,"onUpdate:modelValue":e[4]||(e[4]=a=>r.crop_n=a),min:1,step:1},null,8,["modelValue"])]),_:1},8,["label"]),i(le,{formInfer:l,"onUpdate:formInfer":e[5]||(e[5]=a=>l=a),ref_key:"odFilterSizeRef",ref:s,initOD:N,model_name:r.model_name,name:t(P),height:t(F).lt.md?"20vh":"25vh","show-draw-alert-area":""},null,8,["formInfer","model_name","name","height"]),i(t(k),null,{default:n(()=>[i(t(y),{type:"primary",disabled:d.value,onClick:e[6]||(e[6]=a=>T(V.value))},{default:n(()=>[$(b(o.$t("ModelSet")),1)]),_:1},8,["disabled"]),i(t(y),{type:"danger",class:"q-ml-md",onClick:G},{default:n(()=>[$(b(o.$t("UnLock")),1)]),_:1}),i(t(y),{link:"",class:"q-ml-md",onClick:j},{default:n(()=>[$(b(o.$t("Reset")),1)]),_:1}),i(t(y),{type:"primary",class:"q-mr-md",onClick:e[7]||(e[7]=a=>f.value=2),disabled:!d.value},{default:n(()=>[$(b(o.$t("Inference")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),_:1})):B("",!0),f.value===2?(_(),h(t(I),{key:1},{default:n(()=>[i(ne,{threshold:A.value,"onUpdate:threshold":e[8]||(e[8]=a=>A.value=a),ref_key:"InferImgRef",ref:E,infer_kernel:"od",name:t(P)},null,8,["threshold","name"])]),_:1})):B("",!0)])],64))}});export{Mo as default};
