import"./base-23d00206.js";import{E as L}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{E as z}from"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import{E as C,a as A}from"./el-steps-c8cdef54.js";import{E as V}from"./el-divider-67eeba91.js";import{a as w}from"./el-button-ded9ecc1.js";import{c as M}from"./el-main-e0dc383b.js";import{E as T}from"./el-image-viewer-1a9f012d.js";/* empty css                */import{a as G,E as U}from"./el-form-item-62aac1b2.js";import{E as I}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import"./el-input-number-815f9c07.js";import"./el-tooltip-4ed993c7.js";import"./el-scrollbar-e3b486eb.js";import{E as W}from"./el-checkbox-d46297b7.js";import{d as X,g as Y,o as j,p as q}from"./@element-plus-a8abf029.js";import{u as H,o as P,f as y}from"./index-d07dfee2.js";import{u as J}from"./uploadFile-6ce60004.js";import{u as K}from"./stashSpace-391fdb88.js";import{S as O}from"./StashSelect-5af938b3.js";import{R as Q}from"./ResultImgWithStash-c075e0f0.js";import{E as Z}from"./index-b8931eed.js";import{y as ee,h as te,b as s,c as _,a as n,bf as u,ag as l,u as t,bI as r,S as le,o as c,af as k,a8 as S,aN as oe,a7 as ae}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./error-78e43d3e.js";import"./typescript-defaf979.js";import"./index-711061c4.js";import"./@vueuse-0d360189.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./use-dialog-b8544ca4.js";import"./event-9519ab40.js";import"./refs-e3a131a0.js";import"./vnode-18f2a975.js";import"./@ctrl-f8748455.js";import"./async-validator-dee29e8b.js";import"./index-6127babd.js";import"./index-32075738.js";import"./quasar-ff3737c6.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";/* empty css               */import"./el-select-99a9cb58.js";import"./validator-7d68535e.js";import"./json-editor-vue3-5344cb8d.js";import"./jsoneditor-5f1e2c9e.js";import"./el-alert-65b82b76.js";import"./el-card-a6aa41d5.js";const re={class:"step-page"},ie={class:"step-nav"},se={key:0},ne={class:"el-upload__tip"},pe={class:"el-upload__tip text-red"},ue=["src"],me={key:1},de={style:{display:"flex","flex-direction":"column"}},ce={key:0},ve={class:"el-upload__tip"},fe={key:2},ht=ee({__name:"PercentageCropView",setup(ge){const N=H(),R=K();te(()=>{console.log("PercentageCrop")});const i=s(1),E=J(),b=s(""),$=s(!1),v=s([]),p=s([]),f=s([]),m=s([.3,.8]),d=s([.3,.8]),g=s(!1),F=(o,e)=>{console.log(o,e)},B=o=>{b.value=o.url,$.value=!0},x=async()=>{await h()&&i.value++},h=async()=>{const o=P();try{await E.upload("/api/percentage_crop",[v.value[0]],{top_percentage:d.value[0],bottom_percentage:1-d.value[1],left_percentage:m.value[0],right_percentage:1-m.value[1]});const e=E.uploadResult;if(!e)return;if(e.code!==0){y(`API Error: ${e.code}`);return}return p.value=e.result.all_names,!0}catch(e){y(`${e}`)}finally{o.close()}},D=async()=>{const o=P();try{const e={top_percentage:d.value[0],bottom_percentage:1-d.value[1],left_percentage:m.value[0],right_percentage:1-m.value[1]};g.value&&(e.folder_path=R.currentFolderPath),await E.upload("/api/percentage_crop",v.value,e);const a=E.uploadResult;if(!a)return;if(a.code!==0){y(`API Error: ${a.code}`);return}f.value=a.result.all_names,i.value++}catch(e){y(`${e}`)}finally{o.close()}};return(o,e)=>(c(),_(le,null,[n("h4",null,u(o.$t("PercentageCrop")),1),l(t(V)),n("div",re,[n("div",ie,[l(t(A),{active:i.value,"finish-status":"success",class:"w3-margin-bottom",direction:t(N).lt.md?"horizontal":"vertical"},{default:r(()=>[l(t(C),{title:o.$t("Upload"),icon:t(X),onClick:e[0]||(e[0]=a=>(i.value=1,v.value=[],p.value=[],f.value=[])),class:"pointer"},null,8,["title","icon"]),l(t(C),{title:o.$t("Setting"),icon:t(Y),onClick:e[1]||(e[1]=a=>i.value=p.value.length>0?2:1),class:"pointer"},null,8,["title","icon"]),l(t(C),{title:o.$t("Generate"),icon:t(j),onClick:e[2]||(e[2]=a=>i.value=f.value.length>0?3:2),class:"pointer"},null,8,["title","icon"])]),_:1},8,["active","direction"])]),l(t(M),null,{default:r(()=>[i.value===1?(c(),_("div",se,[l(t(w),{type:"success",onClick:e[3]||(e[3]=a=>x())},{default:r(()=>[k(u(o.$t("Upload")),1)]),_:1}),l(t(V)),l(t(L),{class:"upload-drag-img","file-list":v.value,"onUpdate:fileList":e[4]||(e[4]=a=>v.value=a),action:"/api/percentage_crop","list-type":"picture-card","auto-upload":!1,"on-preview":B,"on-remove":F,multiple:"",drag:""},{tip:r(()=>[n("div",ne,u(o.$t("UploadImg")),1),n("div",pe,u(o.$t("StashSpaceUploadImageConfigureFirst")),1)]),default:r(()=>[l(t(Z),null,{default:r(()=>[l(t(q))]),_:1})]),_:1},8,["file-list"]),l(t(z),{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=a=>$.value=a)},{default:r(()=>[n("img",{"w-full":"",src:b.value,alt:"Preview Image"},null,8,ue)]),_:1},8,["modelValue"])])):S("",!0),i.value===2&&p.value.length!==0?(c(),_("div",me,[l(t(W),{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value=a)},{default:r(()=>[k(u(o.$t("Label.UsingTemporaryStorageSpace")),1)]),_:1},8,["modelValue"]),n("div",de,[g.value?(c(),_("div",ce,[l(O,{"is-on-page":"","is-upload":""}),n("span",ve,u(o.$t("UploadImg")),1)])):S("",!0),l(t(w),{class:oe({"ml-3":g.value}),type:"success",onClick:e[7]||(e[7]=a=>D())},{default:r(()=>[k(u(o.$t("Setting")),1)]),_:1},8,["class"])]),l(t(V)),l(t(G),{"label-width":"170px","label-position":"left"},{default:r(()=>[l(t(U),{label:o.$t("PercentageCropRangeX")},{default:r(()=>[l(t(I),{modelValue:m.value,"onUpdate:modelValue":e[8]||(e[8]=a=>m.value=a),range:"",min:0,max:1,step:.001,onChange:e[9]||(e[9]=a=>h())},null,8,["modelValue"])]),_:1},8,["label"]),l(t(U),{label:o.$t("PercentageCropRangeY")},{default:r(()=>[l(t(I),{modelValue:d.value,"onUpdate:modelValue":e[10]||(e[10]=a=>d.value=a),range:"",min:0,max:1,step:.001,onChange:e[11]||(e[11]=a=>h())},null,8,["modelValue"])]),_:1},8,["label"])]),_:1}),p.value.length!==0?(c(),ae(t(T),{key:0,style:{margin:"10px"},src:p.value[0],"preview-src-list":p.value,fit:"scale-down"},null,8,["src","preview-src-list"])):S("",!0)])):S("",!0),i.value===3&&f.value.length!==0?(c(),_("div",fe,[l(Q,{all_names:f.value},null,8,["all_names"])])):S("",!0)]),_:1})])],64))}});export{ht as default};
