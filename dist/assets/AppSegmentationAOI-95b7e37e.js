import{b as L}from"./quasar-ff3737c6.js";import{y as K,h as X,b as _,p as F,c as b,a as C,bf as g,ag as i,u as l,bI as n,a7 as $,a8 as M,S as D,o as c,B as Y,bC as Z,b0 as x,af as w}from"./@vue-19632928.js";import"./base-23d00206.js";import{a as y}from"./el-button-ded9ecc1.js";/* empty css                */import{E as S,a as ee}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as te,a as oe}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as B,a as ae}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as R}from"./el-main-e0dc383b.js";import{E as le}from"./el-alert-65b82b76.js";import{E as re}from"./el-divider-67eeba91.js";import"./el-input-51d05b2a.js";import{E as U}from"./el-input-number-815f9c07.js";import{f as I,u as ie,i as G,e as ne,o as O}from"./index-d07dfee2.js";import{u as se,_ as q}from"./app_aoi_seg-13fc56b9.js";import{a as me}from"./label-61e62ece.js";import{_ as pe}from"./SEGFilterSize.vue_vue_type_script_setup_true_lang-b9b2921a.js";import{_ as H,a as de}from"./lodash-3dc9162a.js";import{I as fe}from"./InferImg-e3b2bb14.js";import{_ as ue}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./typescript-defaf979.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./decimal.js-d133ee8e.js";import"./ImgDetectionPartition-4a04bf44.js";import"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import"./@element-plus-a8abf029.js";import"./app_camera-ba436274.js";import"./KonvaPaint-e9087f28.js";import"./vue-drag-resize-6bf710ae.js";import"./el-image-viewer-1a9f012d.js";import"./el-switch-30a59a69.js";import"./validator-7d68535e.js";import"./el-popover-74fee5eb.js";import"./dropdown-c44bb395.js";import"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import"./use-dialog-b8544ca4.js";import"./refs-e3a131a0.js";import"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import"./normalize-wheel-es-ed76fb12.js";import"./el-tooltip-4ed993c7.js";import"./el-slider-07e60acd.js";import"./stashSpace-391fdb88.js";import"./StashSelect-5af938b3.js";import"./ResultImgWithStash-c075e0f0.js";import"./el-card-a6aa41d5.js";import"./jsoneditor-5f1e2c9e.js";const _e={class:"step-page"},ce={class:"step-nav"},ve={key:0,style:{height:"10vh"}},ge={key:1,style:{flex:"1 1 100%",width:"100%"}},he=K({__name:"AppSegmentationAOI",setup(be){X(async()=>{var e,a,d,v,u;console.log("SEG Infer"),await j();let o=await s.checkInfo();if(o!==0){I(`check od aoi info fail : ${o}`);return}if(s.info.load){if(r.crop_m=s.info.crop_m??-1,r.crop_n=s.info.crop_n??-1,s.info.model_name){for(;!p.value;)await new Promise(E=>setTimeout(E,1e3));s.info.model_name&&(await((e=p.value)==null?void 0:e.onChangeModelName(s.info.model_name,!1)),r.model_name=s.info.model_name)}t.cls_w_h_a=H(s.info.cls_w_h_a),t.alert_area=H(s.info.alert_area),(a=p.value)==null||a.handlePartLabel(),t.filter_type=s.info.filter_type,t.alert_area&&((d=t.alert_area)==null?void 0:d.length)>0&&(t.isSizeFilter=!0,t.draw_alert_area=s.info.draw_alert_area,((v=t.alert_area)==null?void 0:v.length)>=2&&(t.isPartitionFilter=!0),((u=t.alert_area)==null?void 0:u.length)===1&&de(t.alert_area[0],me).length>0&&(t.isPartitionFilter=!0)),f.value=1,m.value=!0}else m.value=!1,r.model_name===""&&(r.model_name=h.value[0])});const A=ie(),s=se(),m=_(!1),V=_(),f=_(1),h=_([""]),p=_(),r=F({model_name:"",crop_m:1,crop_n:1}),t=F({model_name:"",cls_w_h_a:void 0,alert_area:void 0,filter_type:"w_h",isPartitionFilter:!1,isSizeFilter:!1,draw_alert_area:!1}),T=F({model_name:[{required:!0,message:G.global.t("NoModelName"),trigger:"blur"}]}),j=async()=>{const o=await ne("json","/api/listdirs",{model:"SEG"});if(o==null)return;const e=await o.data;if(console.log("result =>",e),e.code!==0){I(`API Error: ${e.code}`);return}h.value=e.result.folder_list},Q=async o=>{var e,a,d;if(((e=t.cls_w_h_a)==null?void 0:e.length)!==((a=t.alert_area)==null?void 0:a.length)){I(G.global.t("Hint.SetAllPartitionLabels")),(d=p.value)==null||d.openImgDetectionPartition();return}o&&await o.validate(async(v,u)=>{if(v){console.log("submit!"),console.log(r);const E=O();await N(!0),E.close()}else console.log("error submit!",u)})},N=async o=>{const e=O(),a=t.isSizeFilter?t.cls_w_h_a:void 0,d=t.isSizeFilter?t.alert_area:void 0,v=t.isSizeFilter?t.draw_alert_area:!1;try{const u=await s.init({model_name:r.model_name,cls_w_h_a:a,alert_area:d,filter_type:t.filter_type,crop_m:r.crop_m,crop_n:r.crop_n,isFinal:o,draw_alert_area:v});if(u!==0){I(`od poc model init fail : ${u}`);return}f.value=1,o&&(m.value=!0)}finally{e.close()}},W=()=>{var o;t.cls_w_h_a=void 0,t.alert_area=void 0,t.filter_type="w_h",t.isPartitionFilter=!1,t.isSizeFilter=!1,r.crop_m=1,r.crop_n=1,m.value=!1,(o=p==null?void 0:p.value)==null||o.onChangeModelName(r.model_name)},J=()=>{m.value=!1},z=_(.7),k=_(),P=()=>{console.log("toActive2",m.value),m.value&&(f.value=2,k.value&&k.value.closeResult())};return(o,e)=>(c(),b(D,null,[C("h4",null,g(o.$t("Dashboard.AOI_SEG")),1),i(l(re)),C("div",_e,[C("div",ce,[i(l(ae),{active:f.value,"finish-status":"success",class:"w3-margin-bottom",direction:l(A).lt.md?"horizontal":"vertical"},{default:n(()=>[i(l(B),{title:o.$t("ModelSet"),onClick:e[0]||(e[0]=a=>f.value=1),class:"pointer"},{icon:n(()=>[i(L,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),i(l(B),{title:o.$t("Inference"),onClick:P,class:"pointer"},{icon:n(()=>[i(L,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),f.value===1?(c(),$(l(R),{key:0,style:{height:"70vh",width:"100%",overflow:"auto","padding-bottom":"20px"},class:"scroll-bar"},{default:n(()=>[h.value.length===0?(c(),b("div",ve,[i(l(le),{title:o.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])])):(c(),b("div",ge,[Y(i(l(ee),{ref_key:"ruleFormRef",ref:V,model:r,rules:T,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:n(()=>[i(l(S),{label:o.$t("ModelName"),"label-width":"auto"},{default:n(()=>[i(l(te),{modelValue:r.model_name,"onUpdate:modelValue":e[1]||(e[1]=a=>r.model_name=a),onChange:e[2]||(e[2]=()=>{var a;m.value=!1,(a=p.value)==null||a.onChangeModelName(r.model_name)})},{default:n(()=>[(c(!0),b(D,null,x(h.value,(a,d)=>(c(),$(l(oe),{label:a,value:a,key:d},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(l(S),{label:o.$t("Label.CropH")},{default:n(()=>[i(l(U),{modelValue:r.crop_m,"onUpdate:modelValue":e[3]||(e[3]=a=>r.crop_m=a),min:1,step:1},null,8,["modelValue"])]),_:1},8,["label"]),i(l(S),{label:o.$t("Label.CropV")},{default:n(()=>[i(l(U),{modelValue:r.crop_n,"onUpdate:modelValue":e[4]||(e[4]=a=>r.crop_n=a),min:1,step:1},null,8,["modelValue"])]),_:1},8,["label"]),i(pe,{formInfer:t,"onUpdate:formInfer":e[5]||(e[5]=a=>t=a),ref_key:"segFilterSizeRef",ref:p,initSEG:N,model_name:r.model_name,name:l(q),height:l(A).lt.md?"20vh":"25vh","show-draw-alert-area":""},null,8,["formInfer","model_name","name","height"]),i(l(S),{style:{width:"100%"}},{default:n(()=>[i(l(y),{type:"primary",onClick:e[6]||(e[6]=a=>Q(V.value)),disabled:m.value},{default:n(()=>[w(g(o.$t("ModelSet")),1)]),_:1},8,["disabled"]),i(l(y),{type:"danger",class:"q-ml-md",onClick:J},{default:n(()=>[w(g(o.$t("UnLock")),1)]),_:1}),i(l(y),{link:"",class:"q-ml-md",onClick:W},{default:n(()=>[w(g(o.$t("Reset")),1)]),_:1}),i(l(y),{type:"primary",class:"q-mr-md",onClick:P,disabled:!m.value},{default:n(()=>[w(g(o.$t("Inference")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"]),[[Z,f.value===1]])]))]),_:1})):M("",!0),f.value===2?(c(),$(l(R),{key:1},{default:n(()=>[i(fe,{threshold:z.value,"onUpdate:threshold":e[7]||(e[7]=a=>z.value=a),ref_key:"InferImgRef",ref:k,infer_kernel:"seg",name:l(q)},null,8,["threshold","name"])]),_:1})):M("",!0)])],64))}});const Gt=ue(he,[["__scopeId","data-v-35186461"]]);export{Gt as default};
