import{d as st,v as Ma,P as zt,b as se,y as It,x as Na,r as Rt,m as Ea,p as Ta,A as Sa,o as Pa}from"./quasar-ff3737c6.js";import{f as Ge,s as Ft,i as V,b as E,h as Fe,d as ee,y as de,o as S,c as z,a as $,aN as M,u as c,aP as be,bR as ze,bP as Bt,l as Da,w as xa,S as pe,b0 as De,p as oa,n as xe,aW as za,a7 as je,bI as F,B as rt,bK as ht,ag as _,a8 as q,af as Ht,bf as J,aM as Ia,bC as Kt,F as Vt,b2 as qe,b1 as Ot,bM as Xt}from"./@vue-19632928.js";import{b as la,d as na,u as Be,_ as He,w as Ra}from"./base-23d00206.js";import{E as Fa}from"./el-input-51d05b2a.js";import{a as Yt}from"./el-button-ded9ecc1.js";import{b as Ba,C as Ha,a as Ka,E as Wt}from"./el-scrollbar-e3b486eb.js";import{K as X}from"./konva-364a8bb7.js";import{V as Ut}from"./vue-drag-resize-6bf710ae.js";import{f as Va}from"./@quasar-a9c09e53.js";import{u as Oa,c as Xa,i as qt,d as G,b as Ya,s as Wa,m as Ua}from"./label-61e62ece.js";import{i as qa,u as ja,w as it}from"./index-d07dfee2.js";import{_ as jt}from"./lodash-3dc9162a.js";import{u as sa,a as Zt,E as Qt,d as Za,c as Qa}from"./index-b8931eed.js";import{i as Ga}from"./@vueuse-0d360189.js";import{g as vt}from"./el-image-viewer-1a9f012d.js";import{c as ue}from"./earthApi-baaacd65.js";import{c as Ja,d as eo,g as to,h as ao,e as oo}from"./index-711061c4.js";import{u as lo}from"./index-6127babd.js";import{U as Ze,C as no}from"./event-9519ab40.js";import{i as ct,d as so}from"./lodash-es-cc4652a2.js";import{u as ro}from"./index-32075738.js";import{d as Gt}from"./error-78e43d3e.js";import{_ as io}from"./json-editor-vue3-5344cb8d.js";const co=la({color:{type:na(Object),required:!0},vertical:{type:Boolean,default:!1}});let ut=!1;function Re(l,o){if(!Ga)return;const n=function(r){var f;(f=o.drag)==null||f.call(o,r)},a=function(r){var f;document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",a),document.removeEventListener("touchmove",n),document.removeEventListener("touchend",a),document.onselectstart=null,document.ondragstart=null,ut=!1,(f=o.end)==null||f.call(o,r)},u=function(r){var f;ut||(r.preventDefault(),document.onselectstart=()=>!1,document.ondragstart=()=>!1,document.addEventListener("mousemove",n),document.addEventListener("mouseup",a),document.addEventListener("touchmove",n),document.addEventListener("touchend",a),ut=!0,(f=o.start)==null||f.call(o,r))};l.addEventListener("mousedown",u),l.addEventListener("touchstart",u,{passive:!1})}const uo=l=>{const o=Ge(),{t:n}=sa(),a=Ft(),u=Ft(),r=V(()=>l.color.get("alpha")),f=V(()=>n("el.colorpicker.alphaLabel"));function k(b){var P;b.target!==a.value&&L(b),(P=a.value)==null||P.focus()}function L(b){if(!u.value||!a.value)return;const w=o.vnode.el.getBoundingClientRect(),{clientX:T,clientY:D}=vt(b);if(l.vertical){let R=D-w.top;R=Math.max(a.value.offsetHeight/2,R),R=Math.min(R,w.height-a.value.offsetHeight/2),l.color.set("alpha",Math.round((R-a.value.offsetHeight/2)/(w.height-a.value.offsetHeight)*100))}else{let R=T-w.left;R=Math.max(a.value.offsetWidth/2,R),R=Math.min(R,w.width-a.value.offsetWidth/2),l.color.set("alpha",Math.round((R-a.value.offsetWidth/2)/(w.width-a.value.offsetWidth)*100))}}function N(b){const{code:P,shiftKey:w}=b,T=w?10:1;switch(P){case ue.left:case ue.down:b.preventDefault(),b.stopPropagation(),B(-T);break;case ue.right:case ue.up:b.preventDefault(),b.stopPropagation(),B(T);break}}function B(b){let P=r.value+b;P=P<0?0:P>100?100:P,l.color.set("alpha",P)}return{thumb:a,bar:u,alpha:r,alphaLabel:f,handleDrag:L,handleClick:k,handleKeydown:N}},fo=(l,{bar:o,thumb:n,handleDrag:a})=>{const u=Ge(),r=Be("color-alpha-slider"),f=E(0),k=E(0),L=E();function N(){if(!n.value||l.vertical)return 0;const H=u.vnode.el,y=l.color.get("alpha");return H?Math.round(y*(H.offsetWidth-n.value.offsetWidth/2)/100):0}function B(){if(!n.value)return 0;const H=u.vnode.el;if(!l.vertical)return 0;const y=l.color.get("alpha");return H?Math.round(y*(H.offsetHeight-n.value.offsetHeight/2)/100):0}function b(){if(l.color&&l.color.value){const{r:H,g:y,b:x}=l.color.toRgb();return`linear-gradient(to right, rgba(${H}, ${y}, ${x}, 0) 0%, rgba(${H}, ${y}, ${x}, 1) 100%)`}return""}function P(){f.value=N(),k.value=B(),L.value=b()}Fe(()=>{if(!o.value||!n.value)return;const H={drag:y=>{a(y)},end:y=>{a(y)}};Re(o.value,H),Re(n.value,H),P()}),ee(()=>l.color.get("alpha"),()=>P()),ee(()=>l.color.value,()=>P());const w=V(()=>[r.b(),r.is("vertical",l.vertical)]),T=V(()=>r.e("bar")),D=V(()=>r.e("thumb")),R=V(()=>({background:L.value})),te=V(()=>({left:Zt(f.value),top:Zt(k.value)}));return{rootKls:w,barKls:T,barStyle:R,thumbKls:D,thumbStyle:te,update:P}},ho="ElColorAlphaSlider",vo=de({name:ho}),mo=de({...vo,props:co,setup(l,{expose:o}){const n=l,{alpha:a,alphaLabel:u,bar:r,thumb:f,handleDrag:k,handleClick:L,handleKeydown:N}=uo(n),{rootKls:B,barKls:b,barStyle:P,thumbKls:w,thumbStyle:T,update:D}=fo(n,{bar:r,thumb:f,handleDrag:k});return o({update:D,bar:r,thumb:f}),(R,te)=>(S(),z("div",{class:M(c(B))},[$("div",{ref_key:"bar",ref:r,class:M(c(b)),style:be(c(P)),onClick:c(L)},null,14,["onClick"]),$("div",{ref_key:"thumb",ref:f,class:M(c(w)),style:be(c(T)),"aria-label":c(u),"aria-valuenow":c(a),"aria-orientation":R.vertical?"vertical":"horizontal","aria-valuemin":"0","aria-valuemax":"100",role:"slider",tabindex:"0",onKeydown:c(N)},null,46,["aria-label","aria-valuenow","aria-orientation","onKeydown"])],2))}});var go=He(mo,[["__file","alpha-slider.vue"]]);const po=de({name:"ElColorHueSlider",props:{color:{type:Object,required:!0},vertical:Boolean},setup(l){const o=Be("color-hue-slider"),n=Ge(),a=E(),u=E(),r=E(0),f=E(0),k=V(()=>l.color.get("hue"));ee(()=>k.value,()=>{P()});function L(w){w.target!==a.value&&N(w)}function N(w){if(!u.value||!a.value)return;const D=n.vnode.el.getBoundingClientRect(),{clientX:R,clientY:te}=vt(w);let H;if(l.vertical){let y=te-D.top;y=Math.min(y,D.height-a.value.offsetHeight/2),y=Math.max(a.value.offsetHeight/2,y),H=Math.round((y-a.value.offsetHeight/2)/(D.height-a.value.offsetHeight)*360)}else{let y=R-D.left;y=Math.min(y,D.width-a.value.offsetWidth/2),y=Math.max(a.value.offsetWidth/2,y),H=Math.round((y-a.value.offsetWidth/2)/(D.width-a.value.offsetWidth)*360)}l.color.set("hue",H)}function B(){if(!a.value)return 0;const w=n.vnode.el;if(l.vertical)return 0;const T=l.color.get("hue");return w?Math.round(T*(w.offsetWidth-a.value.offsetWidth/2)/360):0}function b(){if(!a.value)return 0;const w=n.vnode.el;if(!l.vertical)return 0;const T=l.color.get("hue");return w?Math.round(T*(w.offsetHeight-a.value.offsetHeight/2)/360):0}function P(){r.value=B(),f.value=b()}return Fe(()=>{if(!u.value||!a.value)return;const w={drag:T=>{N(T)},end:T=>{N(T)}};Re(u.value,w),Re(a.value,w),P()}),{bar:u,thumb:a,thumbLeft:r,thumbTop:f,hueValue:k,handleClick:L,update:P,ns:o}}});function bo(l,o,n,a,u,r){return S(),z("div",{class:M([l.ns.b(),l.ns.is("vertical",l.vertical)])},[$("div",{ref:"bar",class:M(l.ns.e("bar")),onClick:l.handleClick},null,10,["onClick"]),$("div",{ref:"thumb",class:M(l.ns.e("thumb")),style:be({left:l.thumbLeft+"px",top:l.thumbTop+"px"})},null,6)],2)}var wo=He(po,[["render",bo],["__file","hue-slider.vue"]]);const yo=la({modelValue:String,id:String,showAlpha:Boolean,colorFormat:String,disabled:Boolean,size:Ja,popperClass:{type:String,default:""},tabindex:{type:[String,Number],default:0},teleported:Ba.teleported,predefine:{type:na(Array)},validateEvent:{type:Boolean,default:!0},...lo(["ariaLabel"])}),Co={[Ze]:l=>ze(l)||ct(l),[no]:l=>ze(l)||ct(l),activeChange:l=>ze(l)||ct(l),focus:l=>l instanceof FocusEvent,blur:l=>l instanceof FocusEvent},ra=Symbol("colorPickerContextKey"),Jt=function(l,o,n){return[l,o*n/((l=(2-o)*n)<1?l:2-l)||0,l/2]},ko=function(l){return ze(l)&&l.includes(".")&&Number.parseFloat(l)===1},_o=function(l){return ze(l)&&l.includes("%")},ke=function(l,o){ko(l)&&(l="100%");const n=_o(l);return l=Math.min(o,Math.max(0,Number.parseFloat(`${l}`))),n&&(l=Number.parseInt(`${l*o}`,10)/100),Math.abs(l-o)<1e-6?1:l%o/Number.parseFloat(o)},ea={10:"A",11:"B",12:"C",13:"D",14:"E",15:"F"},Qe=l=>{l=Math.min(Math.round(l),255);const o=Math.floor(l/16),n=l%16;return`${ea[o]||o}${ea[n]||n}`},ta=function({r:l,g:o,b:n}){return Number.isNaN(+l)||Number.isNaN(+o)||Number.isNaN(+n)?"":`#${Qe(l)}${Qe(o)}${Qe(n)}`},dt={A:10,B:11,C:12,D:13,E:14,F:15},ge=function(l){return l.length===2?(dt[l[0].toUpperCase()]||+l[0])*16+(dt[l[1].toUpperCase()]||+l[1]):dt[l[1].toUpperCase()]||+l[1]},Lo=function(l,o,n){o=o/100,n=n/100;let a=o;const u=Math.max(n,.01);n*=2,o*=n<=1?n:2-n,a*=u<=1?u:2-u;const r=(n+o)/2,f=n===0?2*a/(u+a):2*o/(n+o);return{h:l,s:f*100,v:r*100}},aa=(l,o,n)=>{l=ke(l,255),o=ke(o,255),n=ke(n,255);const a=Math.max(l,o,n),u=Math.min(l,o,n);let r;const f=a,k=a-u,L=a===0?0:k/a;if(a===u)r=0;else{switch(a){case l:{r=(o-n)/k+(o<n?6:0);break}case o:{r=(n-l)/k+2;break}case n:{r=(l-o)/k+4;break}}r/=6}return{h:r*360,s:L*100,v:f*100}},Pe=function(l,o,n){l=ke(l,360)*6,o=ke(o,100),n=ke(n,100);const a=Math.floor(l),u=l-a,r=n*(1-o),f=n*(1-u*o),k=n*(1-(1-u)*o),L=a%6,N=[n,f,r,r,k,n][L],B=[k,n,n,f,r,r][L],b=[r,r,k,n,n,f][L];return{r:Math.round(N*255),g:Math.round(B*255),b:Math.round(b*255)}};class Ie{constructor(o={}){this._hue=0,this._saturation=100,this._value=100,this._alpha=100,this.enableAlpha=!1,this.format="hex",this.value="";for(const n in o)Bt(o,n)&&(this[n]=o[n]);o.value?this.fromString(o.value):this.doOnChange()}set(o,n){if(arguments.length===1&&typeof o=="object"){for(const a in o)Bt(o,a)&&this.set(a,o[a]);return}this[`_${o}`]=n,this.doOnChange()}get(o){return o==="alpha"?Math.floor(this[`_${o}`]):this[`_${o}`]}toRgb(){return Pe(this._hue,this._saturation,this._value)}fromString(o){if(!o){this._hue=0,this._saturation=100,this._value=100,this.doOnChange();return}const n=(a,u,r)=>{this._hue=Math.max(0,Math.min(360,a)),this._saturation=Math.max(0,Math.min(100,u)),this._value=Math.max(0,Math.min(100,r)),this.doOnChange()};if(o.includes("hsl")){const a=o.replace(/hsla|hsl|\(|\)/gm,"").split(/\s|,/g).filter(u=>u!=="").map((u,r)=>r>2?Number.parseFloat(u):Number.parseInt(u,10));if(a.length===4?this._alpha=Number.parseFloat(a[3])*100:a.length===3&&(this._alpha=100),a.length>=3){const{h:u,s:r,v:f}=Lo(a[0],a[1],a[2]);n(u,r,f)}}else if(o.includes("hsv")){const a=o.replace(/hsva|hsv|\(|\)/gm,"").split(/\s|,/g).filter(u=>u!=="").map((u,r)=>r>2?Number.parseFloat(u):Number.parseInt(u,10));a.length===4?this._alpha=Number.parseFloat(a[3])*100:a.length===3&&(this._alpha=100),a.length>=3&&n(a[0],a[1],a[2])}else if(o.includes("rgb")){const a=o.replace(/rgba|rgb|\(|\)/gm,"").split(/\s|,/g).filter(u=>u!=="").map((u,r)=>r>2?Number.parseFloat(u):Number.parseInt(u,10));if(a.length===4?this._alpha=Number.parseFloat(a[3])*100:a.length===3&&(this._alpha=100),a.length>=3){const{h:u,s:r,v:f}=aa(a[0],a[1],a[2]);n(u,r,f)}}else if(o.includes("#")){const a=o.replace("#","").trim();if(!/^[0-9a-fA-F]{3}$|^[0-9a-fA-F]{6}$|^[0-9a-fA-F]{8}$/.test(a))return;let u,r,f;a.length===3?(u=ge(a[0]+a[0]),r=ge(a[1]+a[1]),f=ge(a[2]+a[2])):(a.length===6||a.length===8)&&(u=ge(a.slice(0,2)),r=ge(a.slice(2,4)),f=ge(a.slice(4,6))),a.length===8?this._alpha=ge(a.slice(6))/255*100:(a.length===3||a.length===6)&&(this._alpha=100);const{h:k,s:L,v:N}=aa(u,r,f);n(k,L,N)}}compare(o){return Math.abs(o._hue-this._hue)<2&&Math.abs(o._saturation-this._saturation)<1&&Math.abs(o._value-this._value)<1&&Math.abs(o._alpha-this._alpha)<1}doOnChange(){const{_hue:o,_saturation:n,_value:a,_alpha:u,format:r}=this;if(this.enableAlpha)switch(r){case"hsl":{const f=Jt(o,n/100,a/100);this.value=`hsla(${o}, ${Math.round(f[1]*100)}%, ${Math.round(f[2]*100)}%, ${this.get("alpha")/100})`;break}case"hsv":{this.value=`hsva(${o}, ${Math.round(n)}%, ${Math.round(a)}%, ${this.get("alpha")/100})`;break}case"hex":{this.value=`${ta(Pe(o,n,a))}${Qe(u*255/100)}`;break}default:{const{r:f,g:k,b:L}=Pe(o,n,a);this.value=`rgba(${f}, ${k}, ${L}, ${this.get("alpha")/100})`}}else switch(r){case"hsl":{const f=Jt(o,n/100,a/100);this.value=`hsl(${o}, ${Math.round(f[1]*100)}%, ${Math.round(f[2]*100)}%)`;break}case"hsv":{this.value=`hsv(${o}, ${Math.round(n)}%, ${Math.round(a)}%)`;break}case"rgb":{const{r:f,g:k,b:L}=Pe(o,n,a);this.value=`rgb(${f}, ${k}, ${L})`;break}default:this.value=ta(Pe(o,n,a))}}}const $o=de({props:{colors:{type:Array,required:!0},color:{type:Object,required:!0},enableAlpha:{type:Boolean,required:!0}},setup(l){const o=Be("color-predefine"),{currentColor:n}=Da(ra),a=E(r(l.colors,l.color));ee(()=>n.value,f=>{const k=new Ie;k.fromString(f),a.value.forEach(L=>{L.selected=k.compare(L)})}),xa(()=>{a.value=r(l.colors,l.color)});function u(f){l.color.fromString(l.colors[f])}function r(f,k){return f.map(L=>{const N=new Ie;return N.enableAlpha=l.enableAlpha,N.format="rgba",N.fromString(L),N.selected=N.value===k.value,N})}return{rgbaColors:a,handleSelect:u,ns:o}}});function Ao(l,o,n,a,u,r){return S(),z("div",{class:M(l.ns.b())},[$("div",{class:M(l.ns.e("colors"))},[(S(!0),z(pe,null,De(l.rgbaColors,(f,k)=>(S(),z("div",{key:l.colors[k],class:M([l.ns.e("color-selector"),l.ns.is("alpha",f._alpha<100),{selected:f.selected}]),onClick:L=>l.handleSelect(k)},[$("div",{style:be({backgroundColor:f.value})},null,4)],10,["onClick"]))),128))],2)],2)}var Mo=He($o,[["render",Ao],["__file","predefine.vue"]]);const No=de({name:"ElSlPanel",props:{color:{type:Object,required:!0}},setup(l){const o=Be("color-svpanel"),n=Ge(),a=E(0),u=E(0),r=E("hsl(0, 100%, 50%)"),f=V(()=>{const N=l.color.get("hue"),B=l.color.get("value");return{hue:N,value:B}});function k(){const N=l.color.get("saturation"),B=l.color.get("value"),b=n.vnode.el,{clientWidth:P,clientHeight:w}=b;u.value=N*P/100,a.value=(100-B)*w/100,r.value=`hsl(${l.color.get("hue")}, 100%, 50%)`}function L(N){const b=n.vnode.el.getBoundingClientRect(),{clientX:P,clientY:w}=vt(N);let T=P-b.left,D=w-b.top;T=Math.max(0,T),T=Math.min(T,b.width),D=Math.max(0,D),D=Math.min(D,b.height),u.value=T,a.value=D,l.color.set({saturation:T/b.width*100,value:100-D/b.height*100})}return ee(()=>f.value,()=>{k()}),Fe(()=>{Re(n.vnode.el,{drag:N=>{L(N)},end:N=>{L(N)}}),k()}),{cursorTop:a,cursorLeft:u,background:r,colorValue:f,handleDrag:L,update:k,ns:o}}});function Eo(l,o,n,a,u,r){return S(),z("div",{class:M(l.ns.b()),style:be({backgroundColor:l.background})},[$("div",{class:M(l.ns.e("white"))},null,2),$("div",{class:M(l.ns.e("black"))},null,2),$("div",{class:M(l.ns.e("cursor")),style:be({top:l.cursorTop+"px",left:l.cursorLeft+"px"})},[$("div")],6)],6)}var To=He(No,[["render",Eo],["__file","sv-panel.vue"]]);const So=de({name:"ElColorPicker"}),Po=de({...So,props:yo,emits:Co,setup(l,{expose:o,emit:n}){const a=l,{t:u}=sa(),r=Be("color"),{formItem:f}=eo(),k=to(),L=ao(),{inputId:N,isLabeledByFormItem:B}=oo(a,{formItemContext:f}),b=E(),P=E(),w=E(),T=E(),D=E(),R=E(),{isFocused:te,handleFocus:H,handleBlur:y}=ro(D,{beforeFocus(){return L.value},beforeBlur(C){var W;return(W=T.value)==null?void 0:W.isFocusInsideContent(C)},afterBlur(){I(!1),oe()}});let x=!0;const h=oa(new Ie({enableAlpha:a.showAlpha,format:a.colorFormat||"",value:a.modelValue})),ae=E(!1),A=E(!1),le=E(""),_e=V(()=>!a.modelValue&&!A.value?"transparent":j(h,a.showAlpha)),fe=V(()=>!a.modelValue&&!A.value?"":h.value),Le=V(()=>B.value?void 0:a.ariaLabel||u("el.colorpicker.defaultLabel")),we=V(()=>B.value?f==null?void 0:f.labelId:void 0),m=V(()=>[r.b("picker"),r.is("disabled",L.value),r.bm("picker",k.value),r.is("focused",te.value)]);function j(C,W){if(!(C instanceof Ie))throw new TypeError("color should be instance of _color Class");const{r:O,g:Ne,b:Ee}=C.toRgb();return W?`rgba(${O}, ${Ne}, ${Ee}, ${C.get("alpha")/100})`:`rgb(${O}, ${Ne}, ${Ee})`}function I(C){ae.value=C}const re=so(I,100,{leading:!0});function Y(){L.value||I(!0)}function ie(){re(!1),oe()}function oe(){xe(()=>{a.modelValue?h.fromString(a.modelValue):(h.value="",xe(()=>{A.value=!1}))})}function Ke(){L.value||(ae.value&&oe(),re(!ae.value))}function $e(){h.fromString(le.value)}function Ve(){const C=h.value;n(Ze,C),n("change",C),a.validateEvent&&(f==null||f.validate("change").catch(W=>Gt())),re(!1),xe(()=>{const W=new Ie({enableAlpha:a.showAlpha,format:a.colorFormat||"",value:a.modelValue});h.compare(W)||oe()})}function Oe(){re(!1),n(Ze,null),n("change",null),a.modelValue!==null&&a.validateEvent&&(f==null||f.validate("change").catch(C=>Gt())),oe()}function ye(){ae.value&&(ie(),te.value&&Xe())}function Ae(C){C.preventDefault(),C.stopPropagation(),I(!1),oe()}function Me(C){switch(C.code){case ue.enter:case ue.numpadEnter:case ue.space:C.preventDefault(),C.stopPropagation(),Y(),R.value.focus();break;case ue.esc:Ae(C);break}}function Xe(){D.value.focus()}function Je(){D.value.blur()}return Fe(()=>{a.modelValue&&(le.value=fe.value)}),ee(()=>a.modelValue,C=>{C?C&&C!==h.value&&(x=!1,h.fromString(C)):A.value=!1}),ee(()=>[a.colorFormat,a.showAlpha],()=>{h.enableAlpha=a.showAlpha,h.format=a.colorFormat||h.format,h.doOnChange(),n(Ze,h.value)}),ee(()=>fe.value,C=>{le.value=C,x&&n("activeChange",C),x=!0}),ee(()=>h.value,()=>{!a.modelValue&&!A.value&&(A.value=!0)}),ee(()=>ae.value,()=>{xe(()=>{var C,W,O;(C=b.value)==null||C.update(),(W=P.value)==null||W.update(),(O=w.value)==null||O.update()})}),za(ra,{currentColor:fe}),o({color:h,show:Y,hide:ie,focus:Xe,blur:Je}),(C,W)=>(S(),je(c(Ka),{ref_key:"popper",ref:T,visible:ae.value,"show-arrow":!1,"fallback-placements":["bottom","top","right","left"],offset:0,"gpu-acceleration":!1,"popper-class":[c(r).be("picker","panel"),c(r).b("dropdown"),C.popperClass],"stop-popper-mouse-event":!1,effect:"light",trigger:"click",teleported:C.teleported,transition:`${c(r).namespace.value}-zoom-in-top`,persistent:"",onHide:O=>I(!1)},{content:F(()=>[rt((S(),z("div",{onKeydown:ht(Ae,["esc"])},[$("div",{class:M(c(r).be("dropdown","main-wrapper"))},[_(wo,{ref_key:"hue",ref:b,class:"hue-slider",color:c(h),vertical:""},null,8,["color"]),_(To,{ref_key:"sv",ref:P,color:c(h)},null,8,["color"])],2),C.showAlpha?(S(),je(go,{key:0,ref_key:"alpha",ref:w,color:c(h)},null,8,["color"])):q("v-if",!0),C.predefine?(S(),je(Mo,{key:1,ref:"predefine","enable-alpha":C.showAlpha,color:c(h),colors:C.predefine},null,8,["enable-alpha","color","colors"])):q("v-if",!0),$("div",{class:M(c(r).be("dropdown","btns"))},[$("span",{class:M(c(r).be("dropdown","value"))},[_(c(Fa),{ref_key:"inputRef",ref:R,modelValue:le.value,"onUpdate:modelValue":O=>le.value=O,"validate-event":!1,size:"small",onKeyup:ht($e,["enter"]),onBlur:$e},null,8,["modelValue","onUpdate:modelValue","onKeyup"])],2),_(c(Yt),{class:M(c(r).be("dropdown","link-btn")),text:"",size:"small",onClick:Oe},{default:F(()=>[Ht(J(c(u)("el.colorpicker.clear")),1)]),_:1},8,["class"]),_(c(Yt),{plain:"",size:"small",class:M(c(r).be("dropdown","btn")),onClick:Ve},{default:F(()=>[Ht(J(c(u)("el.colorpicker.confirm")),1)]),_:1},8,["class"])],2)],40,["onKeydown"])),[[c(Ha),ye,D.value]])]),default:F(()=>[$("div",Ia({id:c(N),ref_key:"triggerRef",ref:D},C.$attrs,{class:c(m),role:"button","aria-label":c(Le),"aria-labelledby":c(we),"aria-description":c(u)("el.colorpicker.description",{color:C.modelValue||""}),"aria-disabled":c(L),tabindex:c(L)?-1:C.tabindex,onKeydown:Me,onFocus:c(H),onBlur:c(y)}),[c(L)?(S(),z("div",{key:0,class:M(c(r).be("picker","mask"))},null,2)):q("v-if",!0),$("div",{class:M(c(r).be("picker","trigger")),onClick:Ke},[$("span",{class:M([c(r).be("picker","color"),c(r).is("alpha",C.showAlpha)])},[$("span",{class:M(c(r).be("picker","color-inner")),style:be({backgroundColor:c(_e)})},[rt(_(c(Qt),{class:M([c(r).be("picker","icon"),c(r).is("icon-arrow-down")])},{default:F(()=>[_(c(Za))]),_:1},8,["class"]),[[Kt,C.modelValue||A.value]]),rt(_(c(Qt),{class:M([c(r).be("picker","empty"),c(r).is("icon-close")])},{default:F(()=>[_(c(Qa))]),_:1},8,["class"]),[[Kt,!C.modelValue&&!A.value]])],6)],2)],2)],16,["id","aria-label","aria-labelledby","aria-description","aria-disabled","tabindex","onFocus","onBlur"])]),_:1},8,["visible","popper-class","teleported","transition","onHide"]))}});var Do=He(Po,[["__file","color-picker.vue"]]);const ft=Ra(Do);const xo={class:"paint-view"},zo={class:"paint-left"},Io=["onClick","disabled"],Ro={style:{"font-size":"16px"}},Fo=["innerHTML"],Bo=["disabled"],Ho={key:0,style:{"margin-left":"10px"}},Ko={key:0,class:"zoom-tool bg-primary"},Vo=["onClick","disabled"],Oo={style:{"font-size":"16px"}},Xo=["innerHTML"],Yo={class:"zoom-window"},Wo={key:0,class:"single-name-color-picker q-mx-sm"},Uo={class:"w3-margin-left"},qo={class:M(["w3-container","w3-display-container","w3-padding","w3-border-bottom"])},jo={class:"w3-xlarge"},Zo={key:0,class:"w3-display-right w3-margin-right"},Qo={class:"w3-container w3-padding content"},Go=["onClick"],Jo={class:"w3-large"},el={class:"w3-margin-left"},tl={class:M(["w3-container","w3-display-container","w3-padding","w3-border-bottom"])},al={class:"w3-xlarge"},ol={class:"w3-container w3-padding content"},ll=["onClick"],nl=["onClick"],sl=["onClick"],rl=de({__name:"KonvaPaint",props:{img:{type:String,default:""},width:{type:Number,default:800},height:{type:Number,default:600},visibleTools:{type:Array,default:()=>["rect","circle","poly","pen","eraser","zoom-in","zoom-out","move","update"]},setInfo:{type:Function,default:()=>{}},singleImage:{type:Boolean,default:!1},singleLabelName:{type:Boolean,default:!1},singleLabel:{type:Boolean,default:!1},showRightArea:{type:Boolean,default:!0},sameLabelAllow:{type:Boolean,default:!0},labelNames:{type:Array,default:()=>[],required:!1},disabled:{type:Boolean,default:!1},defaultTool:{type:String,default:""},isZoomOut:{type:Boolean,default:!1},fileLabels:{type:Array,default:()=>[]},zIndex:{type:Number,default:0},isToolParent:{type:Boolean,default:!1},showLabelAction:{type:Boolean,default:!0},saveText:{type:String,default:""},toolPosition:{type:Object,default:()=>({x:5,y:5})},initArray:{type:Array,default:()=>[]}},setup(l){const o=l,n=qa.global.t,a=Oa(),u=ja(),r=E(!1),f=async()=>{const e=I.value.getChildren(oe(!0));I.value.removeChildren(),Y.value=[];for(const t of e)await Z(t,!1),setTimeout(()=>{console.log("clearAndRebuildLayers",t)},10)},k=[],L=async e=>{var s,i;await f(),k.push(e);const t=o.fileLabels[e];for(let d=0;d<((s=t==null?void 0:t.labels)==null?void 0:s.length);d++){const g=t.labels[d],v=a.handleLabelsGraphic(g);if(!v)continue;const p=((i=a.labels.find(K=>K.name===v.label))==null?void 0:i.color)??X.Util.getRandomColor();a.addLabel(v.label,p),Ve(v,p)}await Ke(e),await Ue(e)},N=async e=>{if(e){a.controlLock=!0,zt.show();try{for(const t of e)k.includes(t)||await L(t)}catch(t){console.error("initLabels",t)}finally{a.controlLock=!1,zt.hide(),await Ue(a.currentImage)}}},B=()=>new Promise(e=>{const t=setInterval(()=>{a.controlLock||(clearInterval(t),e(null))},100)});ee(()=>[a.currentImage,o.initArray],async([e,t=[]]=[],[s]=[])=>{console.log("watch",e,t,s,o.fileLabels),await B(),o.fileLabels.length>0&&o.fileLabels[e]&&!k.includes(e)?(await N(t),await Ue(e)):(console.log("changePictureFromPrev",e,s),await ka(e,s))});const b=E(),P=V(()=>({width:o.width,height:o.height})),w=E({x:0,y:0}),T=E({points:[0,300,600,300],stroke:"white",strokeWidth:.7,lineJoin:"round",dash:[3,3],visible:!1}),D=E({points:[300,0,300,600],stroke:"white",strokeWidth:.7,lineJoin:"round",dash:[3,3],visible:!1}),R=E(),te=E(),H=E(),y=E(!1),x=E("");let h,ae=[0,0],A=[],le=!1,_e=!1,fe=0,Le=0,we=1;const m=V(()=>R.value.getStage()),j=E(6),I=V(()=>te.value.getStage()),re=V(()=>H.value.getStage()),Y=E([]),ie=E([{name:"",icon:"fa-solid fa-arrow-pointer",title:`${n("LabelTool")}(V)`,describe:n("SelectionToolDesc"),keyCode:[86]},{name:"move",icon:"fa-solid fa-hand-paper",title:`${n("DragTool")}(D)`,describe:n("DragToolDesc"),keyCode:[68]},{name:"rect",icon:"fa-solid fa-vector-square",title:`${n("RectTool")}(R)`,describe:n("RectToolDesc"),keyCode:[82]},{name:"circle",icon:"fa-solid fa-circle",title:`${n("CircleTool")}(C)`,describe:n("CircleToolDesc"),keyCode:[67]},{name:"poly",icon:"fa-solid fa-draw-polygon",title:`${n("PolygonTool")}(P)`,describe:n("PolygonToolDesc"),keyCode:[80]},{name:"pen",icon:"fa-solid fa-paintbrush",title:`${n("BrushTool")}(B)`,describe:n("BrushToolDesc"),keyCode:[66]},{name:"eraser",icon:"fa-solid fa-eraser",title:`${n("EraserTool")}(E)`,describe:n("EraserToolDesc"),keyCode:[69]},{name:"zoom-out",icon:"fa-solid fa-search-minus",title:`${n("ZoomOutTool")}(-)`,describe:n("ZoomOutToolDesc"),keyCode:[189,109]},{name:"zoom-in",icon:"fa-solid fa-search-plus",title:`${n("ZoomInTool")} (+)`,describe:n("ZoomInToolDesc"),keyCode:[187,107]},{name:"update",icon:"fa-solid fa-camera-rotate",title:`${n("UpdateTool")} (U)`,describe:n("UpdateToolDesc"),keyCode:[85]}]),oe=e=>t=>e?t.getClassName()==="Image"||t.getClassName()==="Line":t.getClassName()!=="Image"&&t.getClassName()!=="Line",Ke=async e=>{a.recordLabel(I.value.getChildren(oe(!1)).map(t=>t.toObject()),e),await f()},$e=async e=>{if(e>=a.imgs.length)return;const t=new Image;t.src=await qt(a.imgs[e].url)??"",t.width=m.value.width(),t.height=m.value.height(),re.value.image(t)},Ve=(e,t)=>{if(console.log("drawLabel",e,t),!!e){if(e.name==="rect"){const s=Lt(e.label,t,e.x,e.y,e.width,e.height);Z(s,!0,!1)}else if(e.name==="poly"){const s=new X.Group({id:`#${Date.now()}`,label:e.label,name:"poly",x:0,y:0,draggable:!1});for(let i=0;i<e.points.length;i+=2){const d=e.points[i],g=e.points[i+1];console.log(s,"group"),s.add(Se(d,g)),i===0?s.add(at(e.points,t)):s.setAttr("points",e.points)}s.setAttr("points",e.points),Z(s,!0,!1),h=void 0,A=[],ce()}}},Oe=()=>{const e=Va.split("|",2),t=e[0],s=e[1].split(" "),i=parseInt(s[2]),d=parseInt(s[3]);return`url("${new X.Path({width:i,height:d,data:t,fill:"black",scaleX:28/i,scaleY:28/d}).toDataURL({mimeType:"image/png"})}") 0 25, auto`},ye=()=>{m.value.find("Transformer").length>0&&m.value.find("Transformer").forEach(e=>e.destroy())},Ae=()=>m.value.find("Circle"),Me=e=>Ae().forEach(e),Xe=()=>{const e=Ae();for(const t of e)if(t.visible())return e.forEach(s=>s.hide()),!0;return!1},Je=()=>m.value.container().style.cursor=x.value==="eraser"?Oe():"move",C=()=>m.value.container().style.cursor=x.value==="eraser"?Oe():"pointer",W=()=>m.value.container().style.cursor="grab",O=()=>{if(console.log("changeCursorCrosshair",x.value),x.value==="move"){W();return}m.value.container().style.cursor="crosshair"},Ne=e=>h.getChildren(t=>t.getClassName()===e),Ee=()=>Ne("Line")[0].points(),mt=()=>{const e={x:(m.value.width()-m.value.width()*m.value.scaleX())/2,y:(m.value.height()-m.value.height()*m.value.scaleY())/2};m.value.setAttrs({x:e.x,y:e.y}),w.value={x:e.x,y:e.y}},Te=E(1),he=(e,t)=>{let d=Te.value;e==="zoom-in"?d=+Ya(d,.1):e==="zoom-out"&&(d=+Wa(d,.1)),d>=.3&&d<=2.8&&(m.value.scaleX(d),m.value.scaleY(d),Te.value=d,j.value=Math.max(+G(6,d),1.8)),t&&mt()},gt=e=>{console.log("handleZoomSlider",e);const t=2.8,s=.3;e<=t&&e>=s&&(m.value.scaleX(e),m.value.scaleY(e),Te.value=e,j.value=Math.max(+G(6,e),1.3))},ia=()=>{gt(1),mt()},ca=async()=>{const e=a.imgs[a.currentImage].url,t=new Date().getTime(),s=e.indexOf("?")>-1?`${e}&t=${t}`:`${e}?t=${t}`,i=new Image;i.src=s,i.width=m.value.width(),i.height=m.value.height(),re.value.image(i)},Ye=e=>{if(e==="zoom-in"||e==="zoom-out"){he(e);return}if(e==="update"){ca();return}if(ce(),h=void 0,x.value=e,O(),m.value.draggable(!1),e==="move"){m.value.draggable(!0),W();return}},pt=async e=>{if(x.value!==""&&(console.log("開始繪畫",e),!(o.singleLabel&&Y.value.length>0)&&!(!o.sameLabelAllow&&a.currentLabel&&Y.value.find(s=>{var i;return s.attrs.label===((i=a.currentLabel)==null?void 0:i.name)})&&!y.value))){if(e.target===re.value){if(ye(),b.value=void 0,!y.value&&Xe()){h=void 0;return}I.value.draw(),console.log("開始繪畫",e),await Et(e.evt||e.touches[0]);return}if(y.value){console.log("繪畫中"),await Et(e.evt||e.touches[0]);return}}},ua=(e,t)=>{let s,i;if(e.evt instanceof MouseEvent)s=e.evt.offsetX,i=e.evt.offsetY;else return;if(t===!0){const d=Number(G(s-w.value.x,m.value.scaleX())),g=Number(G(i-w.value.y,m.value.scaleY()));T.value={...T.value,points:[0,g,m.value.width(),g],visible:!0},D.value={...D.value,points:[d,0,d,m.value.height()],visible:!0};return}T.value.visible=!1,D.value.visible=!1},bt=e=>{if(ua(e,x.value!==""),x.value&&y.value){O(),I.value.setDraggable(!1),ga(e.evt||e.touches[0]);return}},wt=()=>ba(),yt=e=>{I.value.getChildren(t=>t.getAttr("id")===e.attrs.id).forEach(t=>Ce(t)),ne(),y.value&&(y.value=!1,A=[])},da=e=>{I.value.getChildren(t=>t.getAttr("id")===e.attrs.id).forEach(t=>t.visible(!1)),e.attrs.visible=!1},fa=e=>{I.value.getChildren(t=>t.getAttr("id")===e.attrs.id).forEach(t=>t.visible(!0)),e.attrs.visible=!0},Ce=e=>{const t=e.getClassName()==="Line"||e.getClassName()==="Circle"?e.getParent():e,s=t.getAttr("id");Y.value=Y.value.filter(i=>i.attrs.id!==s),b.value&&b.value.attrs.id===s&&(b.value=void 0),t.destroy(),ne()},Ct=e=>x.value==="eraser"?(Ce(e),!0):!1,et=e=>e?e.getClassName()==="Circle"&&A.length<5||e.getClassName()==="Line"&&A.length<1?(Ce(e),!0):e.getClassName()==="Rect"&&(Math.abs(e.width())*e.scaleX()<5||Math.abs(e.height())*e.scaleY()<5)?(ye(),Ce(e),!0):!1:!1,ce=()=>{ye(),Me(e=>{e.hide(),e.off("mousedown touchstart")}),b.value=void 0},ha=e=>{if(e.attrs.visible===!1)return;console.log("focusNode = ",e);const t=I.value.getChildren(s=>s.getAttr("id")===e.attrs.id);console.log("ns = ",t),t.length>0&&(t[0].getClassName()==="Rect"?kt(t[0]):t[0].getClassName()==="Group"&&At(t[0]))},Z=(e,t,s=!1)=>new Promise(i=>{I.value.add(e),t&&Y.value.push(e.toObject()),s&&I.value.draw(),i()}),kt=e=>{for(const s of Y.value)if(s.attrs.id===e.getAttr("id")){b.value=s;break}h=e;const t=new X.Transformer({node:e,anchorCornerRadius:20,anchorSize:10,rotateEnabled:!1,keepRatio:!1,enabledAnchors:["top-left","top-right","bottom-left","bottom-right"],borderDash:[5,3]});t.on("mousedown touchstart",()=>h=e),t.on("transform pinchstart",()=>{console.log("開始拖拉"),t.anchorSize(10),ne(),console.log(m.value,"stage.value")}),t.on("transformend pinchend",()=>{console.log("結束拖拉"),t.anchorSize(12)}),Z(t,!1,!0)},_t=e=>{e.on("mouseenter touchstart",Je),e.on("mouseleave touchend",O),e.on("mousedown touchstart",async()=>{if(!Ct(e)){if(y.value){e.setAttr("draggable",!1);return}ce(),kt(e)}}),e.on("dragmove",()=>{ne()})},Lt=(e,t,s,i,d,g)=>{const v=new X.Rect({id:`#${Date.now()}${Math.random()}`,label:e,name:"rect",x:s,y:i,width:d,height:g,fill:t,stroke:t,strokeWidth:1,opacity:.5,draggable:!o.disabled,strokeScaleEnabled:!0});return h=v,_t(v),v},$t=(e,t)=>{let s=0,i=0;e.on("dragstart",()=>{e.setAttr("radius",j.value),h=e.getParent();const d=Ee();for(let g=0;g<d.length;g+=2)if(e.getAttr("x")===d[g]&&e.getAttr("y")==d[g+1]){s=g,i=g+1;break}}).on("dragend",()=>e.setAttr("radius",j.value*2)).on("dragmove",d=>{ne();let g=Ee();const v=m.value.container(),p=d.evt instanceof MouseEvent?d.evt.offsetX:d.evt.touches[0].clientX-v.offsetLeft-ve(v,"left")+u.scrollX,K=d.evt instanceof MouseEvent?d.evt.offsetY:d.evt.touches[0].clientY-v.offsetTop-ve(v,"top")+u.scrollY,U=Number(G(p-w.value.x,m.value.scaleX())),me=Number(G(K-w.value.y,m.value.scaleY()));g[s]=U-h.getAttr("x"),g[i]=me-h.getAttr("y"),Ne("Line")[0].points(g)}).on("mouseenter touchstart",()=>{y.value&&!t?O():C(),y.value&&!t||e.setAttr("radius",j.value*2)}).on("mouseleave touchend",()=>{O(),y.value&&!t||e.setAttr("radius",j.value)})},va=(e,t,s,i)=>{const d=new X.Circle({name:t,x:s,y:i,radius:j.value,visible:!0,fill:"#fff",stroke:"#333",strokeWidth:.5,draggable:!1});return Z(d,!1,!0),$t(d,e),d},At=e=>{for(const t of Y.value)if(t.attrs.id===e.getAttr("id")){b.value=t;break}h=e,e.getChildren(t=>t.getClassName()==="Line").forEach(t=>t.setDraggable(!1)),e.getChildren(t=>t.getClassName()==="Circle").forEach(t=>{t.show(),t.setDraggable(!o.disabled),t.moveToTop(),t.setAttr("radius",j.value),t.on("transform pinchstart",()=>{t.setAttr("radius",j.value)}),t.on("transformend pinchend",()=>{t.setAttr("radius",j.value*2)})}),e.setDraggable(!0),e.on("dragmove",()=>{ne()}),I.value.draw()},tt=e=>{e.on("mouseleave touchend",O),e.on("mousedown touchstart",()=>{if(!Ct(e)){if(y.value){O(),e.getParent().setAttr("draggable",!1);return}ce(),At(e.getParent())}}),e.getParent().on("dragend",t=>{t.target===e&&(O(),e.getParent().setAttr("draggable",!1))})},at=(e,t)=>{const s=new X.Line({name:"line",points:e,fill:t,stroke:t,strokeWidth:1,draggable:!1,opacity:.5,lineCap:"round",lineJoin:"round",closed:!0,strokeScaleEnabled:!1});return h=s,Z(s,!1,!0),tt(s),s},Se=(e,t,s="drag_point")=>{const i=A.length===0,d=va(i,s,e,t);return i?d.setAttrs({fill:"red"}).show().on("mousedown touchend",()=>{console.log("回到原點"),y.value=!1,et(d)||(h.setAttr("points",A),Me(g=>g.hide())),A=[],h=void 0}):d.show(),i?A=[e,t]:(A.push(e),A.push(t)),d},Mt=(e=100)=>{le&&(_e=!0,setTimeout(()=>Mt(e),e))},Nt=(e,t,s)=>{const i=[];for(let d=0;d<33;d++){const g=d*Math.PI/16,v=e+s*Math.cos(g),p=t+s*Math.sin(g);i.push(v,p)}return i},ma=(e,t,s,i)=>{const d=Nt(t,s,i),g=new X.Line({name:"line",points:d,fill:e,stroke:e,strokeWidth:1,draggable:!1,opacity:.3,lineCap:"round",lineJoin:"round",closed:!0,strokeScaleEnabled:!1});return h=g,Z(g,!1,!0),tt(g),g},Q=oa({visible:!1,name:""});function ve(e,t){let s=t==="left"?e.offsetLeft:e.offsetTop,i=e.offsetParent;for(;i;)s-=t==="left"?i.offsetLeft:i.offsetTop,i=i.offsetParent;return Math.abs(s)}const Et=async e=>{if(x.value==="move")return;if(!a.currentLabel){if(x.value===""||x.value==="eraser")return;if(a.labels.length===0){await St();return}if(it(n("Hint.SelectLabel")),a.currentLabel&&Y.value.find(K=>{var U;return K.attrs.label===((U=a.currentLabel)==null?void 0:U.name)})){it(n("Hint.LabelExists"));return}return}const t=m.value.container();console.log("-1--"),console.log(ve(t,"left")),console.log("-2--");const s=e instanceof MouseEvent?e.offsetX:e.touches[0].clientX-t.offsetLeft-ve(t,"left")+u.scrollX,i=e instanceof MouseEvent?e.offsetY:e.touches[0].clientY-t.offsetTop-ve(t,"top")+u.scrollY,d=Number(G(s-w.value.x,m.value.scaleX())),g=Number(G(i-w.value.y,m.value.scaleY())),v=a.currentLabel.name,p=a.currentLabel.color;switch(x.value){case"rect":ae=[d,g],Z(Lt(v,p,d,g,0,0),!0,!0);break;case"poly":if(A.length<2){const me=new X.Group({id:`#${Date.now()}`,label:v,name:"poly",x:0,y:0,draggable:!1});me.add(Se(d,g)),me.add(at(A,p)),Z(me,!0)}else h.getParent().add(Se(d,g)),h.setAttr("points",A);Me(me=>me.moveToTop()),m.value.draw();break;case"pen":const K=new X.Group({id:`#${Date.now()}`,label:v,name:"pen",x:0,y:0,draggable:!1});K.add(at(A,p)),console.log("加入畫布",A),Z(K,!0),le=!0,Mt(25);break;case"circle":const U=new X.Group({id:`#${Date.now()}`,label:v,name:"circle",x:0,y:0,draggable:!1});console.log("(x,y) = ",d,g),fe=d,Le=g,we=1,U.add(ma(p,d,g,we)),Z(U,!0);break}y.value=!0},ne=()=>{var e;(e=a.labelImgs[a.currentImage])!=null&&e.isActive||(a.labelImgs[a.currentImage].isActive=!0)},ga=e=>{ne();let t,s;const i=m.value.container();if(e instanceof MouseEvent)t=e.offsetX,s=e.offsetY;else if(e instanceof TouchEvent)t=e.touches[0].clientX-i.offsetLeft-ve(i,"left")+u.scrollX,s=e.touches[0].clientY-i.offsetTop-ve(i,"top")+u.scrollY;else return;switch(t=Number(G(t-w.value.x,m.value.scaleX())),s=Number(G(s-w.value.y,m.value.scaleY())),x.value){case"rect":h&&h.setAttrs({width:t-ae[0],height:s-ae[1]});break;case"poly":if(A.length>2){console.log(A,"poly");const d=A.concat();d.push(t),d.push(s),h.setAttr("points",d)}break;case"pen":if(_e){const d=+G(10,m.value.scaleX());if(A.length>0&&Math.abs(t-A[A.length-2])<d&&Math.abs(s-A[A.length-1])<d)return;const g=Se(t,s);g.hide(),h&&(h.getParent().add(g),h.setAttr("points",A)),_e=!1}break;case"circle":y.value&&(we=1+Math.sqrt(Math.pow(t-fe,2)+Math.pow(s-Le,2)),h.attrs.points=Nt(fe,Le,we));break}I.value.draw()},pa=e=>{if(!e)return;let t={};const s=e.width()<0,i=e.height()<0;s&&(t={...t,x:e.x()+e.width(),width:Math.abs(e.width())}),i&&(t={...t,y:e.y()+e.height(),height:Math.abs(e.height())}),(s||i)&&e.setAttrs(t)},ba=()=>{switch(console.log("滑鼠放開了 =>",h),x.value){case"rect":if(et(h),y.value=!1,h&&h.getClassName()==="Rect"&&I.value.findOne("Transformer"))break;pa(h),h=void 0;break;case"pen":y.value&&(h&&(console.log("line = ",h),et(h)),le=!1,y.value=!1,A=[],h=void 0,ce());break;case"circle":y.value=!1;break}I.value.draw()},Tt=async e=>{if(console.log("鍵盤 ==> ",e),e.ctrlKey&&(e.keyCode===107||e.keyCode===187)){e.preventDefault(),he("zoom-in");return}if(e.ctrlKey&&(e.keyCode===109||e.keyCode===189)){e.preventDefault(),he("zoom-out");return}for(const i of ie.value)if(i.keyCode&&i.keyCode.includes(e.keyCode)){e.preventDefault(),e.stopPropagation(),i.name==="zoom-in"||i.name==="zoom-out"?he(i.name):Ye(i.name);return}const t=e.keyCode===27,s=e.keyCode===8||e.keyCode===46;if(!(!s&&!t)){if(t&&y.value){if(x.value==="poly"||x.value==="rect"){h&&h.setAttr("points",A),A.length>2&&Se(A[0],A[1]),ce(),h=void 0,y.value=!1,A=[];return}return}if(!y.value){if(t){ce(),h=void 0;return}s&&b.value&&yt(b.value),h&&(h.getClassName()==="Rect"&&ye(),Ce(h))}}};let ot;const wa=()=>{if(console.log("複製節點"),b.value){const e=b.value;console.log("複製節點 = ",e);const t=jt(e);t.attrs.x+=10,t.attrs.y+=10,ot=t}},ya=()=>{var e;if(ot){const t=jt(ot.attrs);console.log("貼上節點 = ",t),t.id=`#${Date.now()}${Math.random()}`;const s=((e=a.labels.find(i=>i.name===t.label))==null?void 0:e.color)??X.Util.getRandomColor();if(ne(),!(t!=null&&t.width)||!(t!=null&&t.height))return;Ve(t,s)}},We=e=>{e.target&&e.target.localName&&e.target.localName!=="canvas"&&(ce(),h=void 0)},St=async()=>{Q.visible=!0,Q.name=""},Pt=async()=>{if(Q.name==="")return;if(a.labels.filter(t=>t.name===Q.name).length>0){it(n("Hint.DuplicateName")),Q.name="";return}Q.visible=!1;let e=X.Util.getRandomColor();for(;a.labels.filter(t=>t.color===e).length>0;)e=X.Util.getRandomColor();a.addLabel(Q.name,e)},Ca=async()=>{if(!a.currentLabel)return;ne();const e=a.currentLabel.name;I.value.getChildren(t=>t.getAttr("label")===e).forEach(t=>{t.destroy(),Y.value=Y.value.filter(s=>t.getAttr("id")!==s.attrs.id)}),a.removeLabel(e)},lt=async(e,t)=>{a.changeLabelColor(e,t),I.value.getChildren(s=>s.getAttr("label")===e).forEach(s=>{s.getClassName()==="Rect"?(s.setAttr("fill",t),s.setAttr("stroke",t)):s.getClassName()==="Group"&&s.getChildren(i=>i.getClassName()==="Line").forEach(i=>{i.setAttr("fill",t),i.setAttr("stroke",t)})})},Ue=async e=>{var s;await f();let t=(s=a.labelImgs[e])==null?void 0:s.label;if(await $e(e),t)for(let i=0;i<t.length;i++){let d=t[i];const g=X.Node.create(JSON.stringify(d));if(g){if(g.getClassName()==="Rect")_t(g);else if(g.getClassName()==="Group"){let v=g.getChildren();for(let p=0;p<v.length;p++){let K=v[p];K.getClassName()==="Line"?tt(K):K.getClassName()==="Circle"&&$t(K,!1)}}Z(g,!0,!0)}}},ka=async(e,t,s=!0)=>{a.imgs.length!==0&&(t!==void 0&&s&&await Ke(t),await Ue(e))};Vt(()=>{Xa()});const _a=async()=>{a.loading=!0;try{a.recordLabel(I.value.getChildren(oe(!1)).map(t=>t.toObject()));const e=await a.exportLabelFiles();if(o.singleLabel){o.setInfo(e[0].labels[0]);return}o.singleImage?o.setInfo(e[0].labels):(console.log(e,"exportLabelFiles label"),o.setInfo(e))}catch(e){console.log("error = ",e)}finally{a.loading=!1}},Dt=e=>{e.ctrlKey&&(e.key==="c"?wa():e.key==="v"&&ya())};Fe(async()=>{var e;if(m.value.container().style.cursor="crosshair",o.img&&a.resetImage([{name:"image",url:await qt(o.img)||"",path:o.img}]),await $e(a.currentImage),a.imageWidth=m.value.width(),a.imageHeight=m.value.height(),window.addEventListener("keydown",Dt),window.addEventListener("keydown",Tt),window.addEventListener("mousedown",We),window.addEventListener("touchstart",We),o.singleLabelName){const t=X.Util.getRandomColor();a.addLabel("label",t)}(e=o.initArray)!=null&&e.length&&await N(o.initArray),xe(async()=>{o.isZoomOut&&he("zoom-out",!0),await Ye(o.defaultTool)})}),Vt(()=>{window.removeEventListener("mousedown",We),window.removeEventListener("touchstart",We),window.removeEventListener("keydown",Dt),window.removeEventListener("keydown",Tt)});const nt=E(!1),La=()=>{x.value==="move"&&(nt.value=!0)},$a=e=>{if(x.value!=="move")return;const{x:t,y:s}=e.currentTarget.attrs;w.value={x:t,y:s},nt.value=!1},Aa=e=>{e.evt.stopPropagation(),e.evt.preventDefault();const t=e.evt.deltaX,s=e.evt.deltaY,i=Math.abs(t*1),d=Math.abs(s*1);Math.abs(t)!==0&&Math.abs(s)!==0&&console.log("没有固定方向");let g=m.value.x(),v=m.value.y();t<0&&(g=m.value.x()-i),t>0&&(g=m.value.x()+i),e.evt.ctrlKey||nt.value?(s>0&&he("zoom-out"),s<0&&he("zoom-in")):(s>0&&(v=m.value.y()+d),s<0&&(v=m.value.y()-d)),m.value.x(g),m.value.y(v),w.value={x:g,y:v},m.value.batchDraw()},xt=e=>{e.preventDefault=void 0};return(e,t)=>{const s=qe("v-image"),i=qe("v-line"),d=qe("v-layer"),g=qe("v-stage");return S(),z("div",xo,[$("div",zo,[_(c(Ut),{isResizable:!1,z:o.zIndex+2,x:l.toolPosition.x,y:l.toolPosition.y,w:"auto",h:"auto",onClicked:xt,parentLimitation:!e.$q.screen.lt.sm&&o.isToolParent,stickSize:12},{default:F(()=>[_(st,{class:M(["tool-box",{small:e.$q.screen.lt.sm}])},{default:F(()=>{var v;return[Ot(e.$slots,"tool",{},void 0,!0),(S(!0),z(pe,null,De(ie.value.filter(p=>p.name!=="zoom-in"&&p.name!=="zoom-out"),p=>(S(),z(pe,null,[o.visibleTools.includes(p.name)||p.name===""?(S(),z("button",{key:p.name,class:M(["tool-btn",{active:x.value===p.name}]),onClick:K=>Ye(p.name),disabled:o.disabled},[_(se,{name:p.icon},null,8,["name"]),_(It,{offset:[5,10],dark:"false"},{default:F(()=>[$("div",Ro,J(p.title),1),p.describe?(S(),z("div",{key:0,class:"text-body2",innerHTML:p.describe.replace(/\n/g,"<br />")},null,8,Fo)):q("",!0)]),_:2},1024)],10,Io)):q("",!0)],64))),256)),$("button",{class:"tool-btn is-primary",onClick:_a,disabled:o.disabled,style:{width:"auto"}},J(o.saveText?o.saveText:c(n)("Setting")),9,Bo),Ot(e.$slots,"tool-after",{},void 0,!0),l.showRightArea?q("",!0):(S(),z("span",Ho,[_(c(ft),{style:{float:"right"},"model-value":(v=c(a).labels[0])==null?void 0:v.color,onActiveChange:t[0]||(t[0]=p=>lt(c(a).labels[0].name,p??"")),"show-alpha":""},null,8,["model-value"])]))]}),_:3},8,["class"])]),_:3},8,["z","x","y","parentLimitation"]),_(c(Ut),{isResizable:!1,z:o.zIndex+2,x:0,y:l.height-l.toolPosition.y,w:"auto",h:"auto",onClicked:xt,parentLimitation:!e.$q.screen.lt.sm&&o.isToolParent,stickSize:12},{default:F(()=>[ie.value.find(v=>v.name==="zoom-in")||ie.value.find(v=>v.name==="zoom-out")?(S(),z("div",Ko,[(S(!0),z(pe,null,De(ie.value.filter(v=>v.name==="zoom-in"||v.name==="zoom-out"),v=>(S(),z(pe,null,[o.visibleTools.includes(v.name)||v.name===""?(S(),z("button",{key:v.name,class:M(["btn",{active:x.value===v.name}]),onClick:p=>Ye(v.name),disabled:o.disabled},[_(se,{name:v.icon},null,8,["name"]),_(It,{offset:[5,5],dark:"false"},{default:F(()=>[$("div",Oo,J(v.title),1),v.describe?(S(),z("div",{key:0,class:"text-body2",innerHTML:v.describe.replace(/\n/g,"<br />")},null,8,Xo)):q("",!0)]),_:2},1024)],10,Vo)):q("",!0)],64))),256)),_(Na,{class:"zoom-slider q-mx-xs","label-text-color":"primary","model-value":Te.value,min:.3,max:2.8,step:.1,label:"","label-value":`${c(Ua)(100,Te.value)}%`,disable:o.disabled,"onUpdate:modelValue":t[1]||(t[1]=v=>gt(v)),color:"white"},null,8,["model-value","label-value","disable"]),$("button",{class:"btn",onClick:t[2]||(t[2]=()=>ia())},[_(se,{name:"fa-solid fa-sync"})])])):q("",!0)]),_:1},8,["z","y","parentLimitation"]),_(g,{config:P.value,onMousedown:pt,onTouchstart:pt,onMousemove:bt,onTouchmove:bt,onMouseup:wt,onTouchend:wt,onDragstart:La,onDragend:$a,onWheel:Aa,ref_key:"_stage",ref:R},{default:F(()=>[_(d,{ref_key:"_layer",ref:te},{default:F(()=>[_(s,{ref_key:"_shape",ref:H},null,512),_(i,{config:D.value},null,8,["config"]),_(i,{config:T.value},null,8,["config"])]),_:1},512)]),_:1},8,["config"])]),o.showRightArea?(S(),je(st,{key:0,class:M(["paint-right",{small:r.value}]),square:""},{default:F(()=>{var v;return[$("div",Yo,[o.singleLabelName&&!r.value?(S(),z("span",Wo,[_(c(ft),{"model-value":(v=c(a).labels[0])==null?void 0:v.color,onActiveChange:t[3]||(t[3]=p=>lt(c(a).labels[0].name,p??"")),"show-alpha":"","popper-class":"paint-color-picker"},null,8,["model-value"]),$("span",Uo,J(c(n)("Color")),1)])):q("",!0),r.value?(S(),z("span",{key:2,class:"zoom-btn",onClick:t[5]||(t[5]=p=>r.value=!1)},[_(se,{name:"fa-solid fa-arrow-left"})])):(S(),z("span",{key:1,class:"zoom-btn",onClick:t[4]||(t[4]=p=>r.value=!0)},[_(se,{name:"fa-solid fa-minus"})]))]),o.singleLabelName?q("",!0):(S(),z("div",{key:0,class:M(["label-manager",{hide:r.value}])},[$("header",qo,[$("b",jo,J(c(n)("Label.Label")),1),o.showLabelAction?(S(),z("span",Zo,[$("span",{class:M(["w3-button w3-round w3-border",{"w3-disabled":!c(a).currentLabel||o.disabled}]),onClick:t[6]||(t[6]=p=>Ca())},[_(se,{name:"fa-solid fa-minus"})],2),$("span",{class:M(["w3-button w3-round w3-border",{"w3-disabled":o.disabled}]),onClick:t[7]||(t[7]=p=>St())},[_(se,{name:"fa-solid fa-add"})],2)])):q("",!0)]),_(c(Wt),{style:{"max-height":"265px"}},{default:F(()=>[$("div",Qo,[(S(!0),z(pe,null,De(c(a).labels,(p,K)=>(S(),z("div",{key:K,class:M(["w3-padding-top","w3-padding-bottom","pointer",p===c(a).currentLabel?"w3-leftbar w3-border-red":"card-item"]),onClick:U=>c(a).selectLabel(p)},[$("span",Jo,[_(c(ft),{"model-value":p.color,onActiveChange:U=>lt(p.name,U??""),"popper-class":"paint-color-picker"},null,8,["model-value","onActiveChange"]),$("span",el,[$("span",null,J(p.name),1)])])],10,Go))),128))])]),_:1})],2)),$("div",{class:M(["object-manager",{hide:r.value}])},[$("header",tl,[$("b",al,J(c(n)("Label.Layer")),1)]),_(c(Wt),{style:{"max-height":"265px"}},{default:F(()=>[$("div",ol,[(S(!0),z(pe,null,De(Y.value,(p,K)=>(S(),z("div",{key:K,class:M(["w3-bar","w3-padding-top","w3-padding-bottom","pointer","object-item"])},[$("span",{onClick:U=>ha(p),class:M(["",b.value&&b.value.attrs.id===p.attrs.id?["w3-bar-item","w3-leftbar","w3-border-red"]:["w3-bar-item","card-item"]])}," #"+J(K+1)+" "+J(`|  ${p.attrs.label}`),11,ll),$("span",{class:"w3-button w3-round w3-border w3-bar-item w3-right",onClick:U=>p.attrs.visible===!1?fa(p):da(p)},[_(se,{name:p.attrs.visible===!1?"fa-solid fa-eye-slash":"fa-solid fa-eye"},null,8,["name"])],8,nl),$("span",{class:M(["w3-button w3-round w3-border w3-bar-item w3-right",{disabled:o.disabled}]),onClick:U=>!o.disabled&&yt(p)},[_(se,{name:"fa-solid fa-trash-can"})],10,sl)]))),128))])]),_:1})],2)]}),_:1},8,["class"])):q("",!0),_(Ma,{modelValue:Q.visible,"onUpdate:modelValue":t[11]||(t[11]=v=>Q.visible=v),"append-to-body":!0,title:c(n)("Lite.Hint.ConfirmDelete"),center:""},{default:F(()=>[_(st,{style:{"min-width":"350px"}},{default:F(()=>[_(Rt,null,{default:F(()=>t[12]||(t[12]=[$("div",{class:"text-h6"},"Tip",-1)])),_:1}),_(Ea),_(Rt,null,{default:F(()=>[_(Ta,{modelValue:Q.name,"onUpdate:modelValue":t[8]||(t[8]=v=>Q.name=v),modelModifiers:{trim:!0},placeholder:c(n)("EnterLabelName"),outlined:"",dense:"",onKeydown:[ht(Pt,["enter"]),t[10]||(t[10]=Xt(()=>{},["stop"]))],onKeyup:t[9]||(t[9]=Xt(()=>{},["stop"]))},null,8,["modelValue","placeholder"])]),_:1}),_(Sa,{align:"right"},{default:F(()=>[_(Pa,{color:"primary",onClick:Pt,disabled:!Q.name,label:c(n)("Button.Add")},null,8,["disabled","label"])]),_:1})]),_:1})]),_:1},8,["modelValue","title"])])}}});const Sl=io(rl,[["__scopeId","data-v-bc930e8f"]]);export{Sl as K};
