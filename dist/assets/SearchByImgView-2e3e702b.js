import"./base-23d00206.js";import{E as M,g as le}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{E as R}from"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import{E as U,a as te}from"./el-steps-c8cdef54.js";import{E as w}from"./el-divider-67eeba91.js";import{a as A}from"./el-button-ded9ecc1.js";import{c as ae}from"./el-main-e0dc383b.js";import{E as L}from"./el-image-viewer-1a9f012d.js";import{E as x}from"./el-form-item-62aac1b2.js";import{E as T}from"./el-checkbox-d46297b7.js";/* empty css               */import{E as oe,a as j}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as z}from"./el-alert-65b82b76.js";import"./el-input-51d05b2a.js";import{E as ie}from"./el-input-number-815f9c07.js";import{g as se,d as re,o as ne,p as O}from"./@element-plus-a8abf029.js";import{u as ue,o as W,f as y,e as q}from"./index-d07dfee2.js";import{u as de}from"./uploadFile-6ce60004.js";import{u as me}from"./stashSpace-391fdb88.js";import{S as pe}from"./StashSelect-5af938b3.js";import{R as ce}from"./ResultImgWithStash-c075e0f0.js";import{E as G}from"./index-b8931eed.js";import{y as ve,h as fe,b as s,c as d,a as r,bf as c,ag as a,u as l,bI as i,S as H,o as u,af as B,a7 as ge,a8 as S,b0 as _e}from"./@vue-19632928.js";import{_ as ye}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./error-78e43d3e.js";import"./typescript-defaf979.js";import"./index-711061c4.js";import"./@vueuse-0d360189.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./use-dialog-b8544ca4.js";import"./event-9519ab40.js";import"./refs-e3a131a0.js";import"./vnode-18f2a975.js";import"./@ctrl-f8748455.js";import"./async-validator-dee29e8b.js";import"./index-6127babd.js";import"./index-32075738.js";import"./quasar-ff3737c6.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./el-tooltip-4ed993c7.js";import"./validator-7d68535e.js";import"./el-card-a6aa41d5.js";import"./jsoneditor-5f1e2c9e.js";const be={class:"step-page"},he={class:"step-nav"},we={key:0},Se={key:0},Ee={key:0},Ve={class:"el-upload__tip"},$e={class:"el-upload__tip"},Ie=["src"],ke={key:1},Ue={class:"el-upload__tip"},Be=["src"],Ce={key:2},Ne=ve({__name:"SearchByImgView",setup(Pe){const J=ue(),K=me();fe(()=>{console.log("SearchByImg")});const n=s(1),C=de(),E=s(""),f=s(!1),b=s([]),v=s([]),g=s([]),N=s([]),P=s([]),V=s(""),_=s(!1),$=s("add"),I=s(5),k=s(),h=s(!1),F=(t,e)=>{console.log(t,e)},D=t=>{E.value=t.url,f.value=!0},Q=t=>{k.value.clearFiles();const e=t[0];e.uid=le(),k.value.handleStart(e)},X=async()=>{const t=W();try{_.value===!0&&(await Y(),console.log("check_add_database")),await Z(),n.value++}catch(e){y(`${e}`)}finally{t.close()}},Y=async()=>{const t={method:$.value};h.value&&(t.folder_path=K.currentFolderPath),await C.upload("/api/search_img_database",b.value,t);const e=C.uploadResult;if(e&&e.code!==0){y(`API Error: ${e.code}`);return}},Z=async()=>{const t=await q("json","/api/init_search_img",void 0);if(console.log("res =>",t),t==null)return;const e=await t.data;if(console.log("result =>",e),e.code!==0){y(`API Error: ${e.code}`);return}},ee=async()=>{const t=W();try{const e=new FormData,o=await v.value[0].raw.arrayBuffer();e.append("image",new Blob([o]),v.value[0].name),e.append("number",`${I.value}`);const m=await q("form","/api/infer_search_img",e);if(m==null)return t.close(),!1;const p=await m.data;if(!p)return!1;if(p.code!==0)return y(`API Error: ${p.code}`),!1;g.value=p.result.all_names,N.value=p.result.score,P.value=p.result.img_name,V.value=p.result.origin_img,n.value++}catch(e){y(`${e}`)}finally{t.close()}};return(t,e)=>(u(),d(H,null,[r("h4",null,c(t.$t("SearchByImg")),1),a(l(w)),r("div",be,[r("div",he,[a(l(te),{active:n.value,"finish-status":"success",class:"w3-margin-bottom",direction:l(J).lt.md?"horizontal":"vertical"},{default:i(()=>[a(l(U),{title:t.$t("ModelSet"),icon:l(se),onClick:e[0]||(e[0]=o=>(n.value=1,b.value=[],v.value=[],_.value=!1)),class:"pointer"},null,8,["title","icon"]),a(l(U),{title:t.$t("SearchByImg"),icon:l(re),onClick:e[1]||(e[1]=o=>(n.value=2,v.value=[])),class:"pointer"},null,8,["title","icon"]),a(l(U),{title:t.$t("Result"),icon:l(ne),onClick:e[2]||(e[2]=o=>n.value=g.value.length>0?3:2),class:"pointer"},null,8,["title","icon"])]),_:1},8,["active","direction"])]),a(l(ae),null,{default:i(()=>[n.value===1?(u(),d("div",we,[a(l(A),{type:"primary",onClick:e[3]||(e[3]=o=>X())},{default:i(()=>[B(c(t.$t("ModelSet")),1)]),_:1}),e[13]||(e[13]=r("br",null,null,-1)),a(l(T),{modelValue:_.value,"onUpdate:modelValue":e[4]||(e[4]=o=>_.value=o),label:t.$t("UploadDatabase")},null,8,["modelValue","label"]),_.value===!0?(u(),d("div",Se,[a(l(x),{label:t.$t("Method")},{default:i(()=>[a(l(oe),{modelValue:$.value,"onUpdate:modelValue":e[5]||(e[5]=o=>$.value=o)},{default:i(()=>[a(l(j),{label:t.$t("Add"),value:"add"},null,8,["label"]),a(l(j),{label:t.$t("Replace"),value:"replace"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(l(w)),a(l(T),{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=o=>h.value=o)},{default:i(()=>[B(c(t.$t("Label.UsingTemporaryStorageSpace")),1)]),_:1},8,["modelValue"]),h.value?(u(),d("div",Ee,[a(pe,{"is-on-page":"","is-upload":""}),r("span",Ve,c(t.$t("UploadImg")),1)])):(u(),ge(l(M),{key:1,class:"upload-drag-img","file-list":b.value,"onUpdate:fileList":e[7]||(e[7]=o=>b.value=o),action:"/api/search_img_database","list-type":"picture-card","auto-upload":!1,"on-preview":D,"on-remove":F,multiple:"",drag:""},{tip:i(()=>[r("div",$e,c(t.$t("UploadImg")),1)]),default:i(()=>[a(l(G),null,{default:i(()=>[a(l(O))]),_:1})]),_:1},8,["file-list"])),a(l(R),{modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=o=>f.value=o)},{default:i(()=>[r("img",{style:{width:"100%"},src:E.value,alt:"Preview Image"},null,8,Ie)]),_:1},8,["modelValue"])])):S("",!0)])):S("",!0),n.value===2?(u(),d("div",ke,[a(l(A),{class:"ml-3",type:"success",onClick:e[9]||(e[9]=o=>ee())},{default:i(()=>[B(c(t.$t("Upload")),1)]),_:1}),a(l(x),{label:t.$t("SearchImgNum"),style:{width:"50%"}},{default:i(()=>[a(l(ie),{modelValue:I.value,"onUpdate:modelValue":e[10]||(e[10]=o=>I.value=o),min:1},null,8,["modelValue"])]),_:1},8,["label"]),a(l(w)),a(l(M),{ref_key:"upload",ref:k,class:"upload-drag-img","file-list":v.value,"onUpdate:fileList":e[11]||(e[11]=o=>v.value=o),action:"/api/infer_search_img","list-type":"picture-card","auto-upload":!1,"on-preview":D,"on-remove":F,accept:"image/*",limit:1,"on-exceed":Q,drag:""},{tip:i(()=>[r("div",Ue,c(t.$t("UploadImg")),1)]),default:i(()=>[a(l(G),null,{default:i(()=>[a(l(O))]),_:1})]),_:1},8,["file-list"]),a(l(R),{modelValue:f.value,"onUpdate:modelValue":e[12]||(e[12]=o=>f.value=o)},{default:i(()=>[r("img",{style:{width:"100%"},src:E.value,alt:"Preview Image"},null,8,Be)]),_:1},8,["modelValue"])])):S("",!0),n.value===3&&g.value.length!==0?(u(),d("div",Ce,[a(ce),e[14]||(e[14]=r("br",null,null,-1)),a(l(L),{style:{width:"300px",height:"300px"},src:V.value,"preview-src-list":[V.value],fit:"scale-down"},null,8,["src","preview-src-list"]),a(l(w)),(u(!0),d(H,null,_e(g.value,(o,m)=>(u(),d("div",{key:m,class:"inline-block"},[a(l(z),{title:P.value[m],type:"info",closable:!1},null,8,["title"]),a(l(z),{title:N.value[m],type:"success",closable:!1},null,8,["title"]),a(l(L),{style:{width:"100px",height:"100px",margin:"10px"},src:o,"preview-src-list":g.value,"initial-index":m,fit:"scale-down"},null,8,["src","preview-src-list","initial-index"])]))),128))])):S("",!0)]),_:1})])],64))}});const Rl=ye(Ne,[["__scopeId","data-v-08301cb8"]]);export{Rl as default};
