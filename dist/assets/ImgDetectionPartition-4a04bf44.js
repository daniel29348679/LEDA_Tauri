import{E as W,I as Be,e as Le,c as Ie,P as Re,k as ve,i as Ae}from"./index-b8931eed.js";import{a as ne,j as Oe,k as Ue,e as me}from"./@vueuse-0d360189.js";import{b as Y,d as ie,u as G,_ as he,w as ze,a as Fe}from"./base-23d00206.js";import{m as ye}from"./typescript-defaf979.js";import{t as re}from"./error-78e43d3e.js";import{c as z}from"./el-select-99a9cb58.js";import{y as F,f as ce,l as ue,b as w,d as M,n as de,C as Ve,o as S,c as D,aN as _e,u as N,aP as fe,i as H,h as be,K as De,ag as i,aW as Ke,b1 as X,bR as Me,bu as He,p as qe,F as we,B as Qe,bC as We,a8 as A,a7 as K,bI as R,a as Q,bf as se,af as je}from"./@vue-19632928.js";import{c as U}from"./earthApi-baaacd65.js";import{U as Ce}from"./event-9519ab40.js";import{u as Xe}from"./el-steps-c8cdef54.js";import{f as Ye,n as Ge,o as Pe,r as Je,d as $e,v as pe}from"./quasar-ff3737c6.js";import{E as Ze}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{E as et}from"./el-alert-65b82b76.js";import{p as tt}from"./@element-plus-a8abf029.js";import{u as at}from"./label-61e62ece.js";import{f as le,i as q,c as st,s as lt}from"./index-d07dfee2.js";import{K as ot}from"./konva-364a8bb7.js";import{u as nt}from"./app_camera-ba436274.js";import{K as it}from"./KonvaPaint-e9087f28.js";import{_ as rt}from"./json-editor-vue3-5344cb8d.js";const J=Symbol("tabsRootContextKey"),ct=Y({tabs:{type:ie(Array),default:()=>ye([])}}),Se="ElTabBar",ut=F({name:Se}),dt=F({...ut,props:ct,setup(e,{expose:r}){const o=e,g=ce(),s=ue(J);s||re(Se,"<el-tabs><el-tab-bar /></el-tabs>");const d=G("tabs"),y=w(),c=w(),_=()=>{let u=0,m=0;const t=["top","bottom"].includes(s.props.tabPosition)?"width":"height",f=t==="width"?"x":"y",a=f==="x"?"left":"top";return o.tabs.every(E=>{var T,L;const $=(L=(T=g.parent)==null?void 0:T.refs)==null?void 0:L[`tab-${E.uid}`];if(!$)return!1;if(!E.active)return!0;u=$[`offset${z(a)}`],m=$[`client${z(t)}`];const B=window.getComputedStyle($);return t==="width"&&(m-=Number.parseFloat(B.paddingLeft)+Number.parseFloat(B.paddingRight),u+=Number.parseFloat(B.paddingLeft)),!1}),{[t]:`${m}px`,transform:`translate${z(f)}(${u}px)`}},P=()=>c.value=_(),n=[],v=()=>{var u;n.forEach(t=>t.stop()),n.length=0;const m=(u=g.parent)==null?void 0:u.refs;if(m){for(const t in m)if(t.startsWith("tab-")){const f=m[t];f&&n.push(ne(f,P))}}};M(()=>o.tabs,async()=>{await de(),P(),v()},{immediate:!0});const h=ne(y,()=>P());return Ve(()=>{n.forEach(u=>u.stop()),n.length=0,h.stop()}),r({ref:y,update:P}),(u,m)=>(S(),D("div",{ref_key:"barRef",ref:y,class:_e([N(d).e("active-bar"),N(d).is(N(s).props.tabPosition)]),style:fe(c.value)},null,6))}});var ft=he(dt,[["__file","tab-bar.vue"]]);const bt=Y({panes:{type:ie(Array),default:()=>ye([])},currentName:{type:[String,Number],default:""},editable:Boolean,type:{type:String,values:["card","border-card",""],default:""},stretch:Boolean}),vt={tabClick:(e,r,o)=>o instanceof Event,tabRemove:(e,r)=>r instanceof Event},ge="ElTabNav",mt=F({name:ge,props:bt,emits:vt,setup(e,{expose:r,emit:o}){const g=ue(J);g||re(ge,"<el-tabs><tab-nav /></el-tabs>");const s=G("tabs"),d=Oe(),y=Ue(),c=w(),_=w(),P=w(),n=w(),v=w(!1),h=w(0),u=w(!1),m=w(!0),t=H(()=>["top","bottom"].includes(g.props.tabPosition)?"width":"height"),f=H(()=>({transform:`translate${t.value==="width"?"X":"Y"}(-${h.value}px)`})),a=()=>{if(!c.value)return;const b=c.value[`offset${z(t.value)}`],p=h.value;if(!p)return;const l=p>b?p-b:0;h.value=l},E=()=>{if(!c.value||!_.value)return;const b=_.value[`offset${z(t.value)}`],p=c.value[`offset${z(t.value)}`],l=h.value;if(b-l<=p)return;const x=b-l>p*2?l+p:b-p;h.value=x},T=async()=>{const b=_.value;if(!v.value||!P.value||!c.value||!b)return;await de();const p=P.value.querySelector(".is-active");if(!p)return;const l=c.value,x=["top","bottom"].includes(g.props.tabPosition),C=p.getBoundingClientRect(),k=l.getBoundingClientRect(),j=x?b.offsetWidth-k.width:b.offsetHeight-k.height,O=h.value;let I=O;x?(C.left<k.left&&(I=O-(k.left-C.left)),C.right>k.right&&(I=O+C.right-k.right)):(C.top<k.top&&(I=O-(k.top-C.top)),C.bottom>k.bottom&&(I=O+(C.bottom-k.bottom))),I=Math.max(I,0),h.value=Math.min(I,j)},L=()=>{var b;if(!_.value||!c.value)return;e.stretch&&((b=n.value)==null||b.update());const p=_.value[`offset${z(t.value)}`],l=c.value[`offset${z(t.value)}`],x=h.value;l<p?(v.value=v.value||{},v.value.prev=x,v.value.next=x+l<p,p-x<l&&(h.value=p-l)):(v.value=!1,x>0&&(h.value=0))},$=b=>{let p=0;switch(b.code){case U.left:case U.up:p=-1;break;case U.right:case U.down:p=1;break;default:return}const l=Array.from(b.currentTarget.querySelectorAll("[role=tab]:not(.is-disabled)"));let C=l.indexOf(b.target)+p;C<0?C=l.length-1:C>=l.length&&(C=0),l[C].focus({preventScroll:!0}),l[C].click(),B()},B=()=>{m.value&&(u.value=!0)},Z=()=>u.value=!1;return M(d,b=>{b==="hidden"?m.value=!1:b==="visible"&&setTimeout(()=>m.value=!0,50)}),M(y,b=>{b?setTimeout(()=>m.value=!0,50):m.value=!1}),ne(P,L),be(()=>setTimeout(()=>T(),0)),De(()=>L()),r({scrollToActiveTab:T,removeFocus:Z}),()=>{const b=v.value?[i("span",{class:[s.e("nav-prev"),s.is("disabled",!v.value.prev)],onClick:a},[i(W,null,{default:()=>[i(Be,null,null)]})]),i("span",{class:[s.e("nav-next"),s.is("disabled",!v.value.next)],onClick:E},[i(W,null,{default:()=>[i(Le,null,null)]})])]:null,p=e.panes.map((l,x)=>{var C,k,j,O;const I=l.uid,ee=l.props.disabled,te=(k=(C=l.props.name)!=null?C:l.index)!=null?k:`${x}`,ae=!ee&&(l.isClosable||e.editable);l.index=`${x}`;const xe=ae?i(W,{class:"is-icon-close",onClick:V=>o("tabRemove",l,V)},{default:()=>[i(Ie,null,null)]}):null,ke=((O=(j=l.slots).label)==null?void 0:O.call(j))||l.props.label,Ee=!ee&&l.active?0:-1;return i("div",{ref:`tab-${I}`,class:[s.e("item"),s.is(g.props.tabPosition),s.is("active",l.active),s.is("disabled",ee),s.is("closable",ae),s.is("focus",u.value)],id:`tab-${te}`,key:`tab-${I}`,"aria-controls":`pane-${te}`,role:"tab","aria-selected":l.active,tabindex:Ee,onFocus:()=>B(),onBlur:()=>Z(),onClick:V=>{Z(),o("tabClick",l,te,V)},onKeydown:V=>{ae&&(V.code===U.delete||V.code===U.backspace)&&o("tabRemove",l,V)}},[ke,xe])});return i("div",{ref:P,class:[s.e("nav-wrap"),s.is("scrollable",!!v.value),s.is(g.props.tabPosition)]},[b,i("div",{class:s.e("nav-scroll"),ref:c},[i("div",{class:[s.e("nav"),s.is(g.props.tabPosition),s.is("stretch",e.stretch&&["top","bottom"].includes(g.props.tabPosition))],ref:_,style:f.value,role:"tablist",onKeydown:$},[e.type?null:i(ft,{ref:n,tabs:[...e.panes]},null),p])])])}}}),pt=Y({type:{type:String,values:["card","border-card",""],default:""},closable:Boolean,addable:Boolean,modelValue:{type:[String,Number]},editable:Boolean,tabPosition:{type:String,values:["top","right","bottom","left"],default:"top"},beforeLeave:{type:ie(Function),default:()=>!0},stretch:Boolean}),oe=e=>Me(e)||Ae(e),gt={[Ce]:e=>oe(e),tabClick:(e,r)=>r instanceof Event,tabChange:e=>oe(e),edit:(e,r)=>["remove","add"].includes(r),tabRemove:e=>oe(e),tabAdd:()=>!0},ht=F({name:"ElTabs",props:pt,emits:gt,setup(e,{emit:r,slots:o,expose:g}){var s;const d=G("tabs"),y=H(()=>["left","right"].includes(e.tabPosition)),{children:c,addChild:_,removeChild:P}=Xe(ce(),"ElTabPane"),n=w(),v=w((s=e.modelValue)!=null?s:"0"),h=async(a,E=!1)=>{var T,L;if(!(v.value===a||ve(a)))try{let $;if(e.beforeLeave){const B=e.beforeLeave(a,v.value);$=B instanceof Promise?await B:B}else $=!0;$!==!1&&(v.value=a,E&&(r(Ce,a),r("tabChange",a)),(L=(T=n.value)==null?void 0:T.removeFocus)==null||L.call(T))}catch{}},u=(a,E,T)=>{a.props.disabled||(h(E,!0),r("tabClick",a,T))},m=(a,E)=>{a.props.disabled||ve(a.props.name)||(E.stopPropagation(),r("edit",a.props.name,"remove"),r("tabRemove",a.props.name))},t=()=>{r("edit",void 0,"add"),r("tabAdd")};M(()=>e.modelValue,a=>h(a)),M(v,async()=>{var a;await de(),(a=n.value)==null||a.scrollToActiveTab()}),Ke(J,{props:e,currentName:v,registerPane:a=>{c.value.push(a)},sortPane:_,unregisterPane:P}),g({currentName:v});const f=({render:a})=>a();return()=>{const a=o["add-icon"],E=e.editable||e.addable?i("div",{class:[d.e("new-tab"),y.value&&d.e("new-tab-vertical")],tabindex:"0",onClick:t,onKeydown:$=>{[U.enter,U.numpadEnter].includes($.code)&&t()}},[a?X(o,"add-icon"):i(W,{class:d.is("icon-plus")},{default:()=>[i(Re,null,null)]})]):null,T=i("div",{class:[d.e("header"),y.value&&d.e("header-vertical"),d.is(e.tabPosition)]},[i(f,{render:()=>{const $=c.value.some(B=>B.slots.label);return i(mt,{ref:n,currentName:v.value,editable:e.editable,type:e.type,panes:c.value,stretch:e.stretch,onTabClick:u,onTabRemove:m},{$stable:!$})}},null),E]),L=i("div",{class:d.e("content")},[X(o,"default")]);return i("div",{class:[d.b(),d.m(e.tabPosition),{[d.m("card")]:e.type==="card",[d.m("border-card")]:e.type==="border-card"}]},[L,T])}}});var yt=ht;const _t=Y({label:{type:String,default:""},name:{type:[String,Number]},closable:Boolean,disabled:Boolean,lazy:Boolean}),Ne="ElTabPane",wt=F({name:Ne}),Ct=F({...wt,props:_t,setup(e){const r=e,o=ce(),g=He(),s=ue(J);s||re(Ne,"usage: <el-tabs><el-tab-pane /></el-tabs/>");const d=G("tab-pane"),y=w(),c=H(()=>r.closable||s.props.closable),_=me(()=>{var u;return s.currentName.value===((u=r.name)!=null?u:y.value)}),P=w(_.value),n=H(()=>{var u;return(u=r.name)!=null?u:y.value}),v=me(()=>!r.lazy||P.value||_.value);M(_,u=>{u&&(P.value=!0)});const h=qe({uid:o.uid,slots:g,props:r,paneName:n,active:_,index:y,isClosable:c});return s.registerPane(h),be(()=>{s.sortPane(h)}),we(()=>{s.unregisterPane(h.uid)}),(u,m)=>N(v)?Qe((S(),D("div",{key:0,id:`pane-${N(n)}`,class:_e(N(d).b()),role:"tabpanel","aria-hidden":!N(_),"aria-labelledby":`tab-${N(n)}`},[X(u.$slots,"default")],10,["id","aria-hidden","aria-labelledby"])),[[We,N(_)]]):A("v-if",!0)}});var Te=he(Ct,[["__file","tab-pane.vue"]]);const Jt=ze(yt,{TabPane:Te}),Zt=Fe(Te);const Pt=F({__name:"ImgDetectionFence",props:{visible:{type:Boolean},files:{},fileLabels:{},setInfo:{type:Function},hideBar:{type:Boolean}},emits:["update:visible"],setup(e,{emit:r}){const o=e,g=r,s=H({get:()=>o.visible,set:d=>g("update:visible",d)});return(d,y)=>(S(),K($e,{class:"bg-info",ref:"contentRef",style:{"min-width":"60vw","max-width":"1080px"}},{default:R(()=>[Q("div",{style:fe({minWidth:"1080px",height:o.hideBar?"600px":"630px",overflow:"hidden"})},[o.hideBar?A("",!0):(S(),K(Ye,{key:0,class:"bg-primary"},{default:R(()=>[i(Ge),i(Pe,{flat:"",round:"",dense:"",icon:"close",onClick:y[0]||(y[0]=c=>s.value=!1),size:"sm"})]),_:1})),i(Je,{class:"q-pa-none"},{default:R(()=>[o.files[0]&&o.visible?(S(),K(it,{key:"ImgDetectionPartition",img:o.files[0].url,"set-info":o.setInfo,width:800,height:600,fileLabels:o.fileLabels,initArray:[0],"single-image":"","is-zoom-out":"","same-label-allow":!1,"show-label-action":!1,"default-tool":"rect","visible-tools":["move","rect","circle","poly","pen","polygon","eraser"]},null,8,["img","set-info","fileLabels"])):A("",!0)]),_:1})],4)]),_:1},512))}}),$t={style:{display:"inline-block","vertical-align":"top"}},St={key:0},Nt={key:1,class:"text-red"},Tt={key:0},xt={key:1},kt=["src"],Et=F({__name:"ImgDetectionPartition",props:{labelLength:{type:Number,default:0},setInfo:{type:Function,default:()=>{}},fileLabels:{type:Array,default:()=>[]},imgUrl:{type:String,default:""}},setup(e,{expose:r}){const o=e,g=at(),s=nt(),d=w(""),y=w(!1),c=w([]),_=t=>{d.value=t.url,y.value=!0},P=(t,f)=>{console.log(t,f)},n=w(!1);M([()=>o.labelLength,n],()=>{if(g.resetLabel(),n.value)for(let t=0;t<o.labelLength;t++)g.addLabel(`Part ${t+1}`,ot.Util.getRandomColor())});const v=async t=>{if(t.length!==o.labelLength){le(q.global.t("Hint.SetAllPartitionLabels"));return}try{await o.setInfo(t),lt(q.global.t("SettingSuccess")),n.value=!1}catch(f){console.log(f),le(q.global.t("SettingFailed"))}},h=t=>{if(!c.value.length){le(q.global.t("UploadImageConfigureFirst"));return}n.value=t};we(()=>{d.value.startsWith("blob:")&&URL.revokeObjectURL(d.value),g.resetImage([])}),r({open:h});const u=async()=>{g.labelImgs.some(f=>f.isActive)?await st({message:q.global.t("Hint.UnsavedChangesConfirmation"),onOk:async()=>{n.value=!1},onCancel:async()=>{n.value=!0}}):n.value=!1},m=w(!1);return be(async()=>{o.imgUrl&&(m.value=!0,c.value=[{name:"img",url:o.imgUrl}])}),(t,f)=>(S(),D("div",null,[Q("span",$t,[m.value?(S(),D("div",St,[N(s).cameraList.length===0?(S(),K(N(et),{key:0,type:"warning",title:t.$t("Hint.AddCameraFirst"),center:"","show-icon":"",closable:!1},null,8,["title"])):A("",!0)])):A("",!0),m.value?A("",!0):(S(),K(N(Ze),{key:1,class:"upload-drag-img limit-one","file-list":c.value,"onUpdate:fileList":f[0]||(f[0]=a=>c.value=a),"list-type":"picture-card","auto-upload":!1,"on-preview":_,"on-remove":P,limit:1,drag:""},{tip:R(()=>f[4]||(f[4]=[Q("div",{class:"q-mb-sm"},null,-1)])),default:R(()=>[i(N(W),null,{default:R(()=>[i(N(tt))]),_:1})]),_:1},8,["file-list"]))]),Q("span",{class:"q-mb-sm",style:fe([{display:"inline-flex","flex-direction":"column","align-items":"baseline","align-content":"space-between","justify-content":"space-between","flex-wrap":"wrap",gap:"10px"},{flexDirection:m.value?"row":"column"}])},[X(t.$slots,"default",{},void 0,!0),c.value.length?(S(),K(Pe,{key:0,onClick:f[1]||(f[1]=a=>n.value=!0),color:"primary"},{default:R(()=>[je(se(t.$t("AreaSettings")),1)]),_:1})):A("",!0),c.value.length?A("",!0):(S(),D("div",Nt,[m.value?(S(),D("p",xt,se(t.$t("Hint.AddCameraFirst")),1)):(S(),D("p",Tt,se(t.$t("UploadImageConfigureFirst")),1))]))],4),i(pe,{modelValue:y.value,"onUpdate:modelValue":f[2]||(f[2]=a=>y.value=a)},{default:R(()=>[i($e,null,{default:R(()=>[Q("img",{"w-full":"",src:d.value,alt:"Preview Image"},null,8,kt)]),_:1})]),_:1},8,["modelValue"]),i(pe,{"model-value":n.value,"onUpdate:modelValue":u,"transition-show":"slide-left","transition-hide":"slide-right",position:"right",maximized:t.$q.screen.lt.sm},{default:R(()=>[n.value?(S(),K(Pt,{key:0,visible:n.value,"onUpdate:visible":f[3]||(f[3]=a=>n.value=a),files:c.value,fileLabels:e.fileLabels,setInfo:v},null,8,["visible","files","fileLabels"])):A("",!0)]),_:1},8,["model-value","maximized"])]))}});const ea=rt(Et,[["__scopeId","data-v-ad442bd0"]]);export{Zt as E,ea as I,Jt as a};
