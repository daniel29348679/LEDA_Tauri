import"./base-23d00206.js";import{a as G,E as ne}from"./el-menu-item-f0bf8d57.js";import"./el-tooltip-4ed993c7.js";import"./el-scrollbar-e3b486eb.js";/* empty css                  */import{a as V,E as ue}from"./el-main-e0dc383b.js";import{E as me}from"./el-input-51d05b2a.js";import{E as A}from"./el-input-number-815f9c07.js";import{a as U}from"./el-button-ded9ecc1.js";/* empty css                */import{E as c,a as O}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as L,a as I}from"./el-select-99a9cb58.js";import{E as T,a as Q}from"./el-steps-c8cdef54.js";import{E as de}from"./el-alert-65b82b76.js";import{d as pe,o as fe}from"./@element-plus-a8abf029.js";import{_ as ce}from"./UploadFile.vue_vue_type_script_setup_true_lang-d804558e.js";import{u as W,i as F,o as J,e as Z,f as P}from"./index-d07dfee2.js";import{y as q,h as H,b as p,p as C,o as f,c as M,a as k,ag as l,bI as t,u as e,a7 as w,a8 as h,af as $,bf as b,d as ve,B as R,bC as B,S as x,b0 as _e}from"./@vue-19632928.js";import{b as X}from"./quasar-ff3737c6.js";import{E as be,a as Y}from"./el-radio-button-3d6852d2.js";import{E as K}from"./el-switch-30a59a69.js";import{I as ge}from"./InferImg-e3b2bb14.js";import{_ as ye}from"./InferCamera.vue_vue_type_script_setup_true_lang-05a521fb.js";import{a as $e}from"./label-61e62ece.js";import{u as Ve}from"./weight-5b7ac0f0.js";import{_ as we}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./@vueuse-0d360189.js";import"./index-b8931eed.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./typescript-defaf979.js";import"./vnode-18f2a975.js";import"./index-6127babd.js";import"./index-711061c4.js";import"./event-9519ab40.js";import"./index-32075738.js";import"./async-validator-dee29e8b.js";import"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import"./use-dialog-b8544ca4.js";import"./refs-e3a131a0.js";import"./el-divider-67eeba91.js";import"./el-checkbox-d46297b7.js";import"./uploadFile-6ce60004.js";import"./pinia-71cafef5.js";import"./StashSelect-5af938b3.js";import"./stashSpace-391fdb88.js";import"./validator-7d68535e.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./el-popover-74fee5eb.js";import"./dropdown-c44bb395.js";import"./el-image-viewer-1a9f012d.js";import"./el-table-column-5047dc3a.js";import"./normalize-wheel-es-ed76fb12.js";import"./el-slider-07e60acd.js";import"./ResultImgWithStash-c075e0f0.js";import"./el-card-a6aa41d5.js";import"./CameraOpen-7e226201.js";import"./el-row-67417f48.js";import"./decimal.js-d133ee8e.js";import"./jsoneditor-5f1e2c9e.js";const Ee={class:"step-page"},he={class:"step-nav"},Se=q({__name:"AnomalyTrainView",setup(j){const _=W();H(()=>{console.log("AD Train")});const v=p(),m=p(1),s=C({model_name:"",device:"cpu",crop_m:1,crop_n:1}),E=C({model_name:[{required:!0,message:F.global.t("NoModelName"),trigger:"blur"}]}),S=async o=>{o&&await o.validate(async(n,d)=>{if(n){console.log("submitTrain!"),console.log(s);const z=J();await g(),u(),z.close()}else console.log("error submitTrain!",d)})},g=async()=>{const o=await Z("json","/api/train_ad",s);if(console.log("res =>",o),o==null)return;const n=await o.data;if(console.log("result =>",n),n.code!==0){P(`API Error: ${n.code}`);return}},y=o=>{o&&o.resetFields()},u=o=>{s.folder_path=o??void 0,m.value++};return(o,n)=>(f(),M("div",Ee,[k("div",he,[l(e(Q),{class:"steps",active:m.value,"finish-status":"success",direction:e(_).lt.md?"horizontal":"vertical"},{default:t(()=>[l(e(T),{title:o.$t("Upload"),icon:e(pe)},null,8,["title","icon"]),l(e(T),{title:o.$t("Training"),icon:e(fe)},null,8,["title","icon"])]),_:1},8,["active","direction"])]),l(e(V),null,{default:t(()=>[m.value===1?(f(),w(e(V),{key:0},{default:t(()=>[l(ce,{api:"/api/upload_ad_train",click:u,type:"image","exist-stash-space":""})]),_:1})):h("",!0),m.value===2?(f(),w(e(O),{key:1,ref_key:"ruleFormRef",ref:v,model:s,rules:E,"label-width":"150px","label-position":"left",class:"demo-ruleForm","status-icon":""},{default:t(()=>[l(e(c),{label:o.$t("ModelName"),prop:"model_name"},{default:t(()=>[l(e(me),{modelValue:s.model_name,"onUpdate:modelValue":n[0]||(n[0]=d=>s.model_name=d)},null,8,["modelValue"])]),_:1},8,["label"]),l(e(c),{label:o.$t("Device")},{default:t(()=>[l(e(L),{modelValue:s.device,"onUpdate:modelValue":n[1]||(n[1]=d=>s.device=d)},{default:t(()=>[l(e(I),{label:"cpu",value:"cpu"}),l(e(I),{label:"cuda",value:"cuda"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(e(c),{label:o.$t("CropX")},{default:t(()=>[l(e(A),{modelValue:s.crop_m,"onUpdate:modelValue":n[2]||(n[2]=d=>s.crop_m=d),min:1},null,8,["modelValue"])]),_:1},8,["label"]),l(e(c),{label:o.$t("CropY")},{default:t(()=>[l(e(A),{modelValue:s.crop_n,"onUpdate:modelValue":n[3]||(n[3]=d=>s.crop_n=d),min:1},null,8,["modelValue"])]),_:1},8,["label"]),l(e(c),null,{default:t(()=>[l(e(U),{type:"primary",onClick:n[4]||(n[4]=d=>S(v.value))},{default:t(()=>[$(b(o.$t("Training")),1)]),_:1}),l(e(U),{onClick:n[5]||(n[5]=d=>y(v.value))},{default:t(()=>[$(b(o.$t("Reset")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])):h("",!0),m.value===3?(f(),w(e(V),{key:2,style:{height:"10vh"}},{default:t(()=>[l(e(de),{title:o.$t("FinishTrain"),type:"success",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):h("",!0)]),_:1})]))}}),ke={class:"step-page"},Ie={class:"step-nav"},Ce={class:"form-infer-content"},Fe={class:"left"},Ae={style:{width:"100%"}},Ue=q({__name:"AnomalyInferView",setup(j){const _=W(),v=Ve();H(()=>{console.log("AD Infer"),d()});const m=p(),s=p(1),E=p(0),S=p(F.global.t("Upload")),g=p(!0),y=p("map_score"),u=C({model_name:"",device:"cpu",crop_m:1,crop_n:1}),o=C({model_name:"",alert_area:void 0,w_h_a:void 0,filter_type:"w_h",isPartitionFilter:!1,isSizeFilter:!1}),n=C({model_name:[{required:!0,message:F.global.t("NoModelName"),trigger:"blur"}]}),d=async()=>{await v.getListdirs("AD"),u.model_name=v.modelList.length>0?v.modelList[0]:""},z=async r=>{var a,i;if(((a=o.w_h_a)==null?void 0:a.length)!==((i=o.alert_area)==null?void 0:i.length)){P(F.global.t("Hint.SetAllPartitionLabels"));return}r&&await r.validate(async(N,ie)=>{if(N){console.log("submit!"),console.log(u);const se=J();await ee(),te(),se.close()}else console.log("error submit!",ie)})},ee=async()=>{let r={};o.isSizeFilter&&(r={filter_type:o.filter_type,w_h_a:o.w_h_a,alert_area:o.alert_area});const a=await Z("json","/api/init_ad",{...u,...r});if(console.log("res =>",a),a==null)return;const i=await a.data;if(console.log("result =>",i),i.code!==0){P(`API Error: ${i.code}`);return}E.value=i.result.threshold,console.log("threshold =>",E)},D=p(!1),le=p(!1);ve([()=>g.value,()=>y.value],([r,a])=>{r&&a||(D.value=!1)});const te=()=>{s.value++},ae=p([]),oe=p("0"),re=()=>{u.device="cpu",u.crop_m=1,u.crop_n=1,g.value=!1,y.value="image_score",D.value=!1,le.value=!1,o.w_h_a=[[]],o.alert_area=[$e],oe.value="0",s.value=1,ae.value=[]};return(r,a)=>(f(),M("div",ke,[k("div",Ie,[l(e(Q),{active:s.value,"finish-status":"success",class:"w3-margin-bottom",direction:e(_).lt.md?"horizontal":"vertical"},{default:t(()=>[l(e(T),{title:r.$t("ModelSet"),onClick:a[0]||(a[0]=i=>s.value=1),class:"pointer"},{icon:t(()=>[l(X,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),l(e(T),{title:r.$t("Inference"),onClick:a[1]||(a[1]=i=>s.value=E.value>0?2:1),class:"pointer"},{icon:t(()=>[l(X,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),l(e(V),null,{default:t(()=>[l(e(V),null,{default:t(()=>[R(l(e(O),{ref_key:"ruleFormRef",ref:m,model:u,rules:n,"label-width":"150px","label-position":"left",class:"form-infer-wrap","status-icon":""},{default:t(()=>[k("div",Ce,[k("div",Fe,[l(e(c),{label:r.$t("ModelName")},{default:t(()=>[l(e(L),{modelValue:u.model_name,"onUpdate:modelValue":a[2]||(a[2]=i=>u.model_name=i)},{default:t(()=>[(f(!0),M(x,null,_e(e(v).modelList,(i,N)=>(f(),w(e(I),{label:i,value:i,key:N},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(e(c),{label:r.$t("Device")},{default:t(()=>[l(e(L),{modelValue:u.device,"onUpdate:modelValue":a[3]||(a[3]=i=>u.device=i)},{default:t(()=>[l(e(I),{label:"cpu",value:"cpu"}),l(e(I),{label:"cuda",value:"cuda"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(e(c),{label:r.$t("CropX")},{default:t(()=>[l(e(A),{modelValue:u.crop_m,"onUpdate:modelValue":a[4]||(a[4]=i=>u.crop_m=i),min:1},null,8,["modelValue"])]),_:1},8,["label"]),l(e(c),{label:r.$t("CropY")},{default:t(()=>[l(e(A),{modelValue:u.crop_n,"onUpdate:modelValue":a[5]||(a[5]=i=>u.crop_n=i),min:1},null,8,["modelValue"])]),_:1},8,["label"]),l(e(c),{label:r.$t("ResultImgType")},{default:t(()=>[l(e(K),{modelValue:g.value,"onUpdate:modelValue":a[6]||(a[6]=i=>g.value=i),size:"large","active-text":r.$t("Box"),"inactive-text":r.$t("HeatmapMask")},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"]),l(e(c),{label:r.$t("ResultScoreType")},{default:t(()=>[l(e(K),{modelValue:y.value,"onUpdate:modelValue":a[7]||(a[7]=i=>y.value=i),size:"large","active-text":r.$t("MapScore"),"inactive-text":r.$t("ImgScore"),"active-value":"map_score","inactive-value":"image_score",onChange:a[8]||(a[8]=()=>{D.value=!1})},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])])]),k("div",Ae,[l(e(U),{type:"primary",onClick:a[9]||(a[9]=i=>z(m.value))},{default:t(()=>[$(b(r.$t("ModelSet")),1)]),_:1}),s.value===1?(f(),w(e(U),{key:0,link:"",class:"q-ml-md",onClick:re},{default:t(()=>[$(b(r.$t("Reset")),1)]),_:1})):h("",!0)])]),_:1},8,["model","rules"]),[[B,s.value===1]]),s.value===2?(f(),w(e(V),{key:0},{default:t(()=>[l(e(ue),{style:{padding:"0"}},{default:t(()=>[l(e(be),{modelValue:S.value,"onUpdate:modelValue":a[10]||(a[10]=i=>S.value=i)},{default:t(()=>[l(e(Y),{label:r.$t("Upload")},{default:t(()=>[$(b(r.$t("Upload")),1)]),_:1},8,["label"]),l(e(Y),{label:r.$t("Camera")},{default:t(()=>[$(b(r.$t("Camera")),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),R(l(ge,{infer_kernel:"ad",threshold:E.value,draw_box:g.value,score_type:y.value},null,8,["threshold","draw_box","score_type"]),[[B,S.value===r.$t("Upload")]]),R(l(ye,{infer_kernel:"ad",threshold:E.value,draw_box:g.value,score_type:y.value},null,8,["threshold","draw_box","score_type"]),[[B,S.value===r.$t("Camera")]])]),_:1})):h("",!0)]),_:1})]),_:1})]))}});const Te=we(Ue,[["__scopeId","data-v-28160493"]]),et=q({__name:"AnomalyView",setup(j){H(()=>{console.log("AD")});const _=p("0"),v=(m,s)=>{console.log(m,s),_.value=m,console.log(_.value)};return(m,s)=>(f(),M(x,null,[k("h4",null,b(m.$t("Kernel.AD")),1),l(e(ne),{"default-active":_.value,class:"el-menu-demo w3-margin-bottom",mode:"horizontal",ellipsis:!1,onSelect:v},{default:t(()=>[l(e(G),{index:"0"},{default:t(()=>[$(b(m.$t("Training")),1)]),_:1}),l(e(G),{index:"1"},{default:t(()=>[$(b(m.$t("Inference")),1)]),_:1})]),_:1},8,["default-active"]),_.value==="0"?(f(),w(e(V),{key:0},{default:t(()=>[l(Se)]),_:1})):h("",!0),_.value==="1"?(f(),w(e(V),{key:1},{default:t(()=>[l(Te)]),_:1})):h("",!0)],64))}});export{et as default};
