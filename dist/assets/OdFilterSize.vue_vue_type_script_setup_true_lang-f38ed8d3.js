import{o as Z}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as x}from"./el-button-ded9ecc1.js";import{E as y}from"./el-form-item-62aac1b2.js";import"./el-input-51d05b2a.js";import{E as S}from"./el-input-number-815f9c07.js";import{I as ee,E as le,a as ae}from"./ImgDetectionPartition-4a04bf44.js";import{E as k}from"./el-switch-30a59a69.js";import{u as te,o as oe,f as re,i as B}from"./index-d07dfee2.js";import{b as se}from"./earthApi-baaacd65.js";import{h as ne,a as A,j as ie}from"./label-61e62ece.js";import{_ as I}from"./lodash-3dc9162a.js";import{y as ue,i as me,b as c,c as V,ag as i,bI as m,u as o,a7 as v,a8 as p,S as E,o as u,af as _,bf as h,aN as U,b0 as O,aP as fe,a as P}from"./@vue-19632928.js";const de={key:3},ce={key:0},Ce=ue({__name:"OdFilterSize",props:{initOD:{type:Function},model_name:{},formInfer:{},name:{},height:{},imgUrl:{},hideFilterSize:{type:Boolean},isLoad:{type:Boolean},showDrawAlertArea:{type:Boolean}},emits:["update:formInfer"],setup(q,{expose:G,emit:H}){const n=q,R=H,e=me({get:()=>n.formInfer,set:l=>R("update:formInfer",l)}),D=te(),N=c([]),f=c("0"),F=c(0),z=c(0),b=c([]),W=()=>{if(!e.value.cls_w_h)return;const l=e.value.cls_w_h.length.toString();e.value.cls_w_h.push(I(b.value)),f.value=l},J=l=>{var r;if(!e.value.cls_w_h||e.value.cls_w_h.length===1)return;const a=e.value.cls_w_h,t=l;a.splice(t,1),(r=e.value.alert_area)==null||r.splice(t,1),t==0&&(f.value="0"),f.value===a.length.toString()&&(f.value=(a.length-1).toString())},j=l=>{e.value.cls_w_h&&e.value.cls_w_h[l].forEach(a=>{a.w=F.value,a.h=z.value})},M=async l=>{var t,r,g;const a=oe();try{const s=await se.api.classNamesV8OdApiClassNamesOdPost({name:n.name||""});if(!s)return;const d=s.data;console.log("result =>",d);const Y=d.result.all_labels;if(b.value=Y.map(w=>({cls:w,w:0,h:0})),e.value.cls_w_h&&!l||(t=e.value)!=null&&t.cls_w_h&&JSON.stringify((r=e.value)==null?void 0:r.cls_w_h)===JSON.stringify([[]]))for(let w=0;w<((g=e.value.cls_w_h)==null?void 0:g.length);w++)e.value.cls_w_h&&(e.value.cls_w_h[w]=I(b.value));if(d.code!==0){re(`API Error: ${d.code}`);return}}finally{a.close()}},Q=()=>{e.value.cls_w_h=void 0,e.value.alert_area=void 0},C=()=>{e.value.alert_area&&(N.value=[{name:"test",labels:e.value.alert_area.map((l,a)=>({...ne(l),label:`Part ${a+1}`}))}])},$=async l=>{e.value.isSizeFilter=l,l&&await L(n.model_name,!0,n.isLoad)},K=l=>{if(e.value.isPartitionFilter=l,!l){e.value.alert_area=[A],e.value.cls_w_h=[[...b.value]],f.value="0";return}e.value.cls_w_h&&(e.value.cls_w_h=[I(e.value.cls_w_h[0])]),f.value="0",e.value.alert_area=[A],C()},L=async(l,a=!0,t=!1)=>{if(console.log("modelName =>",l),console.log("isInit =>",a),console.log("isLoadInfo =>",t),console.log("props.formInfer =>",n.formInfer),l===""){Q();return}a&&(e.value.cls_w_h=[I(b.value)],e.value.alert_area=[A],await n.initOD()),console.log("props.formInfer 1=>",n.formInfer),f.value="0",await M(t),console.log("props.formInfer 2=>",n.formInfer)},X=async l=>{await l.forEach(a=>{var r;if(!e.value.alert_area)return;const t=(r=a.label.match(/\d+/))==null?void 0:r[0];t!=null&&(e.value.alert_area[+t-1]=ie(a))}),C()},T=c();return G({onChangeModelName:L,onChangeSizeFilter:$,handlePartLabel:C,openImgDetectionPartition:()=>{var l;(l=T.value)==null||l.open()}}),(l,a)=>(u(),V(E,null,[i(o(y),{label:l.$t("FilterSize"),"label-width":"auto"},{default:m(()=>[i(o(k),{modelValue:e.value.isSizeFilter,"onUpdate:modelValue":a[0]||(a[0]=t=>e.value.isSizeFilter=t),onChange:a[1]||(a[1]=t=>$(t))},null,8,["modelValue"])]),_:1},8,["label"]),e.value.isSizeFilter&&n.showDrawAlertArea?(u(),v(o(y),{key:0,label:l.$t("DrawAlertArea"),"label-width":"auto"},{default:m(()=>[i(o(k),{modelValue:e.value.draw_alert_area,"onUpdate:modelValue":a[2]||(a[2]=t=>e.value.draw_alert_area=t)},null,8,["modelValue"])]),_:1},8,["label"])):p("",!0),e.value.isSizeFilter?(u(),v(o(y),{key:1,label:l.$t("FilterPartition"),"label-width":"auto"},{default:m(()=>[i(o(k),{modelValue:e.value.isPartitionFilter,"onUpdate:modelValue":a[3]||(a[3]=t=>e.value.isPartitionFilter=t),"active-text":o(B).global.t("Partition"),"inactive-text":o(B).global.t("Global"),onChange:a[4]||(a[4]=t=>K(t))},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])):p("",!0),e.value.isSizeFilter&&e.value.isPartitionFilter&&l.formInfer.cls_w_h?(u(),v(ee,{key:"OD",ref_key:"imgDetectionPartitionRef",ref:T,"label-length":l.formInfer.cls_w_h.length,"file-labels":N.value,"set-info":X,"img-url":n.imgUrl},{default:m(()=>[i(o(x),{type:"primary",class:U({"q-ml-sm":!n.imgUrl}),onClick:W},{default:m(()=>[_(h(l.$t("AddPartition")),1)]),_:1},8,["class"])]),_:1},8,["label-length","file-labels","img-url"])):p("",!0),e.value.isSizeFilter?(u(),V("div",de,[l.formInfer.cls_w_h?(u(),v(o(ae),{key:0,modelValue:f.value,"onUpdate:modelValue":a[7]||(a[7]=t=>f.value=t),class:"q-mb-sm",type:"border-card",closable:e.value.isPartitionFilter,onTabRemove:J,style:{"max-width":"100%"}},{default:m(()=>[(u(!0),V(E,null,O(l.formInfer.cls_w_h,(t,r)=>(u(),v(o(le),{class:"setting-scroll scroll-bar",key:r.toString(),label:e.value.isPartitionFilter?l.$t("Partition")+(r+1):l.$t("Global"),name:r.toString(),style:fe({"max-height":n.height,"overflow-y":"auto","overflow-x":"hidden"})},{default:m(()=>{var g;return[((g=l.formInfer.cls_w_h[r])==null?void 0:g.length)>1?(u(),V("div",ce,[i(o(y),{class:"border-form setting"},{default:m(()=>[P("span",null,[_(h(l.$t("Width"))+"(px)： ",1),i(o(S),{modelValue:F.value,"onUpdate:modelValue":a[5]||(a[5]=s=>F.value=s),min:0,size:"small"},null,8,["modelValue"])]),P("span",{class:U({"ml-3":!o(D).lt.sm})},[_(h(l.$t("Height"))+"(px)： ",1),i(o(S),{modelValue:z.value,"onUpdate:modelValue":a[6]||(a[6]=s=>z.value=s),min:0,size:"small"},null,8,["modelValue"])],2),i(Z,{color:"primary",class:"q-ml-md",onClick:()=>{j(r)}},{default:m(()=>[_(h(l.$t("OneClickSetting")),1)]),_:2},1032,["onClick"])]),_:2},1024)])):p("",!0),(u(!0),V(E,null,O(l.formInfer.cls_w_h[r],s=>(u(),v(o(y),{class:"border-form",key:s.cls,label:s.cls},{default:m(()=>[P("span",null,[_(h(l.$t("Width"))+"(px)： ",1),i(o(S),{modelValue:s.w,"onUpdate:modelValue":d=>s.w=d,min:0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),P("span",{class:U({"ml-3":!o(D).lt.sm})},[_(h(l.$t("Height"))+"(px)： ",1),i(o(S),{modelValue:s.h,"onUpdate:modelValue":d=>s.h=d,min:0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])],2)]),_:2},1032,["label"]))),128))]}),_:2},1032,["label","name","style"]))),128))]),_:1},8,["modelValue","closable"])):p("",!0)])):p("",!0)],64))}});export{Ce as _};
