import{b as T}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as S}from"./el-button-ded9ecc1.js";import{E as m,a as z}from"./el-form-item-62aac1b2.js";/* empty css               */import{E,a as g}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as j}from"./el-divider-67eeba91.js";import{E as P,a as G}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as y}from"./el-main-e0dc383b.js";import{E as I}from"./el-alert-65b82b76.js";/* empty css                */import{E as J}from"./el-image-viewer-1a9f012d.js";import"./el-input-51d05b2a.js";import{E as h}from"./el-input-number-815f9c07.js";import{E as O}from"./el-switch-30a59a69.js";import{u as Z,i as C,f,o as q}from"./index-d07dfee2.js";import{b as x}from"./earthApi-baaacd65.js";import{u as ee}from"./app_camera-ba436274.js";import{u as te}from"./app_ad-1c08fdc8.js";import{y as ae,b as _,p as H,F as le,h as oe,c as $,a as L,bf as w,ag as o,u as e,bI as i,a7 as u,a8 as V,S as F,o as s,b0 as K,af as A}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./typescript-defaf979.js";import"./validator-7d68535e.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";const re={class:"step-page"},ie={class:"step-nav"},ne={key:0},tt=ae({__name:"AppAnomalyDetection",setup(se){const Q=Z(),d=ee(),n=te();let v=!1;const R=_(),N=_(),p=_(1),c=_([""]),l=H({model_name:"",cam_name:"",device:"cuda",draw_box:!1,score_type:"image_score",crop_m:1,crop_n:1,threshold:.7}),U=H({model_name:[{required:!0,message:C.global.t("NoModelName"),trigger:"blur"}],cam_name:[{required:!0,message:C.global.t("Label.PleaseSelect",{name:C.global.t("Label.Camera")}),trigger:"blur"}]}),B=async()=>{const t=await x.api.listdirsApiListdirsPost({model:"AD"});if(t===void 0||t.data.code===void 0){f("list od weights fail");return}const a=t.data;if(console.log("result =>",a),a.code!==0){f(`list od weights fail: ${a.code}`);return}c.value=a.result.folder_list,l.model_name=c.value.length>0?c.value[0]:""},D=async(t,a)=>{t&&await t.validate(async(r,b)=>{r?(console.log("submit!"),console.log(l),a?await W():(await X(),await M())):console.log("error submit!",b)})},W=async()=>{const t=q();try{const a=await n.startInfer(l.cam_name,l.threshold,l.draw_box,l.score_type);if(a!==0){f(`ad poc live inferencing fail : ${a}`);return}v=!0,await k()}finally{t.close()}},X=async()=>{const t=q();try{const a=await n.init(l.model_name,l.device,l.crop_m,l.crop_n);if(a!==0){f(`ad poc model init fail : ${a}`);return}}finally{t.close()}},Y=async()=>{await B(),p.value=1},M=async()=>{if(n.info.load){p.value=2;const t=await d.loadCameraList();if(t!==0){f(`load casmera list fail : ${t}`);return}d.cameraList.length>0&&l.cam_name===""&&(l.cam_name=d.cameraList[0].name);return}p.value=1},k=async()=>{if(!(!n.info.doing||!v))try{const t=await n.getInferResult();if(t!==0){f(`ad inference result API Error : ${t}`);return}}finally{setTimeout(k,40)}};return le(()=>v=!1),oe(async()=>{console.log("AD POC Infer");let t=await n.checkInfo();if(t!==0){f(`check ad poc info fail : ${t}`);return}if(!n.info.load){await B();return}if(p.value=2,l.threshold=n.info.threshold??l.threshold,l.draw_box=n.info.draw_box??l.draw_box,l.score_type=n.info.score_type??l.score_type,t=await d.loadCameraList(),t!==0&&f(`load casmera list fail : ${t}`),d.cameraList.length===0?l.cam_name="":n.info.cam_name!==""&&~d.cameraList.findIndex(a=>a.name===n.info.cam_name)?l.cam_name=n.info.cam_name:l.cam_name=d.cameraList[0].name,n.info.doing){v=!0,await k();return}}),(t,a)=>(s(),$(F,null,[L("h4",null,w(t.$t("Dashboard.AD")),1),o(e(j)),L("div",re,[L("div",ie,[o(e(G),{active:p.value,"finish-status":"success",class:"w3-margin-bottom",direction:e(Q).lt.md?"horizontal":"vertical"},{default:i(()=>[o(e(P),{title:t.$t("ModelSet"),onClick:a[0]||(a[0]=r=>Y()),class:"pointer"},{icon:i(()=>[o(T,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),o(e(P),{title:t.$t("Inference"),onClick:a[1]||(a[1]=r=>M()),class:"pointer"},{icon:i(()=>[o(T,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),p.value===1?(s(),u(e(y),{key:0},{default:i(()=>[c.value.length===0?(s(),u(e(y),{key:0,style:{height:"10vh"}},{default:i(()=>[o(e(I),{title:t.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(s(),u(e(y),{key:1},{default:i(()=>[o(e(z),{ref_key:"ruleFormRef",ref:R,model:l,rules:U,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[o(e(m),{label:t.$t("ModelName")},{default:i(()=>[o(e(E),{modelValue:l.model_name,"onUpdate:modelValue":a[2]||(a[2]=r=>l.model_name=r)},{default:i(()=>[(s(!0),$(F,null,K(c.value,(r,b)=>(s(),u(e(g),{label:r,value:r,key:b},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(e(m),{label:t.$t("Device")},{default:i(()=>[o(e(E),{modelValue:l.device,"onUpdate:modelValue":a[3]||(a[3]=r=>l.device=r)},{default:i(()=>[o(e(g),{label:"cpu",value:"cpu"}),o(e(g),{label:"cuda",value:"cuda"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(e(m),{label:t.$t("CropX")},{default:i(()=>[o(e(h),{modelValue:l.crop_m,"onUpdate:modelValue":a[4]||(a[4]=r=>l.crop_m=r),min:1},null,8,["modelValue"])]),_:1},8,["label"]),o(e(m),{label:t.$t("CropY")},{default:i(()=>[o(e(h),{modelValue:l.crop_n,"onUpdate:modelValue":a[5]||(a[5]=r=>l.crop_n=r),min:1},null,8,["modelValue"])]),_:1},8,["label"]),o(e(m),null,{default:i(()=>[o(e(S),{type:"primary",onClick:a[6]||(a[6]=r=>D(R.value,!1))},{default:i(()=>[A(w(t.$t("ModelSet")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),_:1})):V("",!0),p.value===2?(s(),u(e(y),{key:1},{default:i(()=>[e(n).info.doing?(s(),$("div",ne,[o(e(S),{type:"danger",onClick:a[7]||(a[7]=r=>e(n).stopInfer())},{default:i(()=>[A(w(t.$t("Button.Stop",{name:t.$t("Inference")})),1)]),_:1}),e(n).inferResult!==""?(s(),u(e(I),{key:0,title:e(n).inferResult,type:e(n).inferResult==="OK"?"success":"error",closable:!1},null,8,["title","type"])):V("",!0),o(e(J),{src:e(n).imgURL,"preview-src-list":[e(n).imgURL],fit:"scale-down"},null,8,["src","preview-src-list"])])):(s(),u(e(z),{key:1,ref_key:"inferFormRef",ref:N,model:l,rules:U,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[e(d).cameraList.length===0?(s(),u(e(I),{key:0,type:"warning",title:t.$t("Hint.AddCameraFirst"),center:"","show-icon":"",closable:!1},null,8,["title"])):V("",!0),o(e(m),{label:t.$t("Button.Select",{name:t.$t("Label.Camera")})},{default:i(()=>[o(e(E),{modelValue:l.cam_name,"onUpdate:modelValue":a[8]||(a[8]=r=>l.cam_name=r),filterable:"","no-data-text":"No camera",placeholder:"No camera"},{default:i(()=>[(s(!0),$(F,null,K(e(d).cameraList,(r,b)=>(s(),u(e(g),{label:`${r.name} (${r.cam_type==="cv"?r.src:r.cam_type})`,value:r.name,key:b},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(e(m),{label:t.$t("Threshold")},{default:i(()=>[o(e(h),{modelValue:l.threshold,"onUpdate:modelValue":a[9]||(a[9]=r=>l.threshold=r),precision:2,step:.01,disabled:e(n).info.doing},null,8,["modelValue","disabled"])]),_:1},8,["label"]),o(e(m),{label:t.$t("ResultImgType")},{default:i(()=>[o(e(O),{modelValue:l.draw_box,"onUpdate:modelValue":a[10]||(a[10]=r=>l.draw_box=r),size:"large","active-text":t.$t("Box"),"inactive-text":t.$t("HeatmapMask")},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"]),o(e(m),{label:t.$t("ResultScoreType")},{default:i(()=>[o(e(O),{modelValue:l.score_type,"onUpdate:modelValue":a[11]||(a[11]=r=>l.score_type=r),size:"large","active-text":t.$t("MapScore"),"inactive-text":t.$t("ImgScore"),"active-value":"map_score","inactive-value":"image_score"},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"]),o(e(m),null,{default:i(()=>[o(e(S),{type:"primary",onClick:a[12]||(a[12]=r=>D(N.value,!0)),disabled:l.cam_name===""},{default:i(()=>[A(w(t.$t("Button.Start",{name:t.$t("Inference")})),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"]))]),_:1})):V("",!0)])],64))}});export{tt as default};
