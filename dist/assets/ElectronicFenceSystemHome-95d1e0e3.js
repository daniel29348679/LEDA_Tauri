import"./base-23d00206.js";import{E as S,a as k}from"./el-row-67417f48.js";import{E as j}from"./el-card-a6aa41d5.js";import{E as D}from"./el-image-viewer-1a9f012d.js";import{E as x,a as O}from"./el-skeleton-item-b52dbad9.js";import{f as v,w as A}from"./index-d07dfee2.js";import{u as B}from"./app_efs-f5115dc2.js";import{Q as d}from"./QuartCard-b656d875.js";import{L as H}from"./vue-chartjs-22160128.js";import{C as N,p as T,a as U,b as V,P as $,c as P,d as Q,e as K}from"./chart.js-1176e628.js";import{y as M,b as u,h as Z,F as q,c as z,ag as e,bI as i,u as o,S as G,o as J,a as W}from"./@vue-19632928.js";import{_ as X}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./typescript-defaf979.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./quasar-ff3737c6.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./@kurkle-36ca2f10.js";import"./jsoneditor-5f1e2c9e.js";const m=30,Y=M({__name:"ElectronicFenceSystemHome",setup(ee){N.register(T,U,V,$,P,Q,K);const f=["rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(201, 203, 207)","rgb(153, 102, 255)","rgb(255, 159, 64)","rgb(54, 162, 235)","rgb(255, 99, 132)"];let g=!1,l=[],r=[],s=[];const a=B(),p=u(""),h=u(0),_=u(0),b=u({labels:[],datasets:[]}),I=u({responsive:!0,animation:{duration:t=>t.dataIndex===m-1?600:0},animations:{},scales:{y:{beginAtZero:!0,stacked:!0}},interaction:{intersect:!1,mode:"index"}}),R=()=>{console.log("efs result => ",s),console.log("objects => ",l),console.log("timeline => ",r);const t=r.map(c=>c.toLocaleTimeString()),n=l.map((c,w)=>({label:c,fill:!0,backgroundColor:f[w%f.length],borderColor:f[w%f.length],data:r.map((te,E)=>{const C=s[E].findIndex(F=>F.label===c);return~C?s[E][C].number:0})}));return{labels:t,datasets:n}},L=async()=>{try{let t=await a.checkInfo();if(t!==0){v(`check od poc info fail : ${t}`);return}if(a.info.load||A("請先至後台設定電子圍籬應用"),a.info.doing){if(p.value=a.imgURL,t=await a.getInferResult(),t!==0){v(`get live inference result fail: ${t}`);return}if(a.inferResult){s.push(a.inferResult),s.length>m&&(s=s.slice(1,m+1)),l.push(...a.inferResult.map(n=>n.label)),l=l.filter((n,c)=>l.indexOf(n)===c),r.push(new Date),r.length>m&&(r=r.slice(1,m+1)),h.value=l.length,_.value=0;for(const n of a.inferResult)_.value+=n.number;b.value=R()}}}catch(t){v(`get live inference result fail: ${t}`)}},y=async()=>{g&&(await L(),setTimeout(()=>y(),1e3))};return Z(async()=>{console.log("電子圍籬應用 mounted"),g=!0,await y()}),q(async()=>{console.log("電子圍籬應用 unmounted"),g=!1}),(t,n)=>(J(),z(G,null,[e(o(S),{gutter:16,class:"w3-margin-top"},{default:i(()=>[e(d,{title:"Counting Numbers",value:_.value,diff:"2%",color:"red",info:"since last week",icon:""},null,8,["value"]),e(d,{title:"Specification",value:h.value,diff:"0.75%",color:"green",info:"since yesterday",icon:""},null,8,["value"]),e(d,{title:"Cameras Online",value:"1",diff:"OK",color:"green",info:"All systems are",suffix:""}),e(d,{title:"Vilolations",value:"8",diff:"2%",color:"red",info:"since last week",icon:""})]),_:1}),e(o(S),{gutter:16,class:"w3-margin-top"},{default:i(()=>[e(o(k),{span:10},{default:i(()=>[e(o(j),null,{default:i(()=>[n[0]||(n[0]=W("b",null,"Timeline Statistics",-1)),e(o(x),{rows:4,style:{height:"100%"},loading:!o(a).info.doing,throttle:500,animated:""},{default:i(()=>[e(o(H),{data:b.value,options:I.value},null,8,["data","options"])]),_:1},8,["loading"])]),_:1})]),_:1}),e(o(k),{span:14},{default:i(()=>[e(o(x),{style:{height:"100%"},loading:!o(a).info.doing||p.value==="",throttle:500,animated:""},{template:i(()=>[e(o(O),{variant:"image",style:{height:"100%"}})]),default:i(()=>[e(o(D),{src:p.value,"preview-src-list":[p.value]},null,8,["src","preview-src-list"])]),_:1},8,["loading"])]),_:1})]),_:1})],64))}});const Oe=X(Y,[["__scopeId","data-v-3d621f3d"]]);export{Oe as default};
