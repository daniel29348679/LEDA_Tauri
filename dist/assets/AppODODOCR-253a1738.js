import{b as Q}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as V}from"./el-button-ded9ecc1.js";import{E as b,a as W}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as A,a as M}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as te}from"./el-divider-67eeba91.js";import{E as j,a as ae}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as w}from"./el-main-e0dc383b.js";import{E as U}from"./el-alert-65b82b76.js";/* empty css                */import{E as oe}from"./el-image-viewer-1a9f012d.js";import{E as J}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import"./el-input-number-815f9c07.js";import"./el-tooltip-4ed993c7.js";import{E as le}from"./el-switch-30a59a69.js";import{u as re,i as F,f as c,o as K}from"./index-d07dfee2.js";import{b as h}from"./earthApi-baaacd65.js";import{u as ie}from"./app_camera-ba436274.js";import{d as ne}from"./pinia-71cafef5.js";import{b as _,y as se,p as X,F as de,h as me,c as O,a as N,bf as C,ag as i,u as a,bI as n,a7 as f,a8 as S,S as L,o as d,b0 as B,af as P}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./typescript-defaf979.js";import"./validator-7d68535e.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";const $="poc-ododocr",T="ts_poc_ododocr",ue=ne("app-ododocr",()=>{const I=_({load:!1}),k=_(""),u=_(),s=async(r,m)=>{const o=await h.api.initOdodocrApiInitOdodocrPost({name:$,model_name_string:r,model_name_alphabet:m});return o==null||o.data.code==null?-1:o.data.code!==0?o.data.code:await p()},p=async()=>{const r=await h.api.infoOdodocrApiInfoOdodocrGet({name:$});if(console.log("res =>",r),r===void 0||r.data.code===void 0)return-1;if(r.data.code!==0)return r.data.code;if(I.value=r.data.result,r.data.result.doing&&r.data.result.result_image){let m=localStorage.getItem(T)??"";m===""&&(m=`${Date.now()}`,localStorage.setItem(T,m)),k.value=r.data.result.result_image+`&t=${m}`}return 0};return{info:I,imgURL:k,inferResult:u,init:s,checkInfo:p,startInfer:async(r,m,o)=>{const v=await h.api.startLiveInferOdodocrApiStartLiveInferOdodocrPost({name:$,cam_name:r,threshold_string:m,threshold_alphabet:o});return console.log("res =>",v),v===void 0||v.data.code===void 0?-1:v.data.code!==0?v.data.code:await p()},stopInfer:async()=>{const r=await h.api.stopLiveInferOdodocrApiStopLiveInferOdodocrPost({name:$});return console.log("res =>",r),r===void 0||r.data.code===void 0?-1:r.data.code!==0?r.data.code:(localStorage.removeItem(T),I.value.doing=!1,0)},getInferResult:async()=>{const r=await h.api.inferOdodocrLiveResultApiInferOdodocrLiveResultGet({name:$});return console.log("res =>",r),r===void 0||r.data.code===void 0?-1:r.data.code!==0?r.data.code:(u.value=r.data.result.last_result,0)}}}),fe={class:"step-page"},ce={class:"step-nav"},pe={key:0},st=se({__name:"AppODODOCR",setup(I){const k=re(),u=ie(),s=ue();let p=!1;const R=_(),D=_(),g=_(1),r=_([""]),m=_([""]),o=X({isUseStringModel:!1,model_name_string:"",model_name_alphabet:"",cam_name:"",threshold_string:.7,threshold_alphabet:.7}),v=X({model_name_alphabet:[{required:!0,message:F.global.t("NoModelName"),trigger:"blur"}],cam_name:[{required:!0,message:F.global.t("Label.PleaseSelect",{name:F.global.t("Label.Camera")}),trigger:"blur"}]}),q=async()=>{const e=await h.api.listdirsApiListdirsPost({model:"OD"});if(e===void 0||e.data.code===void 0){c("list od weights fail");return}const t=e.data;if(console.log("result =>",t),t.code!==0){c(`list od weights fail: ${t.code}`);return}r.value=t.result.folder_list,o.model_name_string=r.value.length>0?r.value[0]:""},z=async()=>{const e=await h.api.listdirsApiListdirsPost({model:"OD"});if(e===void 0||e.data.code===void 0){c("list od weights fail");return}const t=e.data;if(console.log("result =>",t),t.code!==0){c(`list od weights fail: ${t.code}`);return}m.value=t.result.folder_list,o.model_name_alphabet=m.value.length>0?m.value[0]:""},G=async(e,t)=>{e&&await e.validate(async(l,y)=>{l?(console.log("submit!"),console.log(o),t?await Y():(await Z(),await H())):console.log("error submit!",y)})},Y=async()=>{const e=K();try{const t=await s.startInfer(o.cam_name,o.threshold_string,o.threshold_alphabet);if(t!==0){c(`od-od-ocr poc live inferencing fail : ${t}`);return}p=!0,await E()}finally{e.close()}},Z=async()=>{const e=K();try{const t=await s.init(o.model_name_string,o.model_name_alphabet);if(t!==0){c(`od-od-ocr poc model init fail : ${t}`);return}}finally{e.close()}},x=async()=>{await q(),await z(),g.value=1},H=async()=>{if(s.info.load){g.value=2;const e=await u.loadCameraList();if(e!==0){c(`load casmera list fail : ${e}`);return}u.cameraList.length>0&&o.cam_name===""&&(o.cam_name=u.cameraList[0].name);return}g.value=1},E=async()=>{if(!(!s.info.doing||!p))try{const e=await s.getInferResult();if(e!==0){c(`od-od-ocr inference result API Error : ${e}`);return}}finally{setTimeout(E,40)}};de(()=>p=!1),me(async()=>{console.log("od-od-ocr POC Infer");let e=await s.checkInfo();if(e!==0){c(`check od-od-ocr poc info fail : ${e}`);return}if(!s.info.load){await q(),await z();return}if(g.value=2,e=await u.loadCameraList(),e!==0&&c(`load casmera list fail : ${e}`),u.cameraList.length===0?o.cam_name="":s.info.cam_name!==""&&~u.cameraList.findIndex(t=>t.name===s.info.cam_name)?o.cam_name=s.info.cam_name:o.cam_name=u.cameraList[0].name,s.info.doing){p=!0,await E();return}});const ee=async e=>{if(o.isUseStringModel=e,!e){o.model_name_string="";return}};return(e,t)=>(d(),O(L,null,[N("h4",null,C(e.$t("Dashboard.ODODOCR")),1),i(a(te)),N("div",fe,[N("div",ce,[i(a(ae),{active:g.value,"finish-status":"success",class:"w3-margin-bottom",direction:a(k).lt.md?"horizontal":"vertical"},{default:n(()=>[i(a(j),{title:e.$t("ModelSet"),onClick:t[0]||(t[0]=l=>x()),class:"pointer"},{icon:n(()=>[i(Q,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),i(a(j),{title:e.$t("Inference"),onClick:t[1]||(t[1]=l=>H()),class:"pointer"},{icon:n(()=>[i(Q,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),g.value===1?(d(),f(a(w),{key:0},{default:n(()=>[m.value.length===0?(d(),f(a(w),{key:0,style:{height:"10vh"}},{default:n(()=>[i(a(U),{title:e.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(d(),f(a(w),{key:1},{default:n(()=>[i(a(W),{ref_key:"ruleFormRef",ref:R,model:o,rules:v,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:n(()=>[i(a(b),{label:e.$t("ODODOCR.UseStrModel"),"label-width":"auto"},{default:n(()=>[i(a(le),{modelValue:o.isUseStringModel,"onUpdate:modelValue":t[2]||(t[2]=l=>o.isUseStringModel=l),onChange:t[3]||(t[3]=l=>ee(l))},null,8,["modelValue"])]),_:1},8,["label"]),o.isUseStringModel?(d(),f(a(b),{key:0,label:e.$t("ModelName")+"-"+e.$t("ODODOCR.StrModel")},{default:n(()=>[i(a(A),{modelValue:o.model_name_string,"onUpdate:modelValue":t[4]||(t[4]=l=>o.model_name_string=l)},{default:n(()=>[(d(!0),O(L,null,B(r.value,(l,y)=>(d(),f(a(M),{label:l,value:l,key:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):S("",!0),i(a(b),{label:e.$t("ModelName")+"-"+e.$t("ODODOCR.AlphModel")},{default:n(()=>[i(a(A),{modelValue:o.model_name_alphabet,"onUpdate:modelValue":t[5]||(t[5]=l=>o.model_name_alphabet=l)},{default:n(()=>[(d(!0),O(L,null,B(m.value,(l,y)=>(d(),f(a(M),{label:l,value:l,key:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(a(b),null,{default:n(()=>[i(a(V),{type:"primary",onClick:t[6]||(t[6]=l=>G(R.value,!1))},{default:n(()=>[P(C(e.$t("ModelSet")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),_:1})):S("",!0),g.value===2?(d(),f(a(w),{key:1},{default:n(()=>[a(s).info.doing?(d(),O("div",pe,[i(a(V),{type:"danger",onClick:t[7]||(t[7]=l=>a(s).stopInfer())},{default:n(()=>[P(C(e.$t("Button.Stop",{name:e.$t("Inference")})),1)]),_:1}),i(a(w),null,{default:n(()=>{var l;return[i(a(U),{class:"scroll q-pa-sm",title:(l=a(s).inferResult)==null?void 0:l.toString(),type:"success",closable:!1,style:{height:"200px","overflow-y":"auto"}},null,8,["title"]),i(a(oe),{src:a(s).imgURL,"preview-src-list":[a(s).imgURL],fit:"scale-down"},null,8,["src","preview-src-list"])]}),_:1})])):(d(),f(a(W),{key:1,ref_key:"inferFormRef",ref:D,model:o,rules:v,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:n(()=>[a(u).cameraList.length===0?(d(),f(a(U),{key:0,type:"warning",title:e.$t("Hint.AddCameraFirst"),center:"","show-icon":"",closable:!1},null,8,["title"])):S("",!0),i(a(b),{label:e.$t("Button.Select",{name:e.$t("Label.Camera")})},{default:n(()=>[i(a(A),{modelValue:o.cam_name,"onUpdate:modelValue":t[8]||(t[8]=l=>o.cam_name=l),filterable:"","no-data-text":"No camera",placeholder:"No camera"},{default:n(()=>[(d(!0),O(L,null,B(a(u).cameraList,(l,y)=>(d(),f(a(M),{label:`${l.name} (${l.cam_type==="cv"?l.src:l.cam_type})`,value:l.name,key:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(s).info.model_name_string!==""?(d(),f(a(b),{key:1,label:e.$t("Threshold")+"-"+e.$t("ODODOCR.StrModel")},{default:n(()=>[i(a(J),{modelValue:o.threshold_string,"onUpdate:modelValue":t[9]||(t[9]=l=>o.threshold_string=l),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"])):S("",!0),i(a(b),{label:e.$t("Threshold")+"-"+e.$t("ODODOCR.AlphModel")},{default:n(()=>[i(a(J),{modelValue:o.threshold_alphabet,"onUpdate:modelValue":t[10]||(t[10]=l=>o.threshold_alphabet=l),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"]),i(a(b),null,{default:n(()=>[i(a(V),{type:"primary",onClick:t[11]||(t[11]=l=>G(D.value,!0)),disabled:o.cam_name===""},{default:n(()=>[P(C(e.$t("Button.Start",{name:e.$t("Inference")})),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"]))]),_:1})):S("",!0)])],64))}});export{st as default};
