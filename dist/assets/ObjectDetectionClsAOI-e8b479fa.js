import{b as O}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as P}from"./el-button-ded9ecc1.js";import{E as ee}from"./el-card-a6aa41d5.js";import{E as ae,a as U}from"./el-row-67417f48.js";/* empty css                  */import{a as A}from"./el-main-e0dc383b.js";import{E as te}from"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";/* empty css                */import{a as le,E as C}from"./el-form-item-62aac1b2.js";import{E as oe}from"./el-image-viewer-1a9f012d.js";import"./el-scrollbar-e3b486eb.js";import{E as T}from"./el-popover-74fee5eb.js";/* empty css               */import{E as j}from"./el-select-99a9cb58.js";import{E as se}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import"./el-input-number-815f9c07.js";import"./el-tooltip-4ed993c7.js";import{E as F,a as re}from"./el-steps-c8cdef54.js";import{E as ie,a as x}from"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import{E as ne}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{u as ue,_ as me}from"./app_aoi_od_cls-a5a35e1f.js";import{f as M,w as de,i as R,o as pe,e as fe}from"./index-d07dfee2.js";import{p as ce}from"./@element-plus-a8abf029.js";import{B as ve}from"./vue-chartjs-22160128.js";import{C as ge,p as be,a as _e,b as we,f as Ee,d as he,e as ye}from"./chart.js-1176e628.js";import{u as Ce,a as Se,b as ke}from"./seadeep-d6d1f5e3.js";import{E as $e}from"./index-b8931eed.js";import{y as De,b as n,i as S,h as Ie,u as e,a7 as k,bI as o,c as $,af as _,bf as v,a as g,o as f,ag as t,b0 as Ve,S as Be}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./index-711061c4.js";import"./@vueuse-0d360189.js";import"./@ctrl-f8748455.js";import"./typescript-defaf979.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./use-dialog-b8544ca4.js";import"./event-9519ab40.js";import"./refs-e3a131a0.js";import"./vnode-18f2a975.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-6127babd.js";import"./dropdown-c44bb395.js";import"./index-32075738.js";import"./normalize-wheel-es-ed76fb12.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./@kurkle-36ca2f10.js";import"./lodash-3dc9162a.js";const Le={style:{width:"120px","min-width":"120px"}},Ne={style:{width:"100%"}},Oe={key:0},Pe=["src"],Ue={key:1,class:"w3-xxlarge w3-pale-yellow w3-center"},Ga=De({__name:"ObjectDetectionClsAOI",setup(Ae){ge.register(be,_e,we,Ee,he,ye);const K=Ce(),D=Se(),W=ke(),m=ue(),d=n(1),w=n(.7),u=n([]),I=n(""),E=n(!1),V=n(!1),G=n(""),H=n(""),i=n(),h=n({labels:[],datasets:[]}),Q=n({responsive:!0,animations:{},scales:{y:{beginAtZero:!0,stacked:!0}},interaction:{intersect:!1,mode:"dataset"}}),y=S(()=>{const l=[],a=[],s=[];let r=0;if(i.value&&i.value.dict_label_num.length>0)for(let p=0;p<i.value.dict_label_num.length;p++){const c=i.value.dict_label_num[p];if(s.push(c.image),c.details.length===0)r++;else for(const b of c.details){const N=l.indexOf(b.label);~N?a[N]+=b.count:(l.push(b.label),a.push(b.count))}}return r>0&&(l.push("no label"),l.reverse(),a.push(r),a.reverse()),{imgNames:s,labels:l,counts:a}}),Z=S(()=>y.value.labels),q=S(()=>y.value.counts),B=()=>({labels:Z.value,datasets:[{label:"Count",data:q.value,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(255, 159, 64, 0.2)","rgba(255, 205, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(54, 162, 235, 0.2)","rgba(153, 102, 255, 0.2)","rgba(201, 203, 207, 0.2)"],borderColor:["rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(201, 203, 207)"],borderWidth:2}]}),z=async()=>{if(console.log("files ==>",u),console.log("files value ==>",u.value),u.value.length===0){de(R.global.t("NoFile"));return}const l=pe(R.global.t("Inferencing"));try{const a=new FormData;for(const p of u.value){const c=await p.raw.arrayBuffer();a.append("image",new Blob([c]),p.name)}a.append("threshold",`${w.value}`),a.append("name",me);const s=await fe("form","/api/infer_od_cls",a);if(s==null)return;const r=await s.data;if(r.code!==0){M(`API Error: ${r.code}`);return}console.log("infer result = ",r),G.value="",H.value="",i.value=r.result,d.value=2,u.value=[],h.value=B()}finally{l.close()}},J=(l,a)=>{console.log(l,a)},X=l=>{I.value=l.url,E.value=!0},L=async()=>{let l=await m.checkInfo();if(l!==0){M(`check od aoi info fail : ${l}`);return}m.info.load||(d.value=1),setTimeout(L,m.info.load?2e3:1e3)},Y=async()=>{V.value=!0;try{await W.getDatasetList()}finally{V.value=!1}};return Ie(async()=>{await K.load(),await D.loadLastProject(),D.currentProject&&await Y(),await L(),h.value=B()}),(l,a)=>e(m).info.load?(f(),k(e(A),{key:0,class:"w3-margin-top"},{default:o(()=>[g("div",Le,[t(e(re),{active:d.value,"finish-status":d.value===1&&u.value.length===0?"finish":"success",class:"w3-margin-bottom",direction:"vertical",style:{height:"20vh"}},{default:o(()=>[t(e(F),{title:l.$t("Inference"),onClick:a[0]||(a[0]=s=>d.value=1),class:"pointer"},{icon:o(()=>[t(O,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"]),t(e(F),{title:l.$t("Result"),onClick:a[1]||(a[1]=s=>d.value=i.value?2:1),class:"pointer"},{icon:o(()=>[t(O,{name:"fa-solid fa-chart-area",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","finish-status"])]),g("div",Ne,[d.value===1||!i.value?(f(),$("div",Oe,[t(e(A),null,{default:o(()=>[t(e(T),{width:400,trigger:"click"},{reference:o(()=>[t(e(P),{type:"info"},{default:o(()=>[_(v(l.$t("ModelSet")),1)]),_:1})]),default:o(()=>[t(e(le),{"label-position":"left","status-icon":""},{default:o(()=>[t(e(C),{label:l.$t("ModelName")+"-"+l.$t("Kernel.OD")},{default:o(()=>[t(e(j),{modelValue:e(m).info.model_name_od,"onUpdate:modelValue":a[2]||(a[2]=s=>e(m).info.model_name_od=s),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),t(e(C),{label:l.$t("ModelName")+"-"+l.$t("Kernel.CL")},{default:o(()=>[t(e(j),{modelValue:e(m).info.model_name_cls,"onUpdate:modelValue":a[3]||(a[3]=s=>e(m).info.model_name_cls=s),disabled:""},null,8,["modelValue"])]),_:1},8,["label"])]),_:1})]),_:1}),t(e(P),{class:"ml-3",type:"success",onClick:a[4]||(a[4]=s=>z()),disabled:u.value.length===0},{default:o(()=>[_(v(l.$t("Button.Start",{name:l.$t("Inference")})),1)]),_:1},8,["disabled"])]),_:1}),t(e(C),{label:l.$t("Threshold")},{default:o(()=>[t(e(se),{modelValue:w.value,"onUpdate:modelValue":a[5]||(a[5]=s=>w.value=s),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"]),t(e(ne),{class:"upload-drag-img","file-list":u.value,"onUpdate:fileList":a[6]||(a[6]=s=>u.value=s),"list-type":"picture-card","auto-upload":!1,"on-preview":X,"on-remove":J,accept:"image/*",multiple:"",drag:""},{default:o(()=>[t(e($e),null,{default:o(()=>[t(e(ce))]),_:1})]),_:1},8,["file-list"]),t(e(te),{modelValue:E.value,"onUpdate:modelValue":a[7]||(a[7]=s=>E.value=s)},{default:o(()=>[g("img",{class:"w3-image",src:I.value,alt:"Preview Image"},null,8,Pe)]),_:1},8,["modelValue"])])):(f(),k(e(ae),{key:1},{default:o(()=>[t(e(U),{xs:24,sm:24},{default:o(()=>[t(e(ve),{data:h.value,options:Q.value},null,8,["data","options"])]),_:1}),(f(!0),$(Be,null,Ve(y.value.imgNames,(s,r)=>(f(),k(e(U),{key:r,xs:24,sm:12,md:8,lg:6,xl:4},{default:o(()=>[t(e(T),{width:200},{reference:o(()=>[t(e(ee),{"body-style":{padding:"0px"}},{default:o(()=>[t(e(oe),{fit:"scale-down",src:i.value.all_names[r],alt:s,"preview-src-list":i.value.all_names.slice(r).concat(i.value.all_names.slice(0,r))},null,8,["src","alt","preview-src-list"])]),_:2},1024)]),default:o(()=>[g("div",null,v(s),1),t(e(ie),{data:i.value.dict_label_num[r].details,"empty-text":"no label"},{default:o(()=>[t(e(x),{prop:"label"}),t(e(x),{prop:"count"})]),_:2},1032,["data"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))])]),_:1})):(f(),$("div",Ue,[_(v(l.$t("Hint.GoToBackendSet"))+" ",1),a[8]||(a[8]=g("br",null,null,-1)),_(" 【"+v(l.$t("Dashboard.AOI_ODCLS"))+"】 ",1)]))}});export{Ga as default};
