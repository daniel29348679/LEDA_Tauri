import"./base-23d00206.js";import{E as J}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import"./el-input-number-815f9c07.js";import"./el-tooltip-4ed993c7.js";import"./el-scrollbar-e3b486eb.js";import{b as M}from"./quasar-ff3737c6.js";import{a as k}from"./el-button-ded9ecc1.js";import{E as p,a as P}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as D,a as T}from"./el-select-99a9cb58.js";import{E as K}from"./el-divider-67eeba91.js";import{E as q,a as X}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as v}from"./el-main-e0dc383b.js";import{E as C}from"./el-alert-65b82b76.js";/* empty css                */import{E as Y}from"./el-image-viewer-1a9f012d.js";import{u as Z,i as h,f as u,o as z}from"./index-d07dfee2.js";import{u as x}from"./app_cls-64073d85.js";import{b as ee}from"./earthApi-baaacd65.js";import{u as te}from"./app_camera-ba436274.js";import{y as ae,b as y,p as O,F as le,h as oe,c as b,a as E,bf as _,ag as o,u as t,bI as i,a7 as d,a8 as L,S as I,o as s,b0 as H,af as F}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./index-6127babd.js";import"./event-9519ab40.js";import"./index-b8931eed.js";import"./error-78e43d3e.js";import"./typescript-defaf979.js";import"./index-32075738.js";import"./@ctrl-f8748455.js";import"./async-validator-dee29e8b.js";import"./vnode-18f2a975.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";const re={class:"step-page"},ie={class:"step-nav"},ne={key:0},tt=ae({__name:"AppClassification",setup(se){const Q=Z(),m=te(),n=x();let g=!1;const V=y(),N=y(),f=y(1),c=y([""]),r=O({model_name:"",cam_name:"",threshold:.7}),R=O({model_name:[{required:!0,message:h.global.t("NoModelName"),trigger:"blur"}],cam_name:[{required:!0,message:h.global.t("Label.PleaseSelect",{name:h.global.t("Label.Camera")}),trigger:"blur"}]}),B=async()=>{const e=await ee.api.listdirsApiListdirsPost({model:"CLS"});if(e===void 0||e.data.code===void 0){u("list cls weights fail");return}const a=e.data;if(console.log("result =>",a),a.code!==0){u(`list cls weights fail: ${a.code}`);return}c.value=a.result.folder_list,r.model_name=c.value.length>0?c.value[0]:""},A=async(e,a)=>{e&&await e.validate(async($,l)=>{$?(console.log("submit!"),console.log(r),a?await W():(await j(),await U())):console.log("error submit!",l)})},W=async()=>{const e=z();try{const a=await n.startInfer(r.cam_name,r.threshold);if(a!==0){u(`cls poc live inferencing fail : ${a}`);return}g=!0,await w()}finally{e.close()}},j=async()=>{const e=z();try{const a=await n.init(r.model_name);if(a!==0){u(`cls poc model init fail : ${a}`);return}}finally{e.close()}},G=async()=>{await B(),f.value=1},U=async()=>{if(n.info.load){f.value=2;const e=await m.loadCameraList();if(e!==0){u(`load casmera list fail : ${e}`);return}m.cameraList.length>0&&r.cam_name===""&&(r.cam_name=m.cameraList[0].name);return}f.value=1},w=async()=>{if(!(!n.info.doing||!g))try{const e=await n.getInferResult();if(e!==0){u(`cls inference result API Error : ${e}`);return}}finally{setTimeout(w,40)}};return le(()=>g=!1),oe(async()=>{console.log("CL POC Infer");let e=await n.checkInfo();if(e!==0){u(`check cls poc info fail : ${e}`);return}if(!n.info.load){await B();return}if(f.value=2,e=await m.loadCameraList(),e!==0&&u(`load casmera list fail : ${e}`),m.cameraList.length===0?r.cam_name="":n.info.cam_name!==""&&~m.cameraList.findIndex(a=>a.name===n.info.cam_name)?r.cam_name=n.info.cam_name:r.cam_name=m.cameraList[0].name,n.info.doing){g=!0,await w();return}}),(e,a)=>{const $=J;return s(),b(I,null,[E("h4",null,_(e.$t("Dashboard.CLS")),1),o(t(K)),E("div",re,[E("div",ie,[o(t(X),{active:f.value,"finish-status":"success",class:"w3-margin-bottom",direction:t(Q).lt.md?"horizontal":"vertical"},{default:i(()=>[o(t(q),{title:e.$t("ModelSet"),onClick:a[0]||(a[0]=l=>G()),class:"pointer"},{icon:i(()=>[o(M,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),o(t(q),{title:e.$t("Inference"),onClick:a[1]||(a[1]=l=>U()),class:"pointer"},{icon:i(()=>[o(M,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),f.value===1?(s(),d(t(v),{key:0},{default:i(()=>[c.value.length===0?(s(),d(t(v),{key:0,style:{height:"10vh"}},{default:i(()=>[o(t(C),{title:e.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(s(),d(t(v),{key:1},{default:i(()=>[o(t(P),{ref_key:"ruleFormRef",ref:V,model:r,rules:R,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[o(t(p),{label:e.$t("ModelName")},{default:i(()=>[o(t(D),{modelValue:r.model_name,"onUpdate:modelValue":a[2]||(a[2]=l=>r.model_name=l)},{default:i(()=>[(s(!0),b(I,null,H(c.value,(l,S)=>(s(),d(t(T),{label:l,value:l,key:S},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(t(p),null,{default:i(()=>[o(t(k),{type:"primary",onClick:a[3]||(a[3]=l=>A(V.value,!1))},{default:i(()=>[F(_(e.$t("ModelSet")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),_:1})):L("",!0),f.value===2?(s(),d(t(v),{key:1},{default:i(()=>[t(n).info.doing?(s(),b("div",ne,[o(t(k),{type:"danger",onClick:a[4]||(a[4]=l=>t(n).stopInfer())},{default:i(()=>[F(_(e.$t("Button.Stop",{name:e.$t("Inference")})),1)]),_:1}),o(t(C),{title:t(n).inferResult,type:"success",closable:!1},null,8,["title"]),o(t(Y),{src:t(n).imgURL,"preview-src-list":[t(n).imgURL],fit:"scale-down"},null,8,["src","preview-src-list"])])):(s(),d(t(P),{key:1,ref_key:"inferFormRef",ref:N,model:r,rules:R,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[t(m).cameraList.length===0?(s(),d(t(C),{key:0,type:"warning",title:e.$t("Hint.AddCameraFirst"),center:"","show-icon":"",closable:!1},null,8,["title"])):L("",!0),o(t(p),{label:e.$t("Button.Select",{name:e.$t("Label.Camera")})},{default:i(()=>[o(t(D),{modelValue:r.cam_name,"onUpdate:modelValue":a[5]||(a[5]=l=>r.cam_name=l),filterable:"","no-data-text":"No camera",placeholder:"No camera"},{default:i(()=>[(s(!0),b(I,null,H(t(m).cameraList,(l,S)=>(s(),d(t(T),{label:`${l.name} (${l.cam_type==="cv"?l.src:l.cam_type})`,value:l.name,key:S},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(t(p),{label:e.$t("Threshold")},{default:i(()=>[o($,{modelValue:r.threshold,"onUpdate:modelValue":a[6]||(a[6]=l=>r.threshold=l),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"]),o(t(p),null,{default:i(()=>[o(t(k),{type:"primary",onClick:a[7]||(a[7]=l=>A(N.value,!0)),disabled:r.cam_name===""},{default:i(()=>[F(_(e.$t("Button.Start",{name:e.$t("Inference")})),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"]))]),_:1})):L("",!0)])],64)}}});export{tt as default};
