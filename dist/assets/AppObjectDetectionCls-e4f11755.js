import{b as P}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as k}from"./el-button-ded9ecc1.js";import{E as p,a as T}from"./el-form-item-62aac1b2.js";/* empty css               */import{E,a as L}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as Y}from"./el-divider-67eeba91.js";import{E as q,a as Z}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as v}from"./el-main-e0dc383b.js";import{E as z}from"./el-alert-65b82b76.js";/* empty css                */import{E as x}from"./el-image-viewer-1a9f012d.js";import{E as ee}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import"./el-input-number-815f9c07.js";import"./el-tooltip-4ed993c7.js";import{E as te,a as K}from"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import{u as ae,i as $,f as m,o as j}from"./index-d07dfee2.js";import{b as H}from"./earthApi-baaacd65.js";import{u as le}from"./app_camera-ba436274.js";import{u as oe}from"./app_od_cls-2bd090eb.js";import{y as re,b as _,p as Q,F as ie,h as se,c as y,a as F,bf as C,ag as o,u as t,bI as i,a7 as u,a8 as I,S as h,o as n,b0 as V,af as N}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./typescript-defaf979.js";import"./normalize-wheel-es-ed76fb12.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";const ne={class:"step-page"},me={class:"step-nav"},de={key:0},st=re({__name:"AppObjectDetectionCls",setup(ue){const W=ae(),d=le(),s=oe();let w=!1;const D=_(),O=_(),f=_(1),g=_([""]),b=_([""]),r=Q({model_name_od:"",model_name_cls:"",cam_name:"",crop_m:1,crop_n:1,threshold:.7}),R=Q({model_name_od:[{required:!0,message:$.global.t("NoModelName"),trigger:"blur"}],model_name_cls:[{required:!0,message:$.global.t("NoModelName"),trigger:"blur"}],cam_name:[{required:!0,message:$.global.t("Label.PleaseSelect",{name:$.global.t("Label.Camera")}),trigger:"blur"}]}),A=async()=>{const e=await H.api.listdirsApiListdirsPost({model:"OD"});if(e===void 0||e.data.code===void 0){m("list od weights fail");return}const a=e.data;if(console.log("result =>",a),a.code!==0){m(`list od weights fail: ${a.code}`);return}g.value=a.result.folder_list,r.model_name_od=g.value.length>0?g.value[0]:""},B=async()=>{const e=await H.api.listdirsApiListdirsPost({model:"CLS"});if(e===void 0||e.data.code===void 0){m("list cls weights fail");return}const a=e.data;if(console.log("result =>",a),a.code!==0){m(`list cls weights fail: ${a.code}`);return}b.value=a.result.folder_list,r.model_name_cls=b.value.length>0?b.value[0]:""},M=async(e,a)=>{e&&await e.validate(async(l,c)=>{l?(console.log("submit!"),console.log(r),a?await G():(await J(),await U())):console.log("error submit!",c)})},G=async()=>{const e=j();try{const a=await s.startInfer(r.cam_name,r.threshold);if(a!==0){m(`od poc live inferencing fail : ${a}`);return}w=!0,await S()}finally{e.close()}},J=async()=>{const e=j();try{const a=await s.init(r.model_name_od,r.model_name_cls);if(a!==0){m(`od cls poc model init fail : ${a}`);return}}finally{e.close()}},X=async()=>{await A(),await B(),f.value=1},U=async()=>{if(s.info.load){f.value=2;const e=await d.loadCameraList();if(e!==0){m(`load casmera list fail : ${e}`);return}d.cameraList.length>0&&r.cam_name===""&&(r.cam_name=d.cameraList[0].name);return}f.value=1},S=async()=>{if(!(!s.info.doing||!w))try{const e=await s.getInferResult();if(e!==0){m(`od cls inference result API Error : ${e}`);return}}finally{setTimeout(S,40)}};return ie(()=>w=!1),se(async()=>{console.log("OD CLS POC Infer");let e=await s.checkInfo();if(e!==0){m(`check od cls poc info fail : ${e}`);return}if(!s.info.load){await A(),await B();return}if(f.value=2,e=await d.loadCameraList(),e!==0&&m(`load casmera list fail : ${e}`),d.cameraList.length===0?r.cam_name="":s.info.cam_name!==""&&~d.cameraList.findIndex(a=>a.name===s.info.cam_name)?r.cam_name=s.info.cam_name:r.cam_name=d.cameraList[0].name,s.info.doing){w=!0,await S();return}}),(e,a)=>(n(),y(h,null,[F("h4",null,C(e.$t("Dashboard.ODCLS")),1),o(t(Y)),F("div",ne,[F("div",me,[o(t(Z),{active:f.value,"finish-status":"success",class:"w3-margin-bottom",direction:t(W).lt.md?"horizontal":"vertical"},{default:i(()=>[o(t(q),{title:e.$t("ModelSet"),onClick:a[0]||(a[0]=l=>X()),class:"pointer"},{icon:i(()=>[o(P,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),o(t(q),{title:e.$t("Inference"),onClick:a[1]||(a[1]=l=>U()),class:"pointer"},{icon:i(()=>[o(P,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),f.value===1?(n(),u(t(v),{key:0},{default:i(()=>[g.value.length===0||b.value.length===0?(n(),u(t(v),{key:0,style:{height:"10vh"}},{default:i(()=>[o(t(z),{title:e.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(n(),u(t(v),{key:1},{default:i(()=>[o(t(T),{ref_key:"ruleFormRef",ref:D,model:r,rules:R,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[o(t(p),{label:e.$t("ModelName")+"-"+e.$t("Kernel.OD")},{default:i(()=>[o(t(E),{modelValue:r.model_name_od,"onUpdate:modelValue":a[2]||(a[2]=l=>r.model_name_od=l)},{default:i(()=>[(n(!0),y(h,null,V(g.value,(l,c)=>(n(),u(t(L),{label:l,value:l,key:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(t(p),{label:e.$t("ModelName")+"-"+e.$t("Kernel.CL")},{default:i(()=>[o(t(E),{modelValue:r.model_name_cls,"onUpdate:modelValue":a[3]||(a[3]=l=>r.model_name_cls=l)},{default:i(()=>[(n(!0),y(h,null,V(b.value,(l,c)=>(n(),u(t(L),{label:l,value:l,key:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(t(p),null,{default:i(()=>[o(t(k),{type:"primary",onClick:a[4]||(a[4]=l=>M(D.value,!1))},{default:i(()=>[N(C(e.$t("ModelSet")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),_:1})):I("",!0),f.value===2?(n(),u(t(v),{key:1},{default:i(()=>[t(s).info.doing?(n(),y("div",de,[o(t(k),{type:"danger",onClick:a[5]||(a[5]=l=>t(s).stopInfer())},{default:i(()=>[N(C(e.$t("Button.Stop",{name:e.$t("Inference")})),1)]),_:1}),o(t(v),null,{default:i(()=>[o(t(te),{data:t(s).inferResult},{default:i(()=>[o(t(K),{prop:"label",label:"Label","min-width":80}),o(t(K),{prop:"number",label:"Number","min-width":100})]),_:1},8,["data"]),o(t(x),{src:t(s).imgURL,"preview-src-list":[t(s).imgURL],fit:"scale-down"},null,8,["src","preview-src-list"])]),_:1})])):(n(),u(t(T),{key:1,ref_key:"inferFormRef",ref:O,model:r,rules:R,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[t(d).cameraList.length===0?(n(),u(t(z),{key:0,type:"warning",title:e.$t("Hint.AddCameraFirst"),center:"","show-icon":"",closable:!1},null,8,["title"])):I("",!0),o(t(p),{label:e.$t("Button.Select",{name:e.$t("Label.Camera")})},{default:i(()=>[o(t(E),{modelValue:r.cam_name,"onUpdate:modelValue":a[6]||(a[6]=l=>r.cam_name=l),filterable:"","no-data-text":"No camera",placeholder:"No camera"},{default:i(()=>[(n(!0),y(h,null,V(t(d).cameraList,(l,c)=>(n(),u(t(L),{label:`${l.name} (${l.cam_type==="cv"?l.src:l.cam_type})`,value:l.name,key:c},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(t(p),{label:e.$t("Threshold")},{default:i(()=>[o(t(ee),{modelValue:r.threshold,"onUpdate:modelValue":a[7]||(a[7]=l=>r.threshold=l),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"]),o(t(p),null,{default:i(()=>[o(t(k),{type:"primary",onClick:a[8]||(a[8]=l=>M(O.value,!0)),disabled:r.cam_name===""},{default:i(()=>[N(C(e.$t("Button.Start",{name:e.$t("Inference")})),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"]))]),_:1})):I("",!0)])],64))}});export{st as default};
