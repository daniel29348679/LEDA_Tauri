import{y as F,h as z,b as i,c as S,a as r,bf as u,ag as l,u as o,bI as n,S as L,o as d,af as I,a8 as y,B as A,bC as K,a7 as T}from"./@vue-19632928.js";import"./base-23d00206.js";import{E as W}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{E as G}from"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import{E,a as H}from"./el-steps-c8cdef54.js";import{E as V}from"./el-divider-67eeba91.js";import{a as j}from"./el-button-ded9ecc1.js";import{c as q}from"./el-main-e0dc383b.js";import{E as J}from"./el-checkbox-d46297b7.js";import{d as O,g as Q,o as X,p as Y}from"./@element-plus-a8abf029.js";import{u as Z,o as U,f as w}from"./index-d07dfee2.js";import{u as ee}from"./uploadFile-6ce60004.js";import{K as te}from"./KonvaPaint-e9087f28.js";import{g as oe}from"./label-61e62ece.js";import{u as ae}from"./stashSpace-391fdb88.js";import{S as le}from"./StashSelect-5af938b3.js";import{R as ie}from"./ResultImgWithStash-c075e0f0.js";import{E as re}from"./index-b8931eed.js";import"./lodash-es-cc4652a2.js";import"./error-78e43d3e.js";import"./typescript-defaf979.js";import"./index-711061c4.js";import"./@vueuse-0d360189.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./use-dialog-b8544ca4.js";import"./event-9519ab40.js";import"./refs-e3a131a0.js";import"./vnode-18f2a975.js";import"./@ctrl-f8748455.js";import"./index-6127babd.js";import"./quasar-ff3737c6.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./el-input-51d05b2a.js";import"./index-32075738.js";import"./el-scrollbar-e3b486eb.js";import"./vue-drag-resize-6bf710ae.js";import"./json-editor-vue3-5344cb8d.js";import"./jsoneditor-5f1e2c9e.js";import"./lodash-3dc9162a.js";import"./el-image-viewer-1a9f012d.js";import"./decimal.js-d133ee8e.js";/* empty css               */import"./el-select-99a9cb58.js";import"./el-tooltip-4ed993c7.js";import"./validator-7d68535e.js";import"./el-alert-65b82b76.js";import"./el-card-a6aa41d5.js";const se={class:"step-page"},ne={class:"step-nav"},pe={key:0},ue={class:"el-upload__tip"},me={class:"el-upload__tip text-red"},ce=["src"],de={style:{display:"flex","flex-direction":"column"}},ve={style:{display:"flex","flex-direction":"column"}},fe={key:0},ge={class:"el-upload__tip"},_e={key:1},$t=F({__name:"CropImgMarkView",setup(he){const b=Z(),P=ae();z(()=>{console.log("CropImgMarkView")});const $=i(),v=i(0),f=i(0),R=async t=>{M(t==null?void 0:t.percentage)},s=i(1),g=ee(),C=i(""),k=i(!1),m=i([]),p=i([]),c=i([]),_=i(!1),B=(t,e)=>{console.log(t,e)},N=t=>{C.value=t.url,k.value=!0},x=async()=>{if(v.value=0,f.value=0,await D()){s.value++;const{width:e,height:a}=await oe(p.value[0],$);v.value=e,f.value=a}},D=async()=>{const t=U();try{await g.upload("/api/percentage_crop",[m.value[0]],{top_percentage:0,bottom_percentage:0,left_percentage:0,right_percentage:0});const e=g.uploadResult;if(!e)return;if(e.code!==0){w(`API Error: ${e.code}`);return}return p.value=e.result.all_names,!0}catch(e){w(`${e}`)}finally{t.close()}},M=async t=>{const e=U();try{const a=t??{top_percentage:0,bottom_percentage:0,left_percentage:0,right_percentage:0};_.value&&(a.folder_path=P.currentFolderPath),await g.upload("/api/percentage_crop",m.value,a);const h=g.uploadResult;if(!h)return;if(h.code!==0){w(`API Error: ${h.code}`);return}c.value=h.result.all_names,s.value++}catch(a){w(`${a}`)}finally{e.close()}};return(t,e)=>(d(),S(L,null,[r("h4",null,u(t.$t("CropImgMark")),1),l(o(V)),r("div",se,[r("div",ne,[l(o(H),{active:s.value,"finish-status":"success",class:"w3-margin-bottom",direction:o(b).lt.md?"horizontal":"vertical"},{default:n(()=>[l(o(E),{title:t.$t("Upload"),icon:o(O),onClick:e[0]||(e[0]=a=>(s.value=1,m.value=[],p.value=[],c.value=[])),class:"pointer"},null,8,["title","icon"]),l(o(E),{title:t.$t("Setting"),icon:o(Q),onClick:e[1]||(e[1]=a=>s.value=p.value.length>0?2:1),class:"pointer"},null,8,["title","icon"]),l(o(E),{title:t.$t("Generate"),icon:o(X),onClick:e[2]||(e[2]=a=>s.value=c.value.length>0?3:2),class:"pointer"},null,8,["title","icon"])]),_:1},8,["active","direction"])]),l(o(q),null,{default:n(()=>[s.value===1?(d(),S("div",pe,[l(o(j),{type:"success",onClick:e[3]||(e[3]=a=>x())},{default:n(()=>[I(u(t.$t("Upload")),1)]),_:1}),l(o(V)),l(o(W),{class:"upload-drag-img","file-list":m.value,"onUpdate:fileList":e[4]||(e[4]=a=>m.value=a),action:"/api/percentage_crop","list-type":"picture-card","auto-upload":!1,"on-preview":N,"on-remove":B,multiple:"",drag:""},{tip:n(()=>[r("div",ue,u(t.$t("UploadImg")),1),r("div",me,u(t.$t("StashSpaceUploadImageConfigureFirst")),1)]),default:n(()=>[l(o(re),null,{default:n(()=>[l(o(Y))]),_:1})]),_:1},8,["file-list"]),l(o(G),{modelValue:k.value,"onUpdate:modelValue":e[5]||(e[5]=a=>k.value=a)},{default:n(()=>[r("img",{"w-full":"",src:C.value,alt:"Preview Image"},null,8,ce)]),_:1},8,["modelValue"])])):y("",!0),A(r("div",de,[l(o(J),{modelValue:_.value,"onUpdate:modelValue":e[6]||(e[6]=a=>_.value=a)},{default:n(()=>[I(u(t.$t("Label.UsingTemporaryStorageSpace")),1)]),_:1},8,["modelValue"]),r("div",ve,[_.value?(d(),S("div",fe,[l(le,{"is-on-page":"","is-upload":""}),r("span",ge,u(t.$t("UploadImg")),1)])):y("",!0)]),r("div",{ref_key:"contentRef",ref:$},[p.value[0]&&v.value&&f.value?(d(),T(te,{key:0,img:p.value[0],width:v.value,height:f.value,"visible-tools":["rect","eraser","zoom-in","zoom-out","move"],"set-info":R,"single-label-name":"","single-label":"","single-image":"","show-right-area":!1,"tool-position":{x:125,y:-52}},null,8,["img","width","height"])):y("",!0)],512)],512),[[K,s.value===2&&p.value.length!==0]]),s.value===3&&c.value.length!==0?(d(),S("div",_e,[l(ie,{all_names:c.value},null,8,["all_names"])])):y("",!0)]),_:1})])],64))}});export{$t as default};
