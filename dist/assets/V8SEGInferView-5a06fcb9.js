import{b as G}from"./quasar-ff3737c6.js";import{y as le,h as ae,b as i,p as L,d as P,c as B,a as E,bf as c,ag as o,u as a,bI as s,S as U,o as d,a7 as f,B as y,bC as S,b0 as oe,af as g,a8 as M}from"./@vue-19632928.js";import"./base-23d00206.js";import{a as R}from"./el-button-ded9ecc1.js";/* empty css                */import{a as re,E as D}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as se,a as ie}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as z,a as ne}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as b,E as me}from"./el-main-e0dc383b.js";import{E as ue}from"./el-alert-65b82b76.js";import{E as pe,a as H}from"./el-radio-button-3d6852d2.js";import{E as de}from"./el-divider-67eeba91.js";import{I as ce}from"./InferImg-e3b2bb14.js";import{_ as fe}from"./InferCamera.vue_vue_type_script_setup_true_lang-05a521fb.js";import{u as _e,i as $,e as T,f as h,o as j}from"./index-d07dfee2.js";import{b as ve}from"./earthApi-baaacd65.js";import{a as q,h as ge}from"./label-61e62ece.js";import{_ as be}from"./lodash-3dc9162a.js";import{_ as he}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./el-popover-74fee5eb.js";import"./dropdown-c44bb395.js";import"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import"./typescript-defaf979.js";import"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import"./use-dialog-b8544ca4.js";import"./refs-e3a131a0.js";import"./el-image-viewer-1a9f012d.js";import"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import"./normalize-wheel-es-ed76fb12.js";import"./el-tooltip-4ed993c7.js";import"./el-slider-07e60acd.js";import"./el-input-number-815f9c07.js";import"./el-input-51d05b2a.js";import"./@element-plus-a8abf029.js";import"./stashSpace-391fdb88.js";import"./pinia-71cafef5.js";import"./StashSelect-5af938b3.js";import"./validator-7d68535e.js";import"./ResultImgWithStash-c075e0f0.js";import"./el-card-a6aa41d5.js";import"./CameraOpen-7e226201.js";import"./el-row-67417f48.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./decimal.js-d133ee8e.js";import"./jsoneditor-5f1e2c9e.js";const we={class:"step-page"},Ee={class:"step-nav"},ye=le({__name:"V8SEGInferView",setup(Se){const V=_e();ae(()=>{console.log("SEG Infer"),K()});const k=i(),m=i(1),u=i([""]),_=i(.7),v=i($.global.t("Upload")),l=L({model_name:"",cls_w_h_a:void 0,alert_area:void 0}),W=L({model_name:[{required:!0,message:$.global.t("NoModelName"),trigger:"blur"}]}),K=async()=>{const t=await T("json","/api/listdirs",{model:"SEG"});if(t==null)return;const e=await t.data;if(console.log("result =>",e),e.code!==0){h(`API Error: ${e.code}`);return}u.value=e.result.folder_list,l.model_name=u.value.length>0?u.value[0]:"",console.log("modelFolder =>",u),console.log("modelFolder len =>",u.value.length)},O=i(),Q=async t=>{var e,r,n;if(((e=l.cls_w_h_a)==null?void 0:e.length)!==((r=l.alert_area)==null?void 0:r.length)){h($.global.t("Hint.SetAllPartitionLabels")),(n=O.value)==null||n.open(!0);return}t&&await t.validate(async(w,p)=>{if(w){console.log("submit!"),console.log(l);const te=j();await N(),Z(),te.close()}else console.log("error submit!",p)})},I=i(!1),C=i(!1);P([()=>l.model_name,I,C],async([t,e])=>{if(t===""||!e){l.cls_w_h_a=void 0,l.alert_area=void 0,l.filter_type=void 0;return}l.cls_w_h_a=[[]],l.alert_area=[q],l.filter_type="w_h",A.value="0",await N(),await Y()});const J=i(0),X=i(0),F=i([]),Y=async()=>{var e;const t=j();try{const r=await ve.api.classNamesV8SegApiClassNamesSegPost({name:""});if(!r)return;const n=r.data;console.log("result =>",n);const w=n.result.all_labels;if(F.value=w.map(p=>({cls:p,w:0,h:0,a:0})),l.cls_w_h_a)for(let p=0;p<((e=l.cls_w_h_a)==null?void 0:e.length);p++)l.cls_w_h_a&&(l.cls_w_h_a[p]=be(F.value));if(n.code!==0){h(`API Error: ${n.code}`);return}}finally{t.close()}},N=async()=>{const t=await T("json","/api/init_seg",l);if(console.log("res =>",t),t==null)return;const e=await t.data;if(console.log("result =>",e),e.code!==0){h(`API Error: ${e.code}`);return}},Z=()=>{m.value++},x=i([]),A=i("0");P(()=>l.alert_area,()=>{l.alert_area&&(x.value=[{name:"test",labels:l.alert_area.map((t,e)=>({...ge(t),label:`Part ${e+1}`}))}])},{deep:!0});const ee=()=>{I.value=!1,C.value=!1,l.cls_w_h_a=[[]],l.alert_area=[q],A.value="0",m.value=1,J.value=0,X.value=0};return(t,e)=>(d(),B(U,null,[E("h4",null,c(t.$t("Kernel.SEG")),1),o(a(de)),E("div",we,[E("div",Ee,[o(a(ne),{active:m.value,"finish-status":"success",class:"w3-margin-bottom",direction:a(V).lt.md?"horizontal":"vertical"},{default:s(()=>[o(a(z),{title:t.$t("ModelSet"),onClick:e[0]||(e[0]=r=>m.value=1),class:"pointer"},{icon:s(()=>[o(G,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),o(a(z),{title:t.$t("Inference"),onClick:e[1]||(e[1]=r=>m.value=_.value>0?2:1),class:"pointer"},{icon:s(()=>[o(G,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),o(a(b),null,{default:s(()=>[u.value.length===0?(d(),f(a(b),{key:0,style:{height:"10vh"}},{default:s(()=>[o(a(ue),{title:t.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(d(),f(a(b),{key:1,style:{flex:"1 1 100%"}},{default:s(()=>[y(o(a(re),{ref_key:"ruleFormRef",ref:k,model:l,rules:W,"label-width":a(V).lt.sm?"100px":"150px","label-position":"left",class:"demo-ruleForm","status-icon":"",inline:""},{default:s(()=>[o(a(D),{label:t.$t("ModelName"),"label-width":"auto"},{default:s(()=>[o(a(se),{modelValue:l.model_name,"onUpdate:modelValue":e[2]||(e[2]=r=>l.model_name=r)},{default:s(()=>[(d(!0),B(U,null,oe(u.value,(r,n)=>(d(),f(a(ie),{label:r,value:r,key:n},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(a(D),{style:{width:"100%"}},{default:s(()=>[o(a(R),{type:"primary",onClick:e[3]||(e[3]=r=>Q(k.value))},{default:s(()=>[g(c(t.$t("ModelSet")),1)]),_:1}),m.value===1?(d(),f(a(R),{key:0,link:"",class:"q-ml-md",onClick:ee},{default:s(()=>[g(c(t.$t("Reset")),1)]),_:1})):M("",!0)]),_:1})]),_:1},8,["model","rules","label-width"]),[[S,m.value===1]]),m.value===2?(d(),f(a(b),{key:0},{default:s(()=>[o(a(me),{style:{padding:"0"}},{default:s(()=>[o(a(pe),{modelValue:v.value,"onUpdate:modelValue":e[4]||(e[4]=r=>v.value=r)},{default:s(()=>[o(a(H),{label:t.$t("Upload")},{default:s(()=>[g(c(t.$t("Upload")),1)]),_:1},8,["label"]),o(a(H),{label:t.$t("Camera")},{default:s(()=>[g(c(t.$t("Camera")),1)]),_:1},8,["label"])]),_:1},8,["modelValue"])]),_:1}),y(o(ce,{threshold:_.value,"onUpdate:threshold":e[5]||(e[5]=r=>_.value=r),infer_kernel:"seg"},null,8,["threshold"]),[[S,v.value===t.$t("Upload")]]),y(o(fe,{infer_kernel:"seg",threshold:_.value},null,8,["threshold"]),[[S,v.value===t.$t("Camera")]])]),_:1})):M("",!0)]),_:1}))]),_:1})])],64))}});const Ht=he(ye,[["__scopeId","data-v-acdc451e"]]);export{Ht as default};
