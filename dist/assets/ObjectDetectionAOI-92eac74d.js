import{b as j}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as H}from"./el-button-ded9ecc1.js";import{E as oe}from"./el-card-a6aa41d5.js";import{E as se,a as B}from"./el-row-67417f48.js";/* empty css                  */import{a as M}from"./el-main-e0dc383b.js";import{E as re}from"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";/* empty css                */import{a as ie,E}from"./el-form-item-62aac1b2.js";import{E as ne}from"./el-image-viewer-1a9f012d.js";import"./el-input-51d05b2a.js";import{E as h}from"./el-input-number-815f9c07.js";import{E as ue}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as R}from"./el-popover-74fee5eb.js";/* empty css               */import{E as me}from"./el-slider-07e60acd.js";import"./el-tooltip-4ed993c7.js";import{E as W,a as de}from"./el-steps-c8cdef54.js";import{E as pe,a as G}from"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import{E as fe}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{E as J}from"./el-alert-65b82b76.js";import{u as ce,_ as be}from"./app_aoi_od-9abe0b5f.js";import{f as Q,i as y,w as ve,o as ge,e as we}from"./index-d07dfee2.js";import{p as _e}from"./@element-plus-a8abf029.js";import{B as Ee}from"./vue-chartjs-22160128.js";import{C as he,p as ye,a as Ve,b as Se,f as $e,d as ke,e as Ce}from"./chart.js-1176e628.js";import{u as Ie,a as De,b as Ue}from"./seadeep-d6d1f5e3.js";import"./earthApi-baaacd65.js";import{E as Be}from"./index-b8931eed.js";import{y as Le,b as u,i as V,h as Ne,F as Oe,u as e,a7 as S,bI as o,c as _,af as w,bf as b,a as f,o as d,ag as a,S as $,b0 as L}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./index-711061c4.js";import"./@vueuse-0d360189.js";import"./@ctrl-f8748455.js";import"./typescript-defaf979.js";import"./use-dialog-b8544ca4.js";import"./event-9519ab40.js";import"./refs-e3a131a0.js";import"./vnode-18f2a975.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-6127babd.js";import"./index-32075738.js";import"./dropdown-c44bb395.js";import"./normalize-wheel-es-ed76fb12.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./@kurkle-36ca2f10.js";import"./lodash-3dc9162a.js";const Pe={style:{width:"120px","min-width":"120px"}},Te={style:{width:"100%"}},Ae={key:0},xe={class:"scroll-bar",style:{maxHeight:"200px",overflowY:"auto"}},Fe=["src"],je={key:1,class:"w3-xxlarge w3-pale-yellow w3-center"},zl=Le({__name:"ObjectDetectionAOI",setup(He){he.register(ye,Ve,Se,$e,ke,Ce);const Y=Ie(),N=De(),O=Ue(),m=ce(),v=u(1),k=u(.7),p=u([]),P=u(""),C=u(!1),T=u(!1),Z=u(""),q=u(""),i=u(),I=u({labels:[],datasets:[]}),z=u({responsive:!0,animations:{},scales:{y:{beginAtZero:!0,stacked:!0}},interaction:{intersect:!1,mode:"dataset"}}),D=V(()=>{const t=[],l=[],s=[];let r=0;if(i.value&&i.value.dict_label_num.length>0)for(let n=0;n<i.value.dict_label_num.length;n++){const g=i.value.dict_label_num[n];if(s.push(g.image),g.details.length===0)r++;else for(const c of g.details){const F=t.indexOf(c.label);~F?l[F]+=c.count:(t.push(c.label),l.push(c.count))}}return r>0&&(t.push("no label"),t.reverse(),l.push(r),l.reverse()),{imgNames:s,labels:t,counts:l}}),K=V(()=>D.value.labels),X=V(()=>D.value.counts);V(()=>O.datasetList.filter(t=>{try{return JSON.parse(t.param??"{}").kernel==="OD"}catch{return!1}}));const A=()=>({labels:K.value,datasets:[{label:"Count",data:X.value,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(255, 159, 64, 0.2)","rgba(255, 205, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(54, 162, 235, 0.2)","rgba(153, 102, 255, 0.2)","rgba(201, 203, 207, 0.2)"],borderColor:["rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(201, 203, 207)"],borderWidth:2}]}),ee=async()=>{if(console.log("files ==>",p),console.log("files value ==>",p.value),p.value.length===0){ve(y.global.t("NoFile"));return}const t=ge(y.global.t("Inferencing"));try{const l=new FormData;for(const n of p.value){const g=await n.raw.arrayBuffer();l.append("image",new Blob([g]),n.name)}l.append("threshold",`${k.value}`),l.append("name",be);const s=await we("form","/api/infer_od",l);if(s==null)return;const r=await s.data;if(r.code!==0){Q(`API Error: ${r.code}`);return}console.log("infer result = ",r),Z.value="",q.value="",i.value=r.result,v.value=2,p.value=[],I.value=A()}finally{t.close()}},le=(t,l)=>{console.log(t,l)},ae=t=>{P.value=t.url,C.value=!0};let U=u(null);const x=async()=>{let t=await m.checkInfo();if(t!==0){Q(`check od aoi info fail : ${t}`);return}m.info.load||(v.value=1),U.value=setTimeout(x,m.info.load?2e3:1e3)},te=async()=>{T.value=!0;try{await O.getDatasetList()}finally{T.value=!1}};return Ne(async()=>{await Y.load(),await N.loadLastProject(),N.currentProject&&await te(),await x(),I.value=A()}),Oe(()=>{U.value&&clearTimeout(U.value)}),(t,l)=>e(m).info.load?(d(),S(e(M),{key:0,class:"w3-margin-top"},{default:o(()=>[f("div",Pe,[a(e(de),{active:v.value,"finish-status":v.value===1&&p.value.length===0?"finish":"success",class:"w3-margin-bottom",direction:"vertical",style:{height:"20vh"}},{default:o(()=>[a(e(W),{title:t.$t("Inference"),onClick:l[0]||(l[0]=s=>v.value=1),class:"pointer"},{icon:o(()=>[a(j,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"]),a(e(W),{title:t.$t("Result"),onClick:l[1]||(l[1]=s=>v.value=i.value?2:1),class:"pointer"},{icon:o(()=>[a(j,{name:"fa-solid fa-chart-area",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","finish-status"])]),f("div",Te,[v.value===1||!i.value?(d(),_("div",Ae,[a(e(M),null,{default:o(()=>[a(e(R),{width:400,trigger:"click"},{reference:o(()=>[a(e(H),{type:"info"},{default:o(()=>[w(b(t.$t("ModelSet")),1)]),_:1})]),default:o(()=>[a(e(ie),{"label-position":"left","status-icon":""},{default:o(()=>[a(e(E),{label:t.$t("ModelName")},{default:o(()=>[a(e(ue),{modelValue:e(m).info.model_name,"onUpdate:modelValue":l[2]||(l[2]=s=>e(m).info.model_name=s),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),a(e(E),{label:t.$t("Label.CropH")},{default:o(()=>[a(e(h),{modelValue:e(m).info.crop_m,"onUpdate:modelValue":l[3]||(l[3]=s=>e(m).info.crop_m=s),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),a(e(E),{label:t.$t("Label.CropV")},{default:o(()=>[a(e(h),{modelValue:e(m).info.crop_n,"onUpdate:modelValue":l[4]||(l[4]=s=>e(m).info.crop_n=s),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),f("div",xe,[(d(!0),_($,null,L(e(m).info.cls_w_h,(s,r)=>(d(),_($,{key:r},[w(b(`${t.$t("Partition")} ${r+1}`)+": ",1),(d(!0),_($,null,L(s,(n,g)=>(d(),S(e(E),{key:g,label:n.cls,"label-width":100},{default:o(()=>[f("span",null,[w(b(t.$t("Width"))+"(px)： ",1),a(e(h),{modelValue:n.w,"onUpdate:modelValue":c=>n.w=c,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),f("span",null,[w(b(t.$t("Height"))+"(px)： ",1),a(e(h),{modelValue:n.h,"onUpdate:modelValue":c=>n.h=c,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1032,["label"]))),128))],64))),128))])]),_:1})]),_:1}),a(e(H),{class:"ml-3",type:"success",onClick:l[5]||(l[5]=s=>ee()),disabled:p.value.length===0},{default:o(()=>[w(b(t.$t("Button.Start",{name:t.$t("Inference")})),1)]),_:1},8,["disabled"])]),_:1}),a(e(E),{label:t.$t("Threshold")},{default:o(()=>[a(e(me),{modelValue:k.value,"onUpdate:modelValue":l[6]||(l[6]=s=>k.value=s),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"]),a(e(fe),{class:"upload-drag-img","file-list":p.value,"onUpdate:fileList":l[7]||(l[7]=s=>p.value=s),"list-type":"picture-card","auto-upload":!1,"on-preview":ae,"on-remove":le,accept:"image/*",multiple:"",drag:""},{default:o(()=>[a(e(Be),null,{default:o(()=>[a(e(_e))]),_:1})]),_:1},8,["file-list"]),a(e(re),{modelValue:C.value,"onUpdate:modelValue":l[8]||(l[8]=s=>C.value=s)},{default:o(()=>[f("img",{class:"w3-image",src:P.value,alt:"Preview Image"},null,8,Fe)]),_:1},8,["modelValue"])])):(d(),S(e(se),{key:1},{default:o(()=>[a(e(B),{xs:24,sm:12},{default:o(()=>[a(e(Ee),{data:I.value,options:z.value},null,8,["data","options"])]),_:1}),a(e(B),null,{default:o(()=>[a(e(J),{title:e(y).global.t("AllTime")+" : "+i.value.all_time+" sec",type:"info",closable:!1},null,8,["title"]),a(e(J),{title:e(y).global.t("MeanTime")+" : "+i.value.mean_time+" sec",type:"info",closable:!1},null,8,["title"]),l[9]||(l[9]=f("br",null,null,-1))]),_:1}),(d(!0),_($,null,L(D.value.imgNames,(s,r)=>(d(),S(e(B),{key:r,xs:24,sm:12,md:8,lg:6,xl:4},{default:o(()=>[a(e(R),{width:200},{reference:o(()=>[a(e(oe),{"body-style":{padding:"0px"}},{default:o(()=>[a(e(ne),{fit:"scale-down",src:i.value.all_names[r],alt:s,"preview-src-list":i.value.all_names.slice(r).concat(i.value.all_names.slice(0,r))},null,8,["src","alt","preview-src-list"])]),_:2},1024)]),default:o(()=>[f("div",null,b(s),1),a(e(pe),{data:i.value.dict_label_num[r].details,"empty-text":"no label"},{default:o(()=>[a(e(G),{prop:"label"}),a(e(G),{prop:"count"})]),_:2},1032,["data"])]),_:2},1024)]),_:2},1024))),128))]),_:1}))])]),_:1})):(d(),_("div",je,[w(b(t.$t("Hint.GoToBackendSet"))+" ",1),l[10]||(l[10]=f("br",null,null,-1)),w(" 【"+b(t.$t("Dashboard.AOI_OD"))+"】 ",1)]))}});export{zl as default};
