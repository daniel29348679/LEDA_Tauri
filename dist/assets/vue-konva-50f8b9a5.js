import{K as i}from"./konva-364a8bb7.js";import{y as k,f as L,p as N,b as x,h as S,K as b,C as M,d as P,A as T,F as R}from"./@vue-19632928.js";function y(o){if(!i.autoDrawEnabled){const n=o.getLayer()||o.getStage();n&&n.batchDraw()}}const w={key:!0,style:!0,elm:!0,isRootInsert:!0},m=".vue-konva-event";function A(o,n,a,l){const e=o.__konvaNode,u={};let r=!1;for(let t in a){if(w.hasOwnProperty(t))continue;const c=t.slice(0,2)==="on",p=a[t]!==n[t];if(c&&p){let s=t.slice(2).toLowerCase();s.slice(0,7)==="content"&&(s="content"+s.slice(7,1).toUpperCase()+s.slice(8)),e==null||e.off(s+m,a[t])}!n.hasOwnProperty(t)&&(e==null||e.setAttr(t,void 0))}for(let t in n){if(w.hasOwnProperty(t))continue;let c=t.slice(0,2)==="on";const p=a[t]!==n[t];if(c&&p){let s=t.slice(2).toLowerCase();s.slice(0,7)==="content"&&(s="content"+s.slice(7,1).toUpperCase()+s.slice(8)),n[t]&&(e==null||e.off(s+m),e==null||e.on(s+m,n[t]))}!c&&(n[t]!==a[t]||l&&n[t]!==(e==null?void 0:e.getAttr(t)))&&(r=!0,u[t]=n[t])}r&&e&&(e.setAttrs(u),y(e))}const E="v";function I(o){function n(a){return a!=null&&a.__konvaNode?a:a!=null&&a.parent?n(a.parent):(console.error("vue-konva error: Can not find parent node"),null)}return n(o.parent)}function C(o){return o.component?o.component.__konvaNode||C(o.component.subTree):null}function j(o){const{el:n,component:a}=o,l=C(o);if(n!=null&&n.tagName&&a&&!l){const e=n.tagName.toLowerCase();return console.error(`vue-konva error: You are trying to render "${e}" inside your component tree. Looks like it is not a Konva node. You can render only Konva components inside the Stage.`),null}return l}function K(o){const n=e=>!!(e!=null&&e.hasOwnProperty("component")),a=e=>Array.isArray(e),l=e=>n(e)?[e,...l(e.children)]:a(e)?e.flatMap(l):[];return l(o.children)}function O(o,n){const a=K(o),l=[];a.forEach(u=>{const r=j(u);r&&l.push(r)});let e=!1;l.forEach((u,r)=>{u.getZIndex()!==r&&(u.setZIndex(r),e=!0)}),e&&y(n)}const U=k({name:"Stage",props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},inheritAttrs:!1,setup(o,{attrs:n,slots:a,expose:l}){const e=L();if(!e)return;const u=N({}),r=x(null),t=new i.Stage({width:o.config.width,height:o.config.height,container:document.createElement("div")});e.__konvaNode=t,s();function c(){return e==null?void 0:e.__konvaNode}function p(){return e==null?void 0:e.__konvaNode}function s(){if(!e)return;const d=u||{},g={...n,...o.config};A(e,g,d,o.__useStrictMode),Object.assign(u,g)}return S(()=>{r.value&&(r.value.innerHTML="",t.container(r.value)),s()}),b(()=>{s(),O(e.subTree,t)}),M(()=>{t.destroy()}),P(()=>o.config,s,{deep:!0}),l({getStage:p,getNode:c}),console.log(n),()=>{var d;return T("div",{ref:r,style:n==null?void 0:n.style},(d=a.default)==null?void 0:d.call(a))}}}),F=".vue-konva-event",G={Group:!0,Layer:!0,FastLayer:!0,Label:!0};function B(o,n){return k({name:o,props:{config:{type:Object,default:function(){return{}}},__useStrictMode:{type:Boolean}},setup(a,{attrs:l,slots:e,expose:u}){const r=L();if(!r)return;const t=N({}),c=new n;r.__konvaNode=c,r.vnode.__konvaNode=c,d();function p(){return r==null?void 0:r.__konvaNode}function s(){return r==null?void 0:r.__konvaNode}function d(){if(!r)return;const f={};for(const _ in r==null?void 0:r.vnode.props)_.slice(0,2)==="on"&&(f[_]=r.vnode.props[_]);const v=t||{},h={...l,...a.config,...f};A(r,h,v,a.__useStrictMode),Object.assign(t,h)}S(()=>{var f;const v=(f=I(r))==null?void 0:f.__konvaNode;v&&"add"in v&&v.add(c),y(c)}),R(()=>{y(c),c.destroy(),c.off(F)}),b(()=>{d(),O(r.subTree,c)}),P(()=>a.config,d,{deep:!0}),u({getStage:s,getNode:p});const g=G.hasOwnProperty(o);return()=>{var f;return g?T("template",{},(f=e.default)==null?void 0:f.call(e)):null}}})}typeof window<"u"&&!window.Konva&&require("konva");const D={install:(o,n)=>{const a=(n==null?void 0:n.prefix)||E,l={Arc:i.Arc,Arrow:i.Arrow,Circle:i.Circle,Ellipse:i.Ellipse,FastLayer:i.FastLayer,Group:i.Group,Image:i.Image,Label:i.Label,Layer:i.Layer,Line:i.Line,Path:i.Path,Rect:i.Rect,RegularPolygon:i.RegularPolygon,Ring:i.Ring,Shape:i.Shape,Sprite:i.Sprite,Star:i.Star,Tag:i.Tag,Text:i.Text,TextPath:i.TextPath,Transformer:i.Transformer,Wedge:i.Wedge,...n==null?void 0:n.customNodes};[U,...Object.entries(l).map(([e,u])=>B(e,u))].forEach(e=>{o.component(`${a}${e.name}`,e)})}};export{D as W};
