import{i as ve,g as me,j as ee,f as H,a as Ae}from"./index-711061c4.js";import{b as te,d as J,u as le,_ as pe,w as Re,a as je}from"./base-23d00206.js";import{bS as he,bR as X,b as E,i as v,y as O,d as R,aW as be,p as ge,x as ye,o as Y,c as Se,b1 as A,aN as N,u as d,bT as _e,l as j,h as Fe,C as we,K as qe,ag as q,S as ze,n as We,bu as Te,bI as G,a7 as ke,b4 as De,aP as se,af as Ke,bf as ie,a8 as ne,a as ue,D as Ue}from"./@vue-19632928.js";import{j as Ie,a as de,Q}from"./index-b8931eed.js";import{c as Z,h as ce}from"./lodash-es-cc4652a2.js";import{d as Ge,t as Qe}from"./error-78e43d3e.js";import{S as He}from"./async-validator-dee29e8b.js";import{a as Je,r as Xe}from"./@vueuse-0d360189.js";const Ye=te({size:{type:String,values:ve},disabled:Boolean}),Ze=te({...Ye,model:Object,rules:{type:J(Object)},labelPosition:{type:String,values:["left","right","top"],default:"right"},requireAsteriskPosition:{type:String,values:["left","right"],default:"left"},labelWidth:{type:[String,Number],default:""},labelSuffix:{type:String,default:""},inline:Boolean,inlineMessage:Boolean,statusIcon:Boolean,showMessage:{type:Boolean,default:!0},validateOnRuleChange:{type:Boolean,default:!0},hideRequiredAsterisk:Boolean,scrollToError:Boolean,scrollIntoViewOptions:{type:[Object,Boolean]}}),et={validate:(c,p,e)=>(he(c)||X(c))&&Ie(p)&&X(e)};function tt(){const c=E([]),p=v(()=>{if(!c.value.length)return"0";const u=Math.max(...c.value);return u?`${u}px`:""});function e(u){const i=c.value.indexOf(u);return i===-1&&p.value,i}function n(u,i){if(u&&i){const f=e(i);c.value.splice(f,1,u)}else u&&c.value.push(u)}function t(u){const i=e(u);i>-1&&c.value.splice(i,1)}return{autoLabelWidth:p,registerLabelWidth:n,deregisterLabelWidth:t}}const $=(c,p)=>{const e=Z(p);return e.length>0?c.filter(n=>n.prop&&e.includes(n.prop)):c},lt="ElForm",rt=O({name:lt}),ot=O({...rt,props:Ze,emits:et,setup(c,{expose:p,emit:e}){const n=c,t=[],u=me(),i=le("form"),f=v(()=>{const{labelPosition:r,inline:a}=n;return[i.b(),i.m(u.value||"default"),{[i.m(`label-${r}`)]:r,[i.m("inline")]:a}]}),P=r=>t.find(a=>a.prop===r),g=r=>{t.push(r)},s=r=>{r.prop&&t.splice(t.indexOf(r),1)},b=(r=[])=>{n.model&&$(t,r).forEach(a=>a.resetField())},S=(r=[])=>{$(t,r).forEach(a=>a.clearValidate())},x=v(()=>!!n.model),M=r=>{if(t.length===0)return[];const a=$(t,r);return a.length?a:[]},F=async r=>C(void 0,r),W=async(r=[])=>{if(!x.value)return!1;const a=M(r);if(a.length===0)return!0;let _={};for(const y of a)try{await y.validate(""),y.validateState==="error"&&y.resetField()}catch(I){_={..._,...I}}return Object.keys(_).length===0?!0:Promise.reject(_)},C=async(r=[],a)=>{const _=!_e(a);try{const y=await W(r);return y===!0&&await(a==null?void 0:a(y)),y}catch(y){if(y instanceof Error)throw y;const I=y;return n.scrollToError&&L(Object.keys(I)[0]),await(a==null?void 0:a(!1,I)),_&&Promise.reject(I)}},L=r=>{var a;const _=$(t,r)[0];_&&((a=_.$el)==null||a.scrollIntoView(n.scrollIntoViewOptions))};return R(()=>n.rules,()=>{n.validateOnRuleChange&&F().catch(r=>Ge())},{deep:!0,flush:"post"}),be(ee,ge({...ye(n),emit:e,resetFields:b,clearValidate:S,validateField:C,getField:P,addField:g,removeField:s,...tt()})),p({validate:F,validateField:C,resetFields:b,clearValidate:S,scrollToField:L,fields:t}),(r,a)=>(Y(),Se("form",{class:N(d(f))},[A(r.$slots,"default")],2))}});var at=pe(ot,[["__file","form.vue"]]);const st=["","error","validating","success"],it=te({label:String,labelWidth:{type:[String,Number],default:""},labelPosition:{type:String,values:["left","right","top",""],default:""},prop:{type:J([String,Array])},required:{type:Boolean,default:void 0},rules:{type:J([Object,Array])},error:String,validateStatus:{type:String,values:st},for:String,inlineMessage:{type:[String,Boolean],default:""},showMessage:{type:Boolean,default:!0},size:{type:String,values:ve}}),fe="ElLabelWrap";var nt=O({name:fe,props:{isAutoWidth:Boolean,updateAll:Boolean},setup(c,{slots:p}){const e=j(ee,void 0),n=j(H);n||Qe(fe,"usage: <el-form-item><label-wrap /></el-form-item>");const t=le("form"),u=E(),i=E(0),f=()=>{var s;if((s=u.value)!=null&&s.firstElementChild){const b=window.getComputedStyle(u.value.firstElementChild).width;return Math.ceil(Number.parseFloat(b))}else return 0},P=(s="update")=>{We(()=>{p.default&&c.isAutoWidth&&(s==="update"?i.value=f():s==="remove"&&(e==null||e.deregisterLabelWidth(i.value)))})},g=()=>P("update");return Fe(()=>{g()}),we(()=>{P("remove")}),qe(()=>g()),R(i,(s,b)=>{c.updateAll&&(e==null||e.registerLabelWidth(s,b))}),Je(v(()=>{var s,b;return(b=(s=u.value)==null?void 0:s.firstElementChild)!=null?b:null}),g),()=>{var s,b;if(!p)return null;const{isAutoWidth:S}=c;if(S){const x=e==null?void 0:e.autoLabelWidth,M=n==null?void 0:n.hasLabel,F={};if(M&&x&&x!=="auto"){const W=Math.max(0,Number.parseInt(x,10)-i.value),L=(n.labelPosition||e.labelPosition)==="left"?"marginRight":"marginLeft";W&&(F[L]=`${W}px`)}return q("div",{ref:u,class:[t.be("item","label-wrap")],style:F},[(s=p.default)==null?void 0:s.call(p)])}else return q(ze,{ref:u},[(b=p.default)==null?void 0:b.call(p)])}}});const ut=O({name:"ElFormItem"}),dt=O({...ut,props:it,setup(c,{expose:p}){const e=c,n=Te(),t=j(ee,void 0),u=j(H,void 0),i=me(void 0,{formItem:!1}),f=le("form-item"),P=Ae().value,g=E([]),s=E(""),b=Xe(s,100),S=E(""),x=E();let M,F=!1;const W=v(()=>e.labelPosition||(t==null?void 0:t.labelPosition)),C=v(()=>{if(W.value==="top")return{};const l=de(e.labelWidth||(t==null?void 0:t.labelWidth)||"");return l?{width:l}:{}}),L=v(()=>{if(W.value==="top"||t!=null&&t.inline)return{};if(!e.label&&!e.labelWidth&&xe)return{};const l=de(e.labelWidth||(t==null?void 0:t.labelWidth)||"");return!e.label&&!n.label?{marginLeft:l}:{}}),r=v(()=>[f.b(),f.m(i.value),f.is("error",s.value==="error"),f.is("validating",s.value==="validating"),f.is("success",s.value==="success"),f.is("required",Me.value||e.required),f.is("no-asterisk",t==null?void 0:t.hideRequiredAsterisk),(t==null?void 0:t.requireAsteriskPosition)==="right"?"asterisk-right":"asterisk-left",{[f.m("feedback")]:t==null?void 0:t.statusIcon,[f.m(`label-${W.value}`)]:W.value}]),a=v(()=>Ie(e.inlineMessage)?e.inlineMessage:(t==null?void 0:t.inlineMessage)||!1),_=v(()=>[f.e("error"),{[f.em("error","inline")]:a.value}]),y=v(()=>e.prop?X(e.prop)?e.prop:e.prop.join("."):""),I=v(()=>!!(e.label||n.label)),z=v(()=>e.for||(g.value.length===1?g.value[0]:void 0)),T=v(()=>!z.value&&I.value),xe=!!u,k=v(()=>{const l=t==null?void 0:t.model;if(!(!l||!e.prop))return Q(l,e.prop).value}),D=v(()=>{const{required:l}=e,o=[];e.rules&&o.push(...Z(e.rules));const h=t==null?void 0:t.rules;if(h&&e.prop){const m=Q(h,e.prop).value;m&&o.push(...Z(m))}if(l!==void 0){const m=o.map((w,V)=>[w,V]).filter(([w])=>Object.keys(w).includes("required"));if(m.length>0)for(const[w,V]of m)w.required!==l&&(o[V]={...w,required:l});else o.push({required:l})}return o}),Ce=v(()=>D.value.length>0),Ee=l=>D.value.filter(h=>!h.trigger||!l?!0:he(h.trigger)?h.trigger.includes(l):h.trigger===l).map(({trigger:h,...m})=>m),Me=v(()=>D.value.some(l=>l.required)),Le=v(()=>{var l;return b.value==="error"&&e.showMessage&&((l=t==null?void 0:t.showMessage)!=null?l:!0)}),re=v(()=>`${e.label||""}${(t==null?void 0:t.labelSuffix)||""}`),B=l=>{s.value=l},Be=l=>{var o,h;const{errors:m,fields:w}=l;(!m||!w)&&console.error(l),B("error"),S.value=m?(h=(o=m==null?void 0:m[0])==null?void 0:o.message)!=null?h:`${e.prop} is required`:"",t==null||t.emit("validate",e.prop,!1,S.value)},Ve=()=>{B("success"),t==null||t.emit("validate",e.prop,!0,"")},Ne=async l=>{const o=y.value;return new He({[o]:l}).validate({[o]:k.value},{firstFields:!0}).then(()=>(Ve(),!0)).catch(m=>(Be(m),Promise.reject(m)))},oe=async(l,o)=>{if(F||!e.prop)return!1;const h=_e(o);if(!Ce.value)return o==null||o(!1),!1;const m=Ee(l);return m.length===0?(o==null||o(!0),!0):(B("validating"),Ne(m).then(()=>(o==null||o(!0),!0)).catch(w=>{const{fields:V}=w;return o==null||o(!1,V),h?!1:Promise.reject(V)}))},K=()=>{B(""),S.value="",F=!1},ae=async()=>{const l=t==null?void 0:t.model;if(!l||!e.prop)return;const o=Q(l,e.prop);F=!0,o.value=ce(M),await We(),K(),F=!1},Oe=l=>{g.value.includes(l)||g.value.push(l)},$e=l=>{g.value=g.value.filter(o=>o!==l)};R(()=>e.error,l=>{S.value=l||"",B(l?"error":"")},{immediate:!0}),R(()=>e.validateStatus,l=>B(l||""));const U=ge({...ye(e),$el:x,size:i,validateState:s,labelId:P,inputIds:g,isGroup:T,hasLabel:I,fieldValue:k,addInputId:Oe,removeInputId:$e,resetField:ae,clearValidate:K,validate:oe});return be(H,U),Fe(()=>{e.prop&&(t==null||t.addField(U),M=ce(k.value))}),we(()=>{t==null||t.removeField(U)}),p({size:i,validateMessage:S,validateState:s,validate:oe,clearValidate:K,resetField:ae}),(l,o)=>{var h;return Y(),Se("div",{ref_key:"formItemRef",ref:x,class:N(d(r)),role:d(T)?"group":void 0,"aria-labelledby":d(T)?d(P):void 0},[q(d(nt),{"is-auto-width":d(C).width==="auto","update-all":((h=d(t))==null?void 0:h.labelWidth)==="auto"},{default:G(()=>[d(I)?(Y(),ke(De(d(z)?"label":"div"),{key:0,id:d(P),for:d(z),class:N(d(f).e("label")),style:se(d(C))},{default:G(()=>[A(l.$slots,"label",{label:d(re)},()=>[Ke(ie(d(re)),1)])]),_:3},8,["id","for","class","style"])):ne("v-if",!0)]),_:3},8,["is-auto-width","update-all"]),ue("div",{class:N(d(f).e("content")),style:se(d(L))},[A(l.$slots,"default"),q(Ue,{name:`${d(f).namespace.value}-zoom-in-top`},{default:G(()=>[d(Le)?A(l.$slots,"error",{key:0,error:S.value},()=>[ue("div",{class:N(d(_))},ie(S.value),3)]):ne("v-if",!0)]),_:3},8,["name"])],6)],10,["role","aria-labelledby"])}}});var Pe=pe(dt,[["__file","form-item.vue"]]);const yt=Re(at,{FormItem:Pe}),St=je(Pe);export{St as E,yt as a};
