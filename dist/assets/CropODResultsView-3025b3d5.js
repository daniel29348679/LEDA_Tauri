import{b as j}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import"./el-input-51d05b2a.js";import{E as L}from"./el-input-number-815f9c07.js";import{a as W}from"./el-button-ded9ecc1.js";/* empty css                */import{a as q,E as d}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as S,a as y}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E,a as G}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as C,c as Q}from"./el-main-e0dc383b.js";import{E as F}from"./el-alert-65b82b76.js";import"./el-image-viewer-1a9f012d.js";import{E as H}from"./el-divider-67eeba91.js";import{E as J}from"./el-slider-07e60acd.js";import"./el-tooltip-4ed993c7.js";import{E as K,a as I}from"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import{d as X,o as Y}from"./@element-plus-a8abf029.js";import{_ as Z}from"./UploadFile.vue_vue_type_script_setup_true_lang-d804558e.js";import{u as x}from"./uploadFile-6ce60004.js";import{u as ee,i as le,e as N,f as $,o as te}from"./index-d07dfee2.js";import{R as oe}from"./ResultImgWithStash-c075e0f0.js";import{y as ae,h as re,b as u,p as D,c,a as f,bf as R,ag as o,u as l,bI as r,S as z,o as n,a7 as v,b0 as ie,af as se,a8 as b}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./@vueuse-0d360189.js";import"./index-b8931eed.js";import"./index-711061c4.js";import"./typescript-defaf979.js";import"./index-6127babd.js";import"./event-9519ab40.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./index-32075738.js";import"./error-78e43d3e.js";import"./@ctrl-f8748455.js";import"./async-validator-dee29e8b.js";import"./vnode-18f2a975.js";import"./normalize-wheel-es-ed76fb12.js";import"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import"./use-dialog-b8544ca4.js";import"./refs-e3a131a0.js";import"./StashSelect-5af938b3.js";import"./stashSpace-391fdb88.js";import"./pinia-71cafef5.js";import"./validator-7d68535e.js";import"./json-editor-vue3-5344cb8d.js";import"./jsoneditor-5f1e2c9e.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./el-card-a6aa41d5.js";const ne={class:"step-page"},me={class:"step-nav"},ue={key:0},pe={key:1},de={key:2},wl=ae({__name:"CropODResultsView",setup(ce){const k=ee();re(()=>{console.log("Crop OD results"),B()});const w=u(),i=u(1),O=u([]),M=x(),m=u([""]),g=u(.7),p=u([]),V=u([]),s=D({model_name:"",device:"cpu",crop_m:1,crop_n:1,img_size:640}),U=D({model_name:[{required:!0,message:le.global.t("NoModelName"),trigger:"blur"}]}),B=async()=>{const t=await N("json","/api/listdirs",{model:"OD"});if(t==null)return;const e=await t.data;if(console.log("result =>",e),e.code!==0){$(`API Error: ${e.code}`);return}m.value=e.result.folder_list,s.model_name=m.value.length>0?m.value[0]:"",console.log("modelFolder =>",m),console.log("modelFolder len =>",m.value.length)},A=async t=>{t&&await t.validate(async(e,a)=>{if(e){console.log("submit!"),console.log(s);const _=te();await T(),h(),_.close()}else console.log("error submit!",a)})},T=async()=>{const t=await N("json","/api/init_od",s);if(console.log("res =>",t),t==null)return;const e=await t.data;if(console.log("result =>",e),e.code!==0){$(`API Error: ${e.code}`);return}},P=async()=>{const t=M.uploadResult;if(t){if(t.code!==0){$(`API Error: ${t.code}`);return}p.value=t.result.all_names,V.value=t.result.dict_label_num,h()}},h=()=>{i.value++};return(t,e)=>(n(),c(z,null,[f("h4",null,R(t.$t("CropODResults")),1),o(l(H)),f("div",ne,[f("div",me,[o(l(G),{active:i.value,"finish-status":"success",class:"w3-margin-bottom",direction:l(k).lt.md?"horizontal":"vertical"},{default:r(()=>[o(l(E),{title:t.$t("ModelSet"),onClick:e[0]||(e[0]=a=>i.value=1),class:"pointer"},{icon:r(()=>[o(j,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),o(l(E),{title:t.$t("Upload"),icon:l(X),onClick:e[1]||(e[1]=a=>(i.value=2,O.value=[])),class:"pointer"},null,8,["title","icon"]),o(l(E),{title:t.$t("Generate"),icon:l(Y),onClick:e[2]||(e[2]=a=>i.value=p.value.length>0?3:2),class:"pointer"},null,8,["title","icon"])]),_:1},8,["active","direction"])]),o(l(Q),null,{default:r(()=>[i.value===1?(n(),c("div",ue,[m.value.length===0?(n(),v(l(C),{key:0,style:{height:"10vh"}},{default:r(()=>[o(l(F),{title:t.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(n(),v(l(C),{key:1},{default:r(()=>[i.value===1?(n(),v(l(q),{key:0,ref_key:"ruleFormRef",ref:w,model:s,rules:U,"label-width":l(k).lt.sm?"100px":"210px","label-position":"left",class:"demo-ruleForm","status-icon":""},{default:r(()=>[o(l(d),{label:t.$t("ModelName")},{default:r(()=>[o(l(S),{modelValue:s.model_name,"onUpdate:modelValue":e[3]||(e[3]=a=>s.model_name=a)},{default:r(()=>[(n(!0),c(z,null,ie(m.value,(a,_)=>(n(),v(l(y),{label:a,value:a,key:_},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(l(d),{label:t.$t("Device")},{default:r(()=>[o(l(S),{modelValue:s.device,"onUpdate:modelValue":e[4]||(e[4]=a=>s.device=a)},{default:r(()=>[o(l(y),{label:"cpu",value:"cpu"}),o(l(y),{label:"cuda",value:"cuda"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(l(d),{label:t.$t("ImgSize")},{default:r(()=>[o(l(L),{modelValue:s.img_size,"onUpdate:modelValue":e[5]||(e[5]=a=>s.img_size=a),min:224},null,8,["modelValue"])]),_:1},8,["label"]),o(l(d),{label:t.$t("Threshold")},{default:r(()=>[o(l(J),{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value=a),min:.01,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"]),o(l(d),null,{default:r(()=>[o(l(W),{type:"primary",onClick:e[7]||(e[7]=a=>A(w.value))},{default:r(()=>[se(R(t.$t("ModelSet")),1)]),_:1})]),_:1})]),_:1},8,["model","rules","label-width"])):b("",!0)]),_:1}))])):b("",!0),i.value===2?(n(),c("div",pe,[o(Z,{api:"/api/crop_od_results",click:P,type:"image",param:{threshold:g.value},"exist-stash-space":""},null,8,["param"])])):b("",!0),i.value===3&&p.value.length!==0?(n(),c("div",de,[o(oe,{all_names:p.value},{default:r(()=>[e[8]||(e[8]=f("br",null,null,-1)),e[9]||(e[9]=f("br",null,null,-1)),o(l(K),{data:V.value,border:"",stripe:"",style:{width:"50%"}},{default:r(()=>[o(l(I),{prop:"label",label:"label"}),o(l(I),{prop:"number",label:"number"})]),_:1},8,["data"])]),_:1},8,["all_names"])])):b("",!0),i.value===3&&p.value.length===0?(n(),v(l(F),{key:3,title:t.$t("NoODResult"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])):b("",!0)]),_:1})])],64))}});export{wl as default};
