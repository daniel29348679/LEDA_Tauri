import{b as D}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as h}from"./el-button-ded9ecc1.js";import{E as b,a as O}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as A,a as U}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as J}from"./el-divider-67eeba91.js";import{E as M,a as K}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as g}from"./el-main-e0dc383b.js";import{E as T}from"./el-alert-65b82b76.js";/* empty css                */import{E as X}from"./el-image-viewer-1a9f012d.js";import{E as Y}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import"./el-input-number-815f9c07.js";import"./el-tooltip-4ed993c7.js";import{E as Z,a as P}from"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import{u as x,i as k,f as d,o as q}from"./index-d07dfee2.js";import{b as ee}from"./earthApi-baaacd65.js";import{u as te}from"./app_camera-ba436274.js";import{u as ae}from"./app_od-02ba87cd.js";import{y as le,b as y,p as z,F as oe,h as re,c as _,a as E,bf as w,ag as l,u as e,bI as r,a7 as u,a8 as S,S as L,o as s,b0 as j,af as C}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./typescript-defaf979.js";import"./normalize-wheel-es-ed76fb12.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";const ie={class:"step-page"},ne={class:"step-nav"},se={key:0},rt=le({__name:"AppObjectDetection",setup(me){const H=x(),m=te(),n=ae();let v=!1;const I=y(),F=y(),f=y(1),c=y([""]),i=z({model_name:"",cam_name:"",crop_m:1,crop_n:1,threshold:.7}),V=z({model_name:[{required:!0,message:k.global.t("NoModelName"),trigger:"blur"}],cam_name:[{required:!0,message:k.global.t("Label.PleaseSelect",{name:k.global.t("Label.Camera")}),trigger:"blur"}]}),N=async()=>{const t=await ee.api.listdirsApiListdirsPost({model:"OD"});if(t===void 0||t.data.code===void 0){d("list od weights fail");return}const a=t.data;if(console.log("result =>",a),a.code!==0){d(`list od weights fail: ${a.code}`);return}c.value=a.result.folder_list,i.model_name=c.value.length>0?c.value[0]:""},R=async(t,a)=>{t&&await t.validate(async(o,p)=>{o?(console.log("submit!"),console.log(i),a?await Q():(await W(),await B())):console.log("error submit!",p)})},Q=async()=>{const t=q();try{const a=await n.startInfer(i.cam_name,i.threshold);if(a!==0){d(`od poc live inferencing fail : ${a}`);return}v=!0,await $()}finally{t.close()}},W=async()=>{const t=q();try{const a=await n.init(i.model_name);if(a!==0){d(`od poc model init fail : ${a}`);return}}finally{t.close()}},G=async()=>{await N(),f.value=1},B=async()=>{if(n.info.load){f.value=2;const t=await m.loadCameraList();if(t!==0){d(`load casmera list fail : ${t}`);return}m.cameraList.length>0&&i.cam_name===""&&(i.cam_name=m.cameraList[0].name);return}f.value=1},$=async()=>{if(!(!n.info.doing||!v))try{const t=await n.getInferResult();if(t!==0){d(`od inference result API Error : ${t}`);return}}finally{setTimeout($,40)}};return oe(()=>v=!1),re(async()=>{console.log("OD POC Infer");let t=await n.checkInfo();if(t!==0){d(`check od poc info fail : ${t}`);return}if(!n.info.load){await N();return}if(f.value=2,t=await m.loadCameraList(),t!==0&&d(`load casmera list fail : ${t}`),m.cameraList.length===0?i.cam_name="":n.info.cam_name!==""&&~m.cameraList.findIndex(a=>a.name===n.info.cam_name)?i.cam_name=n.info.cam_name:i.cam_name=m.cameraList[0].name,n.info.doing){v=!0,await $();return}}),(t,a)=>(s(),_(L,null,[E("h4",null,w(t.$t("Dashboard.OD")),1),l(e(J)),E("div",ie,[E("div",ne,[l(e(K),{active:f.value,"finish-status":"success",class:"w3-margin-bottom",direction:e(H).lt.md?"horizontal":"vertical"},{default:r(()=>[l(e(M),{title:t.$t("ModelSet"),onClick:a[0]||(a[0]=o=>G()),class:"pointer"},{icon:r(()=>[l(D,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),l(e(M),{title:t.$t("Inference"),onClick:a[1]||(a[1]=o=>B()),class:"pointer"},{icon:r(()=>[l(D,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),f.value===1?(s(),u(e(g),{key:0},{default:r(()=>[c.value.length===0?(s(),u(e(g),{key:0,style:{height:"10vh"}},{default:r(()=>[l(e(T),{title:t.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(s(),u(e(g),{key:1},{default:r(()=>[l(e(O),{ref_key:"ruleFormRef",ref:I,model:i,rules:V,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:r(()=>[l(e(b),{label:t.$t("ModelName")},{default:r(()=>[l(e(A),{modelValue:i.model_name,"onUpdate:modelValue":a[2]||(a[2]=o=>i.model_name=o)},{default:r(()=>[(s(!0),_(L,null,j(c.value,(o,p)=>(s(),u(e(U),{label:o,value:o,key:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(e(b),null,{default:r(()=>[l(e(h),{type:"primary",onClick:a[3]||(a[3]=o=>R(I.value,!1))},{default:r(()=>[C(w(t.$t("ModelSet")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),_:1})):S("",!0),f.value===2?(s(),u(e(g),{key:1},{default:r(()=>[e(n).info.doing?(s(),_("div",se,[l(e(h),{type:"danger",onClick:a[4]||(a[4]=o=>e(n).stopInfer())},{default:r(()=>[C(w(t.$t("Button.Stop",{name:t.$t("Inference")})),1)]),_:1}),l(e(g),null,{default:r(()=>[l(e(Z),{data:e(n).inferResult},{default:r(()=>[l(e(P),{prop:"label",label:"Label","min-width":80}),l(e(P),{prop:"number",label:"Number","min-width":100})]),_:1},8,["data"]),l(e(X),{src:e(n).imgURL,"preview-src-list":[e(n).imgURL],fit:"scale-down"},null,8,["src","preview-src-list"])]),_:1})])):(s(),u(e(O),{key:1,ref_key:"inferFormRef",ref:F,model:i,rules:V,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:r(()=>[e(m).cameraList.length===0?(s(),u(e(T),{key:0,type:"warning",title:t.$t("Hint.AddCameraFirst"),center:"","show-icon":"",closable:!1},null,8,["title"])):S("",!0),l(e(b),{label:t.$t("Button.Select",{name:t.$t("Label.Camera")})},{default:r(()=>[l(e(A),{modelValue:i.cam_name,"onUpdate:modelValue":a[5]||(a[5]=o=>i.cam_name=o),filterable:"","no-data-text":"No camera",placeholder:"No camera"},{default:r(()=>[(s(!0),_(L,null,j(e(m).cameraList,(o,p)=>(s(),u(e(U),{label:`${o.name} (${o.cam_type==="cv"?o.src:o.cam_type})`,value:o.name,key:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),l(e(b),{label:t.$t("Threshold")},{default:r(()=>[l(e(Y),{modelValue:i.threshold,"onUpdate:modelValue":a[6]||(a[6]=o=>i.threshold=o),min:.1,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"]),l(e(b),null,{default:r(()=>[l(e(h),{type:"primary",onClick:a[7]||(a[7]=o=>R(F.value,!0)),disabled:i.cam_name===""},{default:r(()=>[C(w(t.$t("Button.Start",{name:t.$t("Inference")})),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"]))]),_:1})):S("",!0)])],64))}});export{rt as default};
