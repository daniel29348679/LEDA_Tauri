import{b as q}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as S}from"./el-button-ded9ecc1.js";import{E as _,a as te}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as B,a as P}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as T}from"./el-divider-67eeba91.js";import{E as U,a as le}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as O,c as oe}from"./el-main-e0dc383b.js";import{E as z}from"./el-alert-65b82b76.js";/* empty css                */import{E as ae}from"./el-switch-30a59a69.js";import{E as ie}from"./el-image-viewer-1a9f012d.js";import{E as G}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import"./el-input-number-815f9c07.js";import"./el-tooltip-4ed993c7.js";import{o as re}from"./@element-plus-a8abf029.js";import{u as se,i as ne,f,o as de}from"./index-d07dfee2.js";import{b as A}from"./earthApi-baaacd65.js";import{d as me}from"./pinia-71cafef5.js";import{b as p,y as ue,p as W,h as pe,c as v,a as y,bf as k,ag as o,u as t,bI as i,a7 as c,a8 as w,S as C,o as s,b0 as F,af as E}from"./@vue-19632928.js";import{_ as ce}from"./UploadFile.vue_vue_type_script_setup_true_lang-d804558e.js";import{u as fe}from"./uploadFile-6ce60004.js";import{R as _e}from"./ResultImgWithStash-c075e0f0.js";import{_ as ve}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./validator-7d68535e.js";import"./typescript-defaf979.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import"./use-dialog-b8544ca4.js";import"./refs-e3a131a0.js";import"./el-checkbox-d46297b7.js";import"./StashSelect-5af938b3.js";import"./stashSpace-391fdb88.js";import"./el-card-a6aa41d5.js";import"./jsoneditor-5f1e2c9e.js";const I="aoi-ododocr",ge=me("app-aoi-ododocr",()=>{const R=p({load:!1}),V=async(m,n)=>{const d=await A.api.initOdodocrApiInitOdodocrPost({name:I,model_name_string:m,model_name_alphabet:n});return d==null||d.data.code==null?-1:d.data.code!==0?d.data.code:await u()},u=async()=>{const m=await A.api.infoOdodocrApiInfoOdodocrGet({name:I});return console.log("res =>",m),m===void 0||m.data.code===void 0?-1:m.data.code!==0?m.data.code:(R.value=m.data.result,0)};return{info:R,init:V,checkInfo:u}}),be={class:"step-page"},he={class:"step-nav"},Oe={key:0},ye={class:"inline-block-wrapper"},ke={class:"image-wrap"},we=ue({__name:"AppODODOCRAOI",setup(R){const V=se(),u=ge(),m=p(),n=p(1),d=p(!1),$=p([""]),g=p([""]),Q=fe(),D=p([]),N=p([]),r=W({isUseStringModel:!1,model_name_string:"",model_name_alphabet:""}),j=W({model_name_alphabet:[{required:!0,message:ne.global.t("NoModelName"),trigger:"blur"}]}),H=async()=>{const e=await A.api.listdirsApiListdirsPost({model:"OD"});if(e===void 0||e.data.code===void 0){f("list od weights fail");return}const l=e.data;if(console.log("result =>",l),l.code!==0){f(`list od weights fail: ${l.code}`);return}$.value=l.result.folder_list,r.model_name_string=$.value.length>0?$.value[0]:""},J=async()=>{const e=await A.api.listdirsApiListdirsPost({model:"OD"});if(e===void 0||e.data.code===void 0){f("list od weights fail");return}const l=e.data;if(console.log("result =>",l),l.code!==0){f(`list od weights fail: ${l.code}`);return}g.value=l.result.folder_list,r.model_name_alphabet=g.value.length>0?g.value[0]:""},K=async e=>{e&&await e.validate(async(l,a)=>{l?(console.log("submit!"),console.log(r),await X()):console.log("error submit!",a)})},X=async()=>{const e=de();try{const l=await u.init(r.model_name_string,r.model_name_alphabet);if(l!==0){f(`od od ocr poc model init fail : ${l}`);return}n.value=1,d.value=!0}finally{e.close()}};pe(async()=>{console.log("OD OD OCR AOI");let e=await u.checkInfo();if(e!==0){f(`check od od ocr aoi info fail : ${e}`);return}await H(),await J(),u.info.load?(r.model_name_string=u.info.model_name_string??"",r.model_name_alphabet=u.info.model_name_alphabet??"",n.value=1,d.value=!0):d.value=!1});const Y=()=>{r.model_name_string="",r.model_name_alphabet="",n.value=1,d.value=!1},Z=()=>{d.value=!1},b=p({threshold_string:.7,threshold_alphabet:.7,name:I}),L=()=>{d.value&&(n.value=2)},x=async e=>{if(r.isUseStringModel=e,!e){r.model_name_string="";return}},ee=()=>{const e=Q.uploadResult;if(e){if(e.code!==0){f(`API Error: ${e.code}`);return}D.value=e.result.all_names,N.value=e.result.all_result_text,n.value++}};return(e,l)=>(s(),v(C,null,[y("h4",null,k(e.$t("Dashboard.AOI_ODODOCR")),1),o(t(T)),y("div",be,[y("div",he,[o(t(le),{active:n.value,"finish-status":"success",class:"w3-margin-bottom",direction:t(V).lt.md?"horizontal":"vertical"},{default:i(()=>[o(t(U),{title:e.$t("ModelSet"),onClick:l[0]||(l[0]=a=>n.value=1),class:"pointer"},{icon:i(()=>[o(q,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),o(t(U),{title:e.$t("Inference"),onClick:L,class:"pointer"},{icon:i(()=>[o(q,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"]),o(t(U),{title:e.$t("Generate"),icon:t(re),onClick:l[1]||(l[1]=a=>n.value=3),class:"pointer"},null,8,["title","icon"])]),_:1},8,["active","direction"])]),n.value===1?(s(),c(t(O),{key:0},{default:i(()=>[!t(u).info.load&&g.value.length===0?(s(),c(t(O),{key:0,style:{height:"10vh"}},{default:i(()=>[o(t(z),{title:e.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(s(),c(t(O),{key:1},{default:i(()=>[o(t(te),{ref_key:"ruleFormRef",ref:m,model:r,rules:j,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[o(t(_),{label:e.$t("ODODOCR.UseStrModel"),"label-width":"auto"},{default:i(()=>[o(t(ae),{modelValue:r.isUseStringModel,"onUpdate:modelValue":l[2]||(l[2]=a=>r.isUseStringModel=a),onChange:l[3]||(l[3]=a=>x(a))},null,8,["modelValue"])]),_:1},8,["label"]),r.isUseStringModel?(s(),c(t(_),{key:0,label:e.$t("ModelName")+"-"+e.$t("ODODOCR.StrModel")},{default:i(()=>[o(t(B),{modelValue:r.model_name_string,"onUpdate:modelValue":l[4]||(l[4]=a=>r.model_name_string=a)},{default:i(()=>[(s(!0),v(C,null,F($.value,(a,h)=>(s(),c(t(P),{label:a,value:a,key:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])):w("",!0),o(t(_),{label:e.$t("ModelName")+"-"+e.$t("ODODOCR.AlphModel")},{default:i(()=>[o(t(B),{modelValue:r.model_name_alphabet,"onUpdate:modelValue":l[5]||(l[5]=a=>r.model_name_alphabet=a)},{default:i(()=>[(s(!0),v(C,null,F(g.value,(a,h)=>(s(),c(t(P),{label:a,value:a,key:h},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(t(_),null,{default:i(()=>[o(t(S),{type:"primary",disabled:d.value,onClick:l[6]||(l[6]=a=>K(m.value))},{default:i(()=>[E(k(e.$t("ModelSet")),1)]),_:1},8,["disabled"]),o(t(S),{type:"danger",class:"q-ml-md",onClick:Z},{default:i(()=>[E(k(e.$t("UnLock")),1)]),_:1}),o(t(S),{link:"",class:"q-ml-md",onClick:Y},{default:i(()=>[E(k(e.$t("Reset")),1)]),_:1}),o(t(S),{type:"primary",class:"q-mr-md",onClick:L,disabled:!d.value},{default:i(()=>[E(k(e.$t("Inference")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),_:1})):w("",!0),n.value===2?(s(),c(t(O),{key:1},{default:i(()=>[o(t(oe),null,{default:i(()=>[t(u).info.model_name_string!==""?(s(),c(t(_),{key:0,label:e.$t("Threshold")+"-"+e.$t("ODODOCR.StrModel")},{default:i(()=>[o(t(G),{modelValue:b.value.threshold_string,"onUpdate:modelValue":l[7]||(l[7]=a=>b.value.threshold_string=a),min:.01,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"])):w("",!0),o(t(_),{label:e.$t("Threshold")+"-"+e.$t("ODODOCR.AlphModel")},{default:i(()=>[o(t(G),{modelValue:b.value.threshold_alphabet,"onUpdate:modelValue":l[8]||(l[8]=a=>b.value.threshold_alphabet=a),min:.01,max:1,step:.01},null,8,["modelValue"])]),_:1},8,["label"]),o(ce,{api:"/api/infer_ododocr",click:ee,type:"image",tip:e.$t("UploadImg"),param:{...b.value},"exist-stash-space":""},null,8,["tip","param"])]),_:1})]),_:1})):w("",!0),o(t(O),null,{default:i(()=>{var a;return[n.value===3&&((a=D.value)!=null&&a.length)?(s(),v("div",Oe,[o(_e,{"download-link":`/api/download_result?name=${t(I)??""}`},{default:i(()=>[y("div",ye,[(s(!0),v(C,null,F(D.value,(h,M)=>(s(),v("div",{key:M,class:"inline-block"},[o(t(z),{class:"scroll q-pa-sm",title:N.value[M],type:"success",closable:!1,style:{height:"200px","overflow-y":"auto"}},null,8,["title"]),y("div",ke,[o(t(ie),{style:{height:"200px",margin:"5px"},src:h,"preview-src-list":D.value,"initial-index":M,fit:"contain"},null,8,["src","preview-src-list","initial-index"])]),o(t(T))]))),128))])]),_:1},8,["download-link"])])):w("",!0)]}),_:1})])],64))}});const Vt=ve(we,[["__scopeId","data-v-118fd9ef"]]);export{Vt as default};
