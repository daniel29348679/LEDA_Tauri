import"./base-23d00206.js";/* empty css               */import{a as X,E as Y}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{o as Z}from"./quasar-ff3737c6.js";import{a as x}from"./el-button-ded9ecc1.js";import{E as V}from"./el-form-item-62aac1b2.js";import"./el-input-51d05b2a.js";import{E as S}from"./el-input-number-815f9c07.js";import{I as ee,E as le,a as ae}from"./ImgDetectionPartition-4a04bf44.js";import{E as $}from"./el-switch-30a59a69.js";import{o as te,f as oe,i as T}from"./index-d07dfee2.js";import{b as re}from"./earthApi-baaacd65.js";import{h as ie,a as A,j as ne}from"./label-61e62ece.js";import{_ as P}from"./lodash-3dc9162a.js";import{y as se,i as ue,b as F,c,ag as i,bI as u,u as t,a7 as g,a8 as d,S as I,o as n,af as h,bf as b,aN as me,b0 as B,aP as de,a as E}from"./@vue-19632928.js";const fe={key:4},_e={key:0},ve={class:"ml-3"},pe={key:1},ce={class:"ml-3"},he={key:1},Le=se({__name:"SEGFilterSize",props:{initSEG:{type:Function},model_name:{},formInfer:{},name:{},height:{},imgUrl:{},hideFilterSize:{type:Boolean},isLoad:{type:Boolean},showDrawAlertArea:{type:Boolean}},emits:["update:formInfer"],setup(G,{expose:H,emit:O}){const _=G,W=O,e=ue({get:()=>_.formInfer,set:l=>W("update:formInfer",l)}),C=F([]),v=F("0"),y=F(0),k=F(0),z=F([]),q=()=>{if(!e.value.cls_w_h_a)return;const l=e.value.cls_w_h_a.length.toString();e.value.cls_w_h_a.push(P(z.value)),v.value=l},R=l=>{var f;if(!e.value.cls_w_h_a||e.value.cls_w_h_a.length===1)return;const a=e.value.cls_w_h_a,s=l;a.splice(s,1),(f=e.value.alert_area)==null||f.splice(s,1),s==0&&(v.value="0"),v.value===a.length.toString()&&(v.value=(a.length-1).toString())},J=l=>{if(e.value.cls_w_h_a){if(e.value.filter_type==="area"){e.value.cls_w_h_a[l].forEach(a=>{a.a=y.value});return}e.value.cls_w_h_a[l].forEach(a=>{a.w=y.value,a.h=k.value})}},M=async l=>{var s,f,o;const a=te();try{const p=await re.api.classNamesV8SegApiClassNamesSegPost({name:_.name||""});if(!p)return;const w=p.data;console.log("result =>",w);const r=w.result.all_labels;if(z.value=r.map(m=>({cls:m,w:0,h:0,a:0})),e.value.cls_w_h_a&&!l||(s=e.value)!=null&&s.cls_w_h_a&&JSON.stringify((f=e.value)==null?void 0:f.cls_w_h_a)===JSON.stringify([[]]))for(let m=0;m<((o=e.value.cls_w_h_a)==null?void 0:o.length);m++)e.value.cls_w_h_a&&(e.value.cls_w_h_a[m]=P(z.value));if(w.code!==0){oe(`API Error: ${w.code}`);return}}finally{a.close()}},j=()=>{e.value.cls_w_h_a=void 0,e.value.alert_area=void 0,e.value.filter_type=void 0},U=()=>{e.value.alert_area&&(C.value=[{name:"test",labels:e.value.alert_area.map((l,a)=>({...ie(l),label:`Part ${a+1}`}))}])},N=async l=>{e.value.isSizeFilter=l,l&&await L(_.model_name,!0,!_.isLoad)},Q=l=>{if(e.value.isPartitionFilter=l,!l){e.value.alert_area=[A],e.value.cls_w_h_a=[[...z.value]],v.value="0";return}e.value.cls_w_h_a&&(e.value.cls_w_h_a=[P(e.value.cls_w_h_a[0])]),v.value="0",e.value.alert_area=[A],U()},L=async(l,a=!0,s=!1)=>{if(l===""){j();return}a&&(e.value.cls_w_h_a=[P(z.value)],e.value.alert_area=[A],await _.initSEG()),await M(s),v.value="0"},K=async l=>{await l.forEach(a=>{var f;if(!e.value.alert_area)return;const s=(f=a.label.match(/\d+/))==null?void 0:f[0];s!=null&&(e.value.alert_area[+s-1]=ne(a))}),U()},D=F();return H({onChangeModelName:L,onChangeSizeFilter:N,handlePartLabel:U,openImgDetectionPartition:()=>{var l;(l=D.value)==null||l.open()}}),(l,a)=>{const s=X,f=Y;return n(),c(I,null,[i(t(V),{label:l.$t("FilterSize"),"label-width":"auto"},{default:u(()=>[i(t($),{modelValue:e.value.isSizeFilter,"onUpdate:modelValue":a[0]||(a[0]=o=>e.value.isSizeFilter=o),onChange:a[1]||(a[1]=o=>N(o))},null,8,["modelValue"])]),_:1},8,["label"]),e.value.isSizeFilter&&_.showDrawAlertArea?(n(),g(t(V),{key:0,label:l.$t("DrawAlertArea"),"label-width":"auto"},{default:u(()=>[i(t($),{modelValue:e.value.draw_alert_area,"onUpdate:modelValue":a[2]||(a[2]=o=>e.value.draw_alert_area=o)},null,8,["modelValue"])]),_:1},8,["label"])):d("",!0),e.value.isSizeFilter?(n(),g(t(V),{key:1,label:l.$t("FilterMethod"),"label-width":"auto"},{default:u(()=>[i(f,{modelValue:e.value.filter_type,"onUpdate:modelValue":a[3]||(a[3]=o=>e.value.filter_type=o)},{default:u(()=>[i(s,{label:l.$t("Area"),value:"area"},null,8,["label"]),i(s,{label:l.$t("W_H"),value:"w_h"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"])):d("",!0),e.value.isSizeFilter?(n(),g(t(V),{key:2,label:l.$t("FilterPartition"),"label-width":"auto"},{default:u(()=>[i(t($),{modelValue:e.value.isPartitionFilter,"onUpdate:modelValue":a[4]||(a[4]=o=>e.value.isPartitionFilter=o),"active-text":t(T).global.t("Partition"),"inactive-text":t(T).global.t("Global"),onChange:a[5]||(a[5]=o=>Q(o))},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])):d("",!0),e.value.isSizeFilter&&e.value.isPartitionFilter&&l.formInfer.cls_w_h_a?(n(),g(ee,{key:"SEG",ref_key:"imgDetectionPartitionRef",ref:D,"label-length":l.formInfer.cls_w_h_a.length,"file-labels":C.value,"set-info":K,"img-url":_.imgUrl},{default:u(()=>[i(t(x),{type:"primary",class:me({"q-ml-sm":!_.imgUrl}),onClick:q},{default:u(()=>[h(b(l.$t("AddPartition")),1)]),_:1},8,["class"])]),_:1},8,["label-length","file-labels","img-url"])):d("",!0),e.value.isSizeFilter?(n(),c("div",fe,[l.formInfer.cls_w_h_a?(n(),g(t(ae),{key:0,modelValue:v.value,"onUpdate:modelValue":a[9]||(a[9]=o=>v.value=o),class:"q-mb-sm",type:"border-card",closable:e.value.isPartitionFilter,onTabRemove:R,style:{"max-width":"100%"}},{default:u(()=>[(n(!0),c(I,null,B(l.formInfer.cls_w_h_a,(o,p)=>(n(),g(t(le),{class:"setting-scroll scroll-bar",key:p.toString(),label:e.value.isPartitionFilter?l.$t("Partition")+(p+1):l.$t("Global"),name:p.toString(),style:de({"max-height":_.height,"overflow-y":"auto","overflow-x":"hidden"})},{default:u(()=>{var w;return[((w=l.formInfer.cls_w_h_a[p])==null?void 0:w.length)>1?(n(),c("div",_e,[i(t(V),{class:"border-form setting"},{default:u(()=>[e.value.isSizeFilter&&l.formInfer.filter_type==="w_h"?(n(),c(I,{key:0},[E("span",null,[h(b(l.$t("Width"))+"(px)： ",1),i(t(S),{modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=r=>y.value=r),min:0,size:"small"},null,8,["modelValue"])]),E("span",ve,[h(b(l.$t("Height"))+"(px)： ",1),i(t(S),{modelValue:k.value,"onUpdate:modelValue":a[7]||(a[7]=r=>k.value=r),min:0,size:"small"},null,8,["modelValue"])])],64)):d("",!0),e.value.isSizeFilter&&l.formInfer.filter_type==="area"?(n(),c("span",pe,[h(b(l.$t("Area"))+"(px*px)： ",1),i(t(S),{modelValue:y.value,"onUpdate:modelValue":a[8]||(a[8]=r=>y.value=r),min:0,size:"small"},null,8,["modelValue"])])):d("",!0),i(Z,{color:"primary",class:"q-ml-md",onClick:()=>{J(p)}},{default:u(()=>[h(b(l.$t("OneClickSetting")),1)]),_:2},1032,["onClick"])]),_:2},1024)])):d("",!0),(n(!0),c(I,null,B(l.formInfer.cls_w_h_a[p],r=>(n(),g(t(V),{class:"border-form",key:r.cls,label:r.cls},{default:u(()=>[e.value.isSizeFilter&&l.formInfer.filter_type==="w_h"?(n(),c(I,{key:0},[E("span",null,[h(b(l.$t("Width"))+"(px)： ",1),i(t(S),{modelValue:r.w,"onUpdate:modelValue":m=>r.w=m,min:0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]),E("span",ce,[h(b(l.$t("Height"))+"(px)： ",1),i(t(S),{modelValue:r.h,"onUpdate:modelValue":m=>r.h=m,min:0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])])],64)):d("",!0),e.value.isSizeFilter&&l.formInfer.filter_type==="area"?(n(),c("span",he,[h(b(l.$t("Area"))+"(px*px)： ",1),i(t(S),{modelValue:r.a,"onUpdate:modelValue":m=>r.a=m,min:0,size:"small"},null,8,["modelValue","onUpdate:modelValue"])])):d("",!0)]),_:2},1032,["label"]))),128))]}),_:2},1032,["label","name","style"]))),128))]),_:1},8,["modelValue","closable"])):d("",!0)])):d("",!0)],64)}}});export{Le as _};
