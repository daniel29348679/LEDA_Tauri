import"./base-23d00206.js";/* empty css                  */import{c as V,a as x}from"./el-main-e0dc383b.js";import{E as A}from"./el-divider-67eeba91.js";import{E as D}from"./el-image-viewer-1a9f012d.js";import{E as _}from"./el-alert-65b82b76.js";import{E as I}from"./el-form-item-62aac1b2.js";import{E as S}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import{E as N}from"./el-input-number-815f9c07.js";import"./el-tooltip-4ed993c7.js";import"./el-scrollbar-e3b486eb.js";import{e as v,o as B,f as b}from"./index-d07dfee2.js";import{C as F}from"./CameraOpen-7e226201.js";import{y as G,h as L,F as O,b as k,o as n,a7 as m,bI as p,ag as s,c as h,u as a,a8 as d}from"./@vue-19632928.js";const T={key:0},U={key:1},j={key:2,class:"demo-image__preview"},re=G({__name:"InferCamera",props:{infer_kernel:{},threshold:{},draw_box:{type:Boolean},score_type:{}},setup(E){const e=E;L(()=>{console.log("Infer Camera")}),O(async()=>{await w(),e.threshold!==void 0&&(i.value=e.threshold)});const t=k(""),u=k(""),i=k(e.threshold??.7),$=async r=>{let l=localStorage.getItem("ts")??"";l===""&&(l=`${Date.now()}`,localStorage.setItem("ts",l)),t.value=r+`&t=${l}`,console.log("resultImgAddress: "+t.value)},g=()=>{localStorage.removeItem("ts"),t.value=""},C=async()=>{const r=B(),l=new FormData;e.threshold!==void 0&&l.append("threshold",`${i.value}`),e.infer_kernel==="ad"&&(l.append("draw_box",`${e.draw_box}`),l.append("score_type",`${e.score_type}`));const o=await v("form","/api/start_live_infer_"+e.infer_kernel,l);if(console.log("formData =>",l),console.log("threshold =>",e.threshold),console.log("infer_kernel =>",e.infer_kernel),o==null){r.close();return}const c=await o.data;if(console.log("result =>",c),c.code!==0){b(`API Error: ${c.code}`),r.close();return}let f=localStorage.getItem("ts")??"";f===""&&(f=`${Date.now()}`,localStorage.setItem("ts",f)),t.value=c.result.result_image+`&t=${f}`,(e.infer_kernel==="ad"||e.infer_kernel==="cls")&&y(),console.log("resultImgAddress: "+t.value),r.close()},y=async()=>{if(t.value==="")return;let r=!0;try{const l=await v("json","/api/infer_"+e.infer_kernel+"/live_result",void 0,"Get");if(l==null)return;const o=await l.data;if(o.code!==0){b(`API Error: ${o.code}`),r=o.code!==4;return}u.value=o.result.last_result}finally{r&&setTimeout(y,40)}},w=async()=>{const r=await v("json","/api/stop_live_infer_"+e.infer_kernel,void 0);console.log("infer_kernel =>",e.infer_kernel),r!=null&&g()};return(r,l)=>(n(),m(a(x),null,{default:p(()=>[s(a(V),null,{default:p(()=>[s(F,{auto_close:"","after-open":e.infer_kernel!==""?C:$,"after-close":e.infer_kernel!==""?w:g},null,8,["after-open","after-close"]),e.infer_kernel==="ad"?(n(),h("div",T,[s(a(I),{class:"q-mt-md",label:r.$t("Threshold")},{default:p(()=>[s(a(N),{modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=o=>i.value=o),precision:2,step:.01,disabled:t.value!==""},null,8,["modelValue","disabled"])]),_:1},8,["label"])])):d("",!0),e.infer_kernel==="od"||e.infer_kernel==="seg"||e.infer_kernel==="cls"||e.infer_kernel==="pose"?(n(),h("div",U,[s(a(I),{label:r.$t("Threshold")},{default:p(()=>[s(a(S),{modelValue:i.value,"onUpdate:modelValue":l[1]||(l[1]=o=>i.value=o),min:.1,max:1,step:.01,disabled:t.value!==""},null,8,["modelValue","disabled"])]),_:1},8,["label"])])):d("",!0),s(a(A)),t.value!==""?(n(),h("div",j,[e.infer_kernel==="ad"&&u.value==="OK"?(n(),m(a(_),{key:0,title:"OK",type:"success",style:{width:"520px"},closable:!1})):d("",!0),e.infer_kernel==="ad"&&u.value==="NG"?(n(),m(a(_),{key:1,title:"NG",type:"error",style:{width:"520px"},closable:!1})):d("",!0),e.infer_kernel==="cls"?(n(),m(a(_),{key:2,title:u.value,type:"success",closable:!1},null,8,["title"])):d("",!0),s(a(D),{src:t.value,"preview-src-list":[t.value],fit:"scale-down"},null,8,["src","preview-src-list"])])):d("",!0)]),_:1})]),_:1}))}});export{re as _};
