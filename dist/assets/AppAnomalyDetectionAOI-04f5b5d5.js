import{b as P}from"./quasar-ff3737c6.js";import{y as K,h as Z,b as _,p as F,c as h,a as I,bf as g,ag as i,u as t,bI as s,S as U,o as c,a7 as C,B as ee,bC as te,b0 as oe,af as S,a8 as R}from"./@vue-19632928.js";import"./base-23d00206.js";import{a as k}from"./el-button-ded9ecc1.js";/* empty css                */import{a as ae,E as b}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as B,a as D}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as L,a as le}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as z}from"./el-main-e0dc383b.js";import{E as re}from"./el-alert-65b82b76.js";import{E as ie}from"./el-divider-67eeba91.js";import"./el-input-51d05b2a.js";import{E as O}from"./el-input-number-815f9c07.js";import{E as q}from"./el-switch-30a59a69.js";import{f as $,u as ne,i as T,e as se,o as G}from"./index-d07dfee2.js";import{u as me,_ as H}from"./app_aoi_ad-0e4a855e.js";import{a as de}from"./label-61e62ece.js";import{_ as pe}from"./ADFilterSize.vue_vue_type_script_setup_true_lang-733b71be.js";import{_ as j,a as ue}from"./lodash-3dc9162a.js";import{I as fe}from"./InferImg-e3b2bb14.js";import{_ as _e}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./typescript-defaf979.js";import"./validator-7d68535e.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./decimal.js-d133ee8e.js";import"./ImgDetectionPartition-4a04bf44.js";import"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import"./@element-plus-a8abf029.js";import"./app_camera-ba436274.js";import"./KonvaPaint-e9087f28.js";import"./vue-drag-resize-6bf710ae.js";import"./el-image-viewer-1a9f012d.js";import"./el-popover-74fee5eb.js";import"./dropdown-c44bb395.js";import"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import"./use-dialog-b8544ca4.js";import"./refs-e3a131a0.js";import"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import"./normalize-wheel-es-ed76fb12.js";import"./el-tooltip-4ed993c7.js";import"./el-slider-07e60acd.js";import"./stashSpace-391fdb88.js";import"./StashSelect-5af938b3.js";import"./ResultImgWithStash-c075e0f0.js";import"./el-card-a6aa41d5.js";import"./jsoneditor-5f1e2c9e.js";const ce={class:"step-page"},ve={class:"step-nav"},be={key:0,style:{height:"10vh"}},ge={key:1,style:{flex:"1 1 100%",width:"100%"}},we={style:{width:"100%"}},ye=K({__name:"AppAnomalyDetectionAOI",setup(he){Z(async()=>{var e,l,p,v,f;console.log("SEG Infer"),await W();let a=await n.checkInfo();if(a!==0){$(`check od aoi info fail : ${a}`);return}if(n.info.load){if(o.crop_m=n.info.crop_m??-1,o.crop_n=n.info.crop_n??-1,o.device=n.info.device??"cpu",o.draw_box=n.info.draw_box??!0,o.score_type=n.info.score_type??"map_score",n.info.model_name){for(;!d.value;)await new Promise(E=>setTimeout(E,1e3));n.info.model_name&&(await((e=d.value)==null?void 0:e.onChangeModelName(n.info.model_name,!1)),o.model_name=n.info.model_name)}r.w_h_a=j(n.info.w_h_a),r.alert_area=j(n.info.alert_area),(l=d.value)==null||l.handlePartLabel(),r.filter_type=n.info.filter_type,r.alert_area&&((p=r.alert_area)==null?void 0:p.length)>0&&(r.isSizeFilter=!0,r.draw_alert_area=n.info.draw_alert_area,((v=r.alert_area)==null?void 0:v.length)>=2&&(r.isPartitionFilter=!0),((f=r.alert_area)==null?void 0:f.length)===1&&ue(r.alert_area[0],de).length>0&&(r.isPartitionFilter=!0)),u.value=1,m.value=!0}else m.value=!1,o.model_name===""&&(o.model_name=w.value[0])});const N=ne(),n=me(),m=_(!1),M=_(),u=_(1),w=_([""]),d=_(),o=F({model_name:"",crop_m:1,crop_n:1,device:"cpu",draw_box:!0,score_type:"map_score"}),r=F({model_name:"",w_h_a:void 0,alert_area:void 0,filter_type:"w_h",isPartitionFilter:!1,isSizeFilter:!1,draw_alert_area:!1,crop_m:1,crop_n:1}),Q=F({model_name:[{required:!0,message:T.global.t("NoModelName"),trigger:"blur"}]}),W=async()=>{const a=await se("json","/api/listdirs",{model:"AD"});if(a==null)return;const e=await a.data;if(console.log("result =>",e),e.code!==0){$(`API Error: ${e.code}`);return}w.value=e.result.folder_list},X=async a=>{var e,l,p;if(((e=r.w_h_a)==null?void 0:e.length)!==((l=r.alert_area)==null?void 0:l.length)){$(T.global.t("Hint.SetAllPartitionLabels")),(p=d.value)==null||p.openImgDetectionPartition();return}a&&await a.validate(async(v,f)=>{if(v){console.log("submit!"),console.log(o);const E=G();await A(!0),E.close()}else console.log("error submit!",f)})},A=async a=>{const e=G(),l=r.isSizeFilter?r.w_h_a:void 0,p=r.isSizeFilter?r.alert_area:void 0,v=r.isSizeFilter?r.draw_alert_area:!1;try{const f=await n.init({model_name:o.model_name,w_h_a:l,alert_area:p,filter_type:r.filter_type,crop_m:o.crop_m,crop_n:o.crop_n,isFinal:a,draw_alert_area:v,device:o.device,draw_box:o.draw_box,score_type:o.score_type});if(f!==0){$(`od poc model init fail : ${f}`);return}u.value=1,y.value=n.threshold,console.log("initAD",y.value),a&&(m.value=!0)}finally{e.close()}},Y=()=>{var a;r.w_h_a=void 0,r.alert_area=void 0,r.filter_type="w_h",r.isPartitionFilter=!1,r.isSizeFilter=!1,o.crop_m=1,o.crop_n=1,m.value=!1,(a=d==null?void 0:d.value)==null||a.onChangeModelName(o.model_name)},J=()=>{m.value=!1},y=_(0),V=_(),x=async()=>{m.value&&(await A(!0),u.value=2,V.value&&V.value.closeResult())};return(a,e)=>(c(),h(U,null,[I("h4",null,g(a.$t("Dashboard.AOI_AD")),1),i(t(ie)),I("div",ce,[I("div",ve,[i(t(le),{active:u.value,"finish-status":"success",class:"w3-margin-bottom",direction:t(N).lt.md?"horizontal":"vertical"},{default:s(()=>[i(t(L),{title:a.$t("ModelSet"),onClick:e[0]||(e[0]=l=>u.value=1),class:"pointer"},{icon:s(()=>[i(P,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),i(t(L),{title:a.$t("Inference"),onClick:x,class:"pointer"},{icon:s(()=>[i(P,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),i(t(z),{style:{height:"70vh",width:"100%",overflow:"auto","padding-bottom":"20px"},class:"scroll-bar"},{default:s(()=>[u.value===1?(c(),C(t(z),{key:0},{default:s(()=>[w.value.length===0?(c(),h("div",be,[i(t(re),{title:a.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])])):(c(),h("div",ge,[ee(i(t(ae),{ref_key:"ruleFormRef",ref:M,model:o,rules:Q,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:s(()=>[i(t(b),{label:a.$t("ModelName"),"label-width":"auto"},{default:s(()=>[i(t(B),{modelValue:o.model_name,"onUpdate:modelValue":e[1]||(e[1]=l=>o.model_name=l),onChange:e[2]||(e[2]=()=>{var l;m.value=!1,(l=d.value)==null||l.onChangeModelName(o.model_name)})},{default:s(()=>[(c(!0),h(U,null,oe(w.value,(l,p)=>(c(),C(t(D),{label:l,value:l,key:p},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(t(b),{label:a.$t("Device")},{default:s(()=>[i(t(B),{modelValue:o.device,"onUpdate:modelValue":e[3]||(e[3]=l=>o.device=l)},{default:s(()=>[i(t(D),{label:"cpu",value:"cpu"}),i(t(D),{label:"cuda",value:"cuda"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(t(b),{label:a.$t("CropX")},{default:s(()=>[i(t(O),{modelValue:o.crop_m,"onUpdate:modelValue":e[4]||(e[4]=l=>o.crop_m=l),min:1},null,8,["modelValue"])]),_:1},8,["label"]),i(t(b),{label:a.$t("CropY")},{default:s(()=>[i(t(O),{modelValue:o.crop_n,"onUpdate:modelValue":e[5]||(e[5]=l=>o.crop_n=l),min:1},null,8,["modelValue"])]),_:1},8,["label"]),i(t(b),{label:a.$t("ResultImgType")},{default:s(()=>[i(t(q),{modelValue:o.draw_box,"onUpdate:modelValue":e[6]||(e[6]=l=>o.draw_box=l),size:"large","active-text":a.$t("Box"),"inactive-text":a.$t("HeatmapMask")},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"]),i(t(b),{label:a.$t("ResultScoreType")},{default:s(()=>[i(t(q),{modelValue:o.score_type,"onUpdate:modelValue":e[7]||(e[7]=l=>o.score_type=l),size:"large","active-text":a.$t("MapScore"),"inactive-text":a.$t("ImgScore"),"active-value":"map_score","inactive-value":"image_score",onChange:e[8]||(e[8]=()=>{r.isSizeFilter=!1})},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"]),i(pe,{formInfer:r,"onUpdate:formInfer":e[9]||(e[9]=l=>r=l),ref_key:"ADFilterSizeRef",ref:d,initAD:A,model_name:o.model_name,name:t(H),height:t(N).lt.md?"20vh":"25vh","show-draw-alert-area":""},null,8,["formInfer","model_name","name","height"]),I("div",we,[i(t(k),{type:"primary",onClick:e[10]||(e[10]=l=>X(M.value)),disabled:m.value},{default:s(()=>[S(g(a.$t("ModelSet")),1)]),_:1},8,["disabled"]),i(t(k),{type:"danger",class:"q-ml-md",onClick:J},{default:s(()=>[S(g(a.$t("UnLock")),1)]),_:1}),i(t(k),{link:"",class:"q-ml-md",onClick:Y},{default:s(()=>[S(g(a.$t("Reset")),1)]),_:1}),i(t(k),{type:"primary",class:"q-mr-md",onClick:x,disabled:!m.value},{default:s(()=>[S(g(a.$t("Inference")),1)]),_:1},8,["disabled"])])]),_:1},8,["model","rules"]),[[te,u.value===1]])]))]),_:1})):R("",!0),u.value===2?(c(),C(t(z),{key:1},{default:s(()=>[i(fe,{threshold:y.value,"onUpdate:threshold":e[11]||(e[11]=l=>y.value=l),ref_key:"InferImgRef",ref:V,infer_kernel:"ad",draw_box:t(n).info.draw_box,score_type:t(n).info.score_type,name:t(H)},null,8,["threshold","draw_box","score_type","name"])]),_:1})):R("",!0)]),_:1})])],64))}});const qt=_e(ye,[["__scopeId","data-v-2d6c8443"]]);export{qt as default};
