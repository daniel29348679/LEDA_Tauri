import{b as L}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as F}from"./el-button-ded9ecc1.js";import{E as oe}from"./el-card-a6aa41d5.js";import{E as se,a as D}from"./el-row-67417f48.js";/* empty css                  */import{a as M}from"./el-main-e0dc383b.js";import{E as ie}from"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";/* empty css                */import{a as re,E as c}from"./el-form-item-62aac1b2.js";import{E as ne}from"./el-image-viewer-1a9f012d.js";import"./el-input-51d05b2a.js";import{E as V}from"./el-input-number-815f9c07.js";import{E as O,a as R}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as j}from"./el-popover-74fee5eb.js";/* empty css               */import{E as H,a as ue}from"./el-steps-c8cdef54.js";import{E as W}from"./el-switch-30a59a69.js";import{E as de}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{E as z}from"./el-alert-65b82b76.js";import{u as me,_ as pe}from"./app_aoi_ad-0e4a855e.js";import{f as Y,i as E,w as fe,o as ce,e as ve}from"./index-d07dfee2.js";import{p as be}from"./@element-plus-a8abf029.js";import{B as ge}from"./vue-chartjs-22160128.js";import{C as we,p as ye,a as Ve,b as Ee,f as _e,d as $e,e as he}from"./chart.js-1176e628.js";import{u as Se,a as ke,b as Ie}from"./seadeep-d6d1f5e3.js";import{E as Ce}from"./index-b8931eed.js";import{y as De,b as u,i as U,h as Ue,F as Be,u as e,a7 as _,bI as s,c as y,af as g,bf as v,a as f,o as m,ag as a,S as $,b0 as B}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./index-711061c4.js";import"./@vueuse-0d360189.js";import"./@ctrl-f8748455.js";import"./typescript-defaf979.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./use-dialog-b8544ca4.js";import"./event-9519ab40.js";import"./refs-e3a131a0.js";import"./vnode-18f2a975.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-6127babd.js";import"./index-32075738.js";import"./dropdown-c44bb395.js";import"./validator-7d68535e.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./@kurkle-36ca2f10.js";import"./lodash-3dc9162a.js";const xe={style:{width:"120px","min-width":"120px"}},Ae={style:{width:"100%"}},Pe={key:0},Te={class:"scroll-bar",style:{maxHeight:"200px",overflowY:"auto"}},Ne=["src"],Le={key:1,class:"w3-xxlarge w3-pale-yellow w3-center"},zl=De({__name:"AnomalyDetectionAOI",setup(Fe){we.register(ye,Ve,Ee,_e,$e,he);const q=Se(),x=ke(),G=Ie(),i=me(),b=u(1),p=u([]),A=u(""),h=u(!1),P=u(!1),Q=u(""),X=u(""),n=u(),S=u({labels:[],datasets:[]}),Z=u({responsive:!0,animations:{},scales:{y:{beginAtZero:!0,stacked:!0}},interaction:{intersect:!1,mode:"dataset"}}),k=U(()=>{const t=[],l=[],o=[];if(n.value&&n.value.all_results.length>0)for(let r=0;r<n.value.all_results.length;r++){const d=n.value.all_results[r];o.push(n.value.all_results[r]);const w=t.indexOf(d);~w?l[w]+=1:(t.push(d),l.push(1))}return{imgNames:o,labels:t,counts:l}}),J=U(()=>k.value.labels),K=U(()=>k.value.counts),T=()=>({labels:J.value,datasets:[{label:"Count",data:K.value,backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(255, 159, 64, 0.2)","rgba(255, 205, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(54, 162, 235, 0.2)","rgba(153, 102, 255, 0.2)","rgba(201, 203, 207, 0.2)"],borderColor:["rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(54, 162, 235)","rgb(153, 102, 255)","rgb(201, 203, 207)"],borderWidth:2}]}),ee=async()=>{if(console.log("files ==>",p),console.log("files value ==>",p.value),p.value.length===0){fe(E.global.t("NoFile"));return}const t=ce(E.global.t("Inferencing"));try{const l=new FormData;for(const d of p.value){const w=await d.raw.arrayBuffer();l.append("image",new Blob([w]),d.name)}l.append("threshold",`${i.info.threshold}`),l.append("name",pe),l.append("draw_box",`${i.info.draw_box}`),l.append("score_type",`${i.info.score_type}`);const o=await ve("form","/api/infer_ad",l);if(o==null)return;const r=await o.data;if(console.log("infer result = ",r),r.code!==0){Y(`API Error: ${r.code}`);return}console.log("infer result = ",r),Q.value="",X.value="",n.value=r.result,b.value=2,p.value=[],S.value=T()}finally{t.close()}},le=(t,l)=>{console.log(t,l)},ae=t=>{A.value=t.url,h.value=!0};let I=u(null);const N=async()=>{let t=await i.checkInfo();if(t!==0){Y(`check ad aoi info fail : ${t}`);return}i.info.load||(b.value=1),I.value=setTimeout(N,i.info.load?2e3:1e3)},te=async()=>{P.value=!0;try{await G.getDatasetList()}finally{P.value=!1}};return Ue(async()=>{await q.load(),await x.loadLastProject(),x.currentProject&&await te(),await N(),S.value=T()}),Be(()=>{I.value&&clearTimeout(I.value)}),(t,l)=>e(i).info.load?(m(),_(e(M),{key:0,class:"w3-margin-top"},{default:s(()=>[f("div",xe,[a(e(ue),{active:b.value,"finish-status":b.value===1&&p.value.length===0?"finish":"success",class:"w3-margin-bottom",direction:"vertical",style:{height:"20vh"}},{default:s(()=>[a(e(H),{title:t.$t("Inference"),onClick:l[0]||(l[0]=o=>b.value=1),class:"pointer"},{icon:s(()=>[a(L,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"]),a(e(H),{title:t.$t("Result"),onClick:l[1]||(l[1]=o=>b.value=n.value?2:1),class:"pointer"},{icon:s(()=>[a(L,{name:"fa-solid fa-chart-area",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","finish-status"])]),f("div",Ae,[b.value===1||!n.value?(m(),y("div",Pe,[a(e(M),null,{default:s(()=>[a(e(j),{width:400,trigger:"click"},{reference:s(()=>[a(e(F),{type:"info"},{default:s(()=>[g(v(t.$t("ModelSet")),1)]),_:1})]),default:s(()=>[a(e(re),{"label-position":"left","status-icon":""},{default:s(()=>[a(e(c),{label:t.$t("Device")},{default:s(()=>[a(e(O),{modelValue:e(i).info.device,"onUpdate:modelValue":l[2]||(l[2]=o=>e(i).info.device=o),disabled:""},{default:s(()=>[a(e(R),{label:"cpu",value:"cpu"}),a(e(R),{label:"cuda",value:"cuda"})]),_:1},8,["modelValue"])]),_:1},8,["label"]),a(e(c),{label:t.$t("ModelName")},{default:s(()=>[a(e(O),{modelValue:e(i).info.model_name,"onUpdate:modelValue":l[3]||(l[3]=o=>e(i).info.model_name=o),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),a(e(c),{label:t.$t("CropX")},{default:s(()=>[a(e(V),{modelValue:e(i).info.crop_m,"onUpdate:modelValue":l[4]||(l[4]=o=>e(i).info.crop_m=o),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),a(e(c),{label:t.$t("CropY")},{default:s(()=>[a(e(V),{modelValue:e(i).info.crop_n,"onUpdate:modelValue":l[5]||(l[5]=o=>e(i).info.crop_n=o),disabled:""},null,8,["modelValue"])]),_:1},8,["label"]),a(e(c),{label:t.$t("ResultImgType")},{default:s(()=>[a(e(W),{modelValue:e(i).info.draw_box,"onUpdate:modelValue":l[6]||(l[6]=o=>e(i).info.draw_box=o),size:"large","active-text":t.$t("Box"),"inactive-text":t.$t("HeatmapMask"),disabled:""},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"]),a(e(c),{label:t.$t("ResultScoreType")},{default:s(()=>[a(e(W),{modelValue:e(i).info.score_type,"onUpdate:modelValue":l[7]||(l[7]=o=>e(i).info.score_type=o),size:"large","active-text":t.$t("MapScore"),"inactive-text":t.$t("ImgScore"),"active-value":"map_score","inactive-value":"image_score",disabled:""},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"]),f("div",Te,[(m(!0),y($,null,B(e(i).info.w_h_a,(o,r)=>(m(),y($,{key:r},[g(v(`${t.$t("Partition")} ${r+1}`)+": ",1),(m(!0),y($,null,B(o,(d,w)=>(m(),_(e(c),{key:w},{default:s(()=>[f("span",null,[g(v(t.$t("Width"))+"(px)： ",1),a(e(V),{modelValue:d.w,"onUpdate:modelValue":C=>d.w=C,disabled:""},null,8,["modelValue","onUpdate:modelValue"])]),f("span",null,[g(v(t.$t("Height"))+"(px)： ",1),a(e(V),{modelValue:d.h,"onUpdate:modelValue":C=>d.h=C,disabled:""},null,8,["modelValue","onUpdate:modelValue"])])]),_:2},1024))),128))],64))),128))])]),_:1})]),_:1}),a(e(F),{class:"ml-3",type:"success",onClick:l[8]||(l[8]=o=>ee()),disabled:p.value.length===0},{default:s(()=>[g(v(t.$t("Button.Start",{name:t.$t("Inference")})),1)]),_:1},8,["disabled"])]),_:1}),a(e(c),{class:"q-mt-md",label:t.$t("Threshold")},{default:s(()=>[a(e(V),{modelValue:e(i).info.threshold,"onUpdate:modelValue":l[9]||(l[9]=o=>e(i).info.threshold=o),precision:2,step:.01},null,8,["modelValue"])]),_:1},8,["label"]),a(e(de),{class:"upload-drag-img","file-list":p.value,"onUpdate:fileList":l[10]||(l[10]=o=>p.value=o),"list-type":"picture-card","auto-upload":!1,"on-preview":ae,"on-remove":le,accept:"image/*",multiple:"",drag:""},{default:s(()=>[a(e(Ce),null,{default:s(()=>[a(e(be))]),_:1})]),_:1},8,["file-list"]),a(e(ie),{modelValue:h.value,"onUpdate:modelValue":l[11]||(l[11]=o=>h.value=o)},{default:s(()=>[f("img",{class:"w3-image",src:A.value,alt:"Preview Image"},null,8,Ne)]),_:1},8,["modelValue"])])):(m(),_(e(se),{key:1},{default:s(()=>[a(e(D),{xs:24,sm:12},{default:s(()=>[a(e(ge),{data:S.value,options:Z.value},null,8,["data","options"])]),_:1}),a(e(D),null,{default:s(()=>[a(e(z),{title:e(E).global.t("AllTime")+" : "+n.value.all_time+" sec",type:"info",closable:!1},null,8,["title"]),a(e(z),{title:e(E).global.t("MeanTime")+" : "+n.value.mean_time+" sec",type:"info",closable:!1},null,8,["title"]),l[12]||(l[12]=f("br",null,null,-1))]),_:1}),(m(!0),y($,null,B(k.value.imgNames,(o,r)=>(m(),_(e(D),{key:r,xs:24,sm:12,md:8,lg:6,xl:4},{default:s(()=>[a(e(j),{width:200},{reference:s(()=>[a(e(oe),{"body-style":{padding:"0px"}},{default:s(()=>[a(e(ne),{fit:"scale-down",src:n.value.all_names[r],alt:o,"preview-src-list":n.value.all_names.slice(r).concat(n.value.all_names.slice(0,r))},null,8,["src","alt","preview-src-list"])]),_:2},1024)]),default:s(()=>[f("div",null,v(o),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}))])]),_:1})):(m(),y("div",Le,[g(v(t.$t("Hint.GoToBackendSet"))+" ",1),l[13]||(l[13]=f("br",null,null,-1)),g(" 【"+v(t.$t("Dashboard.AOI_OD"))+"】 ",1)]))}});export{zl as default};
