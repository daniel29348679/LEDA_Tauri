import"./base-23d00206.js";import{E as B,a as we}from"./el-steps-c8cdef54.js";import{E as X}from"./el-divider-67eeba91.js";import{a as Y}from"./el-button-ded9ecc1.js";import{c as $e}from"./el-main-e0dc383b.js";import{E as se}from"./el-image-viewer-1a9f012d.js";import{E as ue}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{E as ie}from"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import{a as Ve,E as v}from"./el-form-item-62aac1b2.js";/* empty css                */import"./el-input-51d05b2a.js";import{E as H}from"./el-input-number-815f9c07.js";/* empty css               */import{E as J,a as V}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as Q}from"./el-slider-07e60acd.js";import"./el-tooltip-4ed993c7.js";import{E as ke,a as M}from"./el-table-column-5047dc3a.js";import{E as ne}from"./el-checkbox-d46297b7.js";import{E as Se}from"./el-switch-30a59a69.js";import{d as de,g as Ee,o as Ue,p as me}from"./@element-plus-a8abf029.js";import{w as L,i as D,e as O,u as Ce,f as C,o as Fe}from"./index-d07dfee2.js";import{d as Ie}from"./pinia-71cafef5.js";import{b as i,y as De,h as Ne,i as F,p as pe,c as g,a as h,bf as c,ag as o,u as l,bI as s,S as ve,o as d,af as I,a7 as b,a8 as y,b0 as Ae}from"./@vue-19632928.js";import{u as Pe}from"./stashSpace-391fdb88.js";import{S as fe}from"./StashSelect-5af938b3.js";import{R as Te}from"./ResultImgWithStash-c075e0f0.js";import{E as he}from"./index-b8931eed.js";import"./lodash-es-cc4652a2.js";import"./event-9519ab40.js";import"./vnode-18f2a975.js";import"./index-711061c4.js";import"./@vueuse-0d360189.js";import"./@ctrl-f8748455.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./typescript-defaf979.js";import"./error-78e43d3e.js";import"./use-dialog-b8544ca4.js";import"./refs-e3a131a0.js";import"./async-validator-dee29e8b.js";import"./index-6127babd.js";import"./index-32075738.js";import"./normalize-wheel-es-ed76fb12.js";import"./validator-7d68535e.js";import"./quasar-ff3737c6.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./json-editor-vue3-5344cb8d.js";import"./jsoneditor-5f1e2c9e.js";import"./el-alert-65b82b76.js";import"./el-card-a6aa41d5.js";const Be=Ie("uploadFileOKNG",()=>{const N=i();return{upload:async(k,u,f,n=void 0)=>{if(N.value=void 0,u.length===0&&(n==null?void 0:n.ok_folder_path)===""||f.length===0&&(n==null?void 0:n.ng_folder_path)==="")return L(D.global.t("NoFile")),!1;const p=new FormData;for(const m of u){const _=await m.raw.arrayBuffer();p.append("ok_image",new Blob([_]),m.name)}for(const m of f){const _=await m.raw.arrayBuffer();p.append("ng_image",new Blob([_]),m.name)}if(n)for(const m of Object.keys(n))p.append(m,`${n[m]}`);const S=await O("form",k,p);if(S==null)return!1;const E=await S.data;return N.value=E,!0},uploadResult:N}}),Me={class:"step-page"},Le={class:"step-nav"},Oe={key:0},Re={key:0},Ke={class:"el-upload__tip"},Ge={class:"el-upload__tip"},je=["src"],ze={key:1},qe={key:0},We={class:"el-upload__tip"},Xe={class:"el-upload__tip"},Ye=["src"],He={key:2,style:{padding:"20px","box-sizing":"border-box"}},Je={key:0},Qe={key:3},rt=De({__name:"ModelPerformanceView",setup(N){const R=Ce(),k=Pe();Ne(()=>{console.log("ModelPerformance")});const u=i(1),f=i([""]),n=i([]),p=i([]),S=Be(),E=i(""),m=i(!1),_=i(""),K=i(""),Z=i([]),G=i(0),A=i([]),j=i(0),z=i(0),w=i(!1),$=i(!1),P=i(""),q=i(""),x=F(()=>w.value?P.value!=="":n.value.length>0),ee=F(()=>$.value?q.value!=="":p.value.length>0),W=F(()=>x.value&&ee.value),ce=F(()=>u.value===3&&W.value),ge=F(()=>u.value===4&&W.value),a=pe({model:"",model_name:"",crop_m_value:1,crop_n_value:1,device:"cpu",threshold:[.1,.9],threshold_step:.2,score_type:"image_score"}),_e=pe({model_name:[{required:!0,message:D.global.t("NoModelName"),trigger:"blur"}]}),T=i({}),le=async()=>{const r=await O("json","/api/listdirs",{model:a.model});if(r==null)return;const e=await r.data;if(console.log("result =>",e),e.code!==0){C(`API Error: ${e.code}`);return}f.value=e.result.folder_list,a.model_name=f.value.length>0?f.value[0]:"",console.log("modelFolder =>",f),console.log("modelFolder len =>",f.value.length),a.model==="AD"?await te():(a.threshold[0]=.1,a.threshold[1]=.9),await U()},te=async()=>{if(a.model!=="AD"){a.threshold[0]=.1,a.threshold[1]=.9;return}const r=await O("json","/api/pick_ad_model_thre",{model_name:a.model_name});if(r==null)return;const e=await r.data;if(e.code!==0){C(`API Error: ${e.code}`);return}G.value=e.result.threshold,a.threshold[0]=parseFloat((e.result.threshold-.2).toFixed(3)),a.threshold[1]=parseFloat((e.result.threshold+.2).toFixed(3)),await U()},oe=()=>{if(w.value&&u.value===1&&(P.value=k.currentFolderPath),$.value&&u.value===2&&(q.value=k.currentFolderPath),u.value===1&&!x.value)return L(D.global.t("NoFile")),!1;if(u.value===2&&!ee.value)return L(D.global.t("NoFile")),!1;u.value++,k.spaceSelected=[],u.value===3&&le()},be=async()=>{if(!W.value)return L(D.global.t("NoFile")),!1;const r=Fe();try{const e={model:a.model,model_name:a.model_name,device:a.device,threshold_lower:a.threshold[0],threshold_upper:a.threshold[1],threshold_step:a.threshold_step,score_type:a.score_type};w.value&&(e.ok_folder_path=P.value),$.value&&(e.ng_folder_path=q.value),await S.upload("/api/model_performance",n.value,p.value,e);const t=S.uploadResult;if(!t)return;t.code!==0&&C(`API Error: ${t.code}`),_.value=t.result.result_performance,K.value=t.result.result_accuracy,Z.value=t.result.result,u.value++}catch(e){C(`${e}`)}finally{r.close()}},U=async()=>{console.log("threshold0 =>",a.threshold[0]),console.log("threshold1 =>",a.threshold[1]),console.log("threshold_step =>",a.threshold_step);const r=await O("json","/api/get_thre",{threshold_lower:a.threshold[0],threshold_upper:a.threshold[1],threshold_step:a.threshold_step});if(r==null)return;const e=await r.data;if(e.code!==0){C(`API Error: ${e.code}`);return}A.value=[e.result.use_thre[0],e.result.use_thre[e.result.use_thre.length-1]],j.value=e.result.use_thre[0],z.value=e.result.use_thre[e.result.use_thre.length-1],T.value={};for(const t of e.result.use_thre)T.value[t]=`${t}`;console.log("use_thre_min =>",j),console.log("use_thre_max =>",z),console.log("use_thre =>",A),console.log("marks =>",T)},ae=(r,e)=>{console.log(r,e)},re=r=>{E.value=r.url,m.value=!0};return(r,e)=>(d(),g(ve,null,[h("h4",null,c(r.$t("ModelPerformance")),1),o(l(X)),h("div",Me,[h("div",Le,[o(l(we),{active:u.value,"finish-status":"success",class:"w3-margin-bottom",direction:l(R).lt.md?"horizontal":"vertical"},{default:s(()=>[o(l(B),{title:r.$t("UploadOK"),icon:l(de),onClick:e[0]||(e[0]=t=>(u.value=1,n.value=[],p.value=[])),class:"pointer"},null,8,["title","icon"]),o(l(B),{title:r.$t("UploadNG"),icon:l(de),onClick:e[1]||(e[1]=t=>(u.value=n.value.length>0?2:1,p.value=[])),class:"pointer"},null,8,["title","icon"]),o(l(B),{title:r.$t("Setting"),icon:l(Ee),onClick:e[2]||(e[2]=t=>u.value=p.value.length>0?3:2),class:"pointer"},null,8,["title","icon"]),o(l(B),{title:r.$t("Result"),icon:l(Ue),onClick:e[3]||(e[3]=t=>u.value=p.value.length>0?4:3),class:"pointer"},null,8,["title","icon"])]),_:1},8,["active","direction"])]),o(l($e),null,{default:s(()=>[u.value===1?(d(),g("div",Oe,[o(l(Y),{type:"success",onClick:e[4]||(e[4]=t=>oe())},{default:s(()=>[I(c(r.$t("Upload")),1)]),_:1}),o(l(X)),o(l(ne),{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=t=>w.value=t)},{default:s(()=>[I(c(r.$t("Label.UsingTemporaryStorageSpace")),1)]),_:1},8,["modelValue"]),w.value?(d(),g("div",Re,[o(fe,{"is-on-page":"","is-upload":""}),h("span",Ke,c(r.$t("UploadImg")),1)])):(d(),b(l(ue),{key:1,class:"upload-drag-img","file-list":n.value,"onUpdate:fileList":e[6]||(e[6]=t=>n.value=t),action:"/api/model_performance","list-type":"picture-card","auto-upload":!1,"on-preview":re,"on-remove":ae,multiple:"",drag:""},{tip:s(()=>[h("div",Ge,c(r.$t("UploadImg")),1)]),default:s(()=>[o(l(he),null,{default:s(()=>[o(l(me))]),_:1})]),_:1},8,["file-list"])),o(l(ie),{modelValue:m.value,"onUpdate:modelValue":e[7]||(e[7]=t=>m.value=t)},{default:s(()=>[h("img",{style:{width:"100%"},src:E.value,alt:"Preview Image"},null,8,je)]),_:1},8,["modelValue"])])):y("",!0),u.value===2&&(n.value.length!==0||P.value!=="")?(d(),g("div",ze,[o(l(Y),{type:"success",onClick:e[8]||(e[8]=t=>oe())},{default:s(()=>[I(c(r.$t("Upload")),1)]),_:1}),o(l(X)),o(l(ne),{modelValue:$.value,"onUpdate:modelValue":e[9]||(e[9]=t=>$.value=t)},{default:s(()=>[I(c(r.$t("Label.UsingTemporaryStorageSpace")),1)]),_:1},8,["modelValue"]),$.value?(d(),g("div",qe,[o(fe,{"is-on-page":"","is-upload":""}),h("span",We,c(r.$t("UploadImg")),1)])):(d(),b(l(ue),{key:1,class:"upload-drag-img","file-list":p.value,"onUpdate:fileList":e[10]||(e[10]=t=>p.value=t),action:"/api/model_performance","list-type":"picture-card","auto-upload":!1,"on-preview":re,"on-remove":ae,multiple:"",drag:""},{tip:s(()=>[h("div",Xe,c(r.$t("UploadImg")),1)]),default:s(()=>[o(l(he),null,{default:s(()=>[o(l(me))]),_:1})]),_:1},8,["file-list"])),o(l(ie),{modelValue:m.value,"onUpdate:modelValue":e[11]||(e[11]=t=>m.value=t)},{default:s(()=>[h("img",{style:{width:"100%"},src:E.value,alt:"Preview Image"},null,8,Ye)]),_:1},8,["modelValue"])])):y("",!0),ce.value?(d(),g("div",He,[o(l(Ve),{ref:"ruleFormRef",model:a,rules:_e,"label-width":l(R).lt.sm?"100px":"210px","label-position":"left",class:"demo-ruleForm","status-icon":""},{default:s(()=>[o(l(v),{label:r.$t("Label.Model")},{default:s(()=>[o(l(J),{modelValue:a.model,"onUpdate:modelValue":e[12]||(e[12]=t=>a.model=t),onChange:e[13]||(e[13]=t=>le())},{default:s(()=>[o(l(V),{label:r.$t("Kernel.AD"),value:"AD"},null,8,["label"]),o(l(V),{label:r.$t("Kernel.OD"),value:"OD"},null,8,["label"]),o(l(V),{label:r.$t("Kernel.SEG"),value:"SEG"},null,8,["label"])]),_:1},8,["modelValue"])]),_:1},8,["label"]),f.value.length!==0?(d(),g("div",Je,[o(l(v),{label:r.$t("ModelName")},{default:s(()=>[o(l(J),{modelValue:a.model_name,"onUpdate:modelValue":e[14]||(e[14]=t=>a.model_name=t),onChange:e[15]||(e[15]=t=>te())},{default:s(()=>[(d(!0),g(ve,null,Ae(f.value,(t,ye)=>(d(),b(l(V),{label:t,value:t,key:ye},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(l(v),{label:r.$t("CropX")},{default:s(()=>[o(l(H),{modelValue:a.crop_m_value,"onUpdate:modelValue":e[16]||(e[16]=t=>a.crop_m_value=t),min:1},null,8,["modelValue"])]),_:1},8,["label"]),o(l(v),{label:r.$t("CropY")},{default:s(()=>[o(l(H),{modelValue:a.crop_n_value,"onUpdate:modelValue":e[17]||(e[17]=t=>a.crop_n_value=t),min:1},null,8,["modelValue"])]),_:1},8,["label"]),a.model==="AD"?(d(),b(l(v),{key:0,label:r.$t("Device")},{default:s(()=>[o(l(J),{modelValue:a.device,"onUpdate:modelValue":e[18]||(e[18]=t=>a.device=t)},{default:s(()=>[o(l(V),{label:"cpu",value:"cpu"}),o(l(V),{label:"cuda",value:"cuda"})]),_:1},8,["modelValue"])]),_:1},8,["label"])):y("",!0),a.model==="AD"?(d(),b(l(v),{key:1,label:r.$t("Threshold")},{default:s(()=>[o(l(Q),{modelValue:a.threshold,"onUpdate:modelValue":e[19]||(e[19]=t=>a.threshold=t),range:"",precision:3,min:G.value-.5,max:G.value+.5,step:.01,onChange:e[20]||(e[20]=t=>U())},null,8,["modelValue","min","max"])]),_:1},8,["label"])):(d(),b(l(v),{key:2,label:r.$t("Threshold")},{default:s(()=>[o(l(Q),{modelValue:a.threshold,"onUpdate:modelValue":e[21]||(e[21]=t=>a.threshold=t),range:"",min:.01,max:1,step:.01,onChange:e[22]||(e[22]=t=>U())},null,8,["modelValue"])]),_:1},8,["label"])),o(l(v),{label:r.$t("Step")},{default:s(()=>[o(l(H),{modelValue:a.threshold_step,"onUpdate:modelValue":e[23]||(e[23]=t=>a.threshold_step=t),precision:3,step:.05,min:.001,max:.5,onChange:e[24]||(e[24]=t=>U())},null,8,["modelValue"])]),_:1},8,["label"]),o(l(v),{label:r.$t("Button.Preview",{name:r.$t("Threshold").toLowerCase()})},{default:s(()=>[o(l(Q),{modelValue:A.value,"onUpdate:modelValue":e[25]||(e[25]=t=>A.value=t),range:"",marks:T.value,precision:3,min:j.value,max:z.value,step:a.threshold_step},null,8,["modelValue","marks","min","max","step"])]),_:1},8,["label"]),e[28]||(e[28]=h("br",null,null,-1)),a.model==="AD"?(d(),b(l(v),{key:3,label:r.$t("ResultScoreType")},{default:s(()=>[o(l(Se),{modelValue:a.score_type,"onUpdate:modelValue":e[26]||(e[26]=t=>a.score_type=t),size:"large","active-text":r.$t("MapScore"),"inactive-text":r.$t("ImgScore"),"active-value":"map_score","inactive-value":"image_score"},null,8,["modelValue","active-text","inactive-text"])]),_:1},8,["label"])):y("",!0),o(l(v),null,{default:s(()=>[o(l(Y),{type:"primary",onClick:e[27]||(e[27]=t=>be())},{default:s(()=>[I(c(r.$t("ModelSet")),1)]),_:1})]),_:1})])):y("",!0)]),_:1},8,["model","rules","label-width"])])):y("",!0),ge.value?(d(),g("div",Qe,[o(Te),o(l(se),{style:{width:"300px",height:"300px"},src:_.value,"preview-src-list":[_.value],fit:"scale-down"},null,8,["src","preview-src-list"]),o(l(se),{style:{width:"300px",height:"300px"},src:K.value,"preview-src-list":[K.value],fit:"scale-down"},null,8,["src","preview-src-list"]),o(l(ke),{data:Z.value,border:"",stripe:"",style:{width:"75%"}},{default:s(()=>[o(l(M),{prop:"threshold",label:"threshold",width:"200"}),o(l(M),{prop:"overkill",label:"overkill",width:"200"}),o(l(M),{prop:"underkill",label:"underkill",width:"200"}),o(l(M),{prop:"accuracy",label:"accuracy",width:"200"})]),_:1},8,["data"])])):y("",!0)]),_:1})])],64))}});export{rt as default};
