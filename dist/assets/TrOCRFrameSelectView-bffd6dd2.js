import"./base-23d00206.js";import{a as oe,E as le}from"./el-form-item-62aac1b2.js";/* empty css               */import{a as ae,E as se}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{b as ie}from"./quasar-ff3737c6.js";import{y as re,h as ne,b as n,p as T,c,a as m,bf as g,ag as o,u as l,bI as i,S as F,o as u,a7 as V,b0 as B,af as I,a8 as w,B as ue,bC as me}from"./@vue-19632928.js";import{E as ce}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{E as de}from"./el-dialog-f482d18c.js";import"./el-overlay-81162264.js";import{E as $,a as pe}from"./el-steps-c8cdef54.js";import{E as R}from"./el-divider-67eeba91.js";import{a as M}from"./el-button-ded9ecc1.js";import{c as fe}from"./el-main-e0dc383b.js";import{E as ve}from"./el-checkbox-d46297b7.js";import{E as D}from"./el-alert-65b82b76.js";import{E as ge}from"./el-image-viewer-1a9f012d.js";/* empty css                */import{d as _e,g as he,o as ye,p as we}from"./@element-plus-a8abf029.js";import{u as Se,i as z,e as A,f as _,o as j}from"./index-d07dfee2.js";import{u as be}from"./uploadFile-6ce60004.js";import{K as Ee}from"./KonvaPaint-e9087f28.js";import{f as ke,g as $e}from"./label-61e62ece.js";import{u as Ce}from"./stashSpace-391fdb88.js";import{S as Fe}from"./StashSelect-5af938b3.js";import{R as Ve}from"./ResultImgWithStash-c075e0f0.js";import{E as Ie}from"./index-b8931eed.js";import{_ as Re}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./index-711061c4.js";import"./@vueuse-0d360189.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./typescript-defaf979.js";import"./use-dialog-b8544ca4.js";import"./refs-e3a131a0.js";import"./vnode-18f2a975.js";import"./@ctrl-f8748455.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./el-input-51d05b2a.js";import"./vue-drag-resize-6bf710ae.js";import"./lodash-3dc9162a.js";import"./decimal.js-d133ee8e.js";import"./el-tooltip-4ed993c7.js";import"./validator-7d68535e.js";import"./el-card-a6aa41d5.js";import"./jsoneditor-5f1e2c9e.js";const Ue={class:"step-page"},Ne={class:"step-nav"},Oe={key:0},Pe={key:0,style:{height:"10vh"}},xe={key:1},Le={key:1},Te={class:"el-upload__tip"},Be={class:"el-upload__tip text-red"},Me=["src"],De={style:{display:"flex","flex-direction":"column"}},ze={key:0},Ae={class:"el-upload__tip"},je={key:2},Ke={class:"inline-block-wrapper"},We=re({__name:"TrOCRFrameSelectView",setup(qe){const K=Se(),W=Ce();ne(()=>{console.log("OCRView"),H()});const U=n(),b=n(0),E=n(0),q=async t=>{const e=t.map(a=>ke(a));te(e)},h=T({model_name:""}),r=n(1),N=be(),f=n([""]),O=n(""),C=n(!1),p=n([]),v=n([]),y=n([]),P=n([]),k=n(!1),x=n(),G=T({model_name:[{required:!0,message:z.global.t("NoModelName"),trigger:"blur"}]}),H=async()=>{const t=await A("json","/api/listdirs",{model:"OCR"});if(t==null)return;const e=await t.data;if(console.log("result =>",e),e.code!==0){_(`API Error: ${e.code}`);return}f.value=e.result.folder_list,h.model_name=f.value.length>0?f.value[0]:"",console.log("modelFolder =>",f),console.log("modelFolder len =>",f.value.length)},J=async t=>{t&&await t.validate(async(e,a)=>{if(e){console.log("submit!"),console.log(h);const d=await Q();console.log("OK"),d&&r.value++}else console.log("error submit!",a)})},Q=async()=>{const t=j();try{const e=await A("json","/api/init_ocr",h);if(console.log("res =>",e),e==null)return;const a=await e.data;if(console.log("result =>",a),a.code!==0){_(`API Error: ${a.code}`);return}return!0}catch(e){return console.log("error =>",e),e instanceof Error?_(e.message):_("{error}"),!1}finally{t.close()}},X=(t,e)=>{console.log(t,e)},Y=t=>{O.value=t.url,C.value=!0},Z=async()=>{if(b.value=0,E.value=0,await ee()){r.value++;const{width:e,height:a}=await $e(v.value[0],U);b.value=e,E.value=a}},ee=async()=>{var e,a;if(console.log(p.value,"files.value"),p.value.length===0||!((e=p.value[0])!=null&&e.raw))return _(z.global.t("NoFile")),!1;const t=URL.createObjectURL((a=p.value[0])==null?void 0:a.raw);return v.value=[t],!0},te=async t=>{const e=j();try{const a={};t&&(a.crop_position=JSON.stringify(t)),k.value&&(a.folder_path=W.currentFolderPath),await N.upload("/api/infer_ocr",p.value,a);const d=N.uploadResult;if(!d)return;if(d.code!==0){_(`API Error: ${d.code}`);return}y.value=d.result.all_names,P.value=d.result.all_result_text,r.value++}catch(a){_(`${a}`)}finally{e.close()}};return(t,e)=>{const a=ae,d=se,L=le;return u(),c(F,null,[m("h4",null,g(t.$t("FrameSelectionOCR")),1),o(l(R)),m("div",Ue,[m("div",Ne,[o(l(pe),{active:r.value,"finish-status":"success",class:"w3-margin-bottom",direction:l(K).lt.md?"horizontal":"vertical"},{default:i(()=>[o(l($),{title:t.$t("ModelSet"),onClick:e[0]||(e[0]=s=>r.value=1),class:"pointer"},{icon:i(()=>[o(ie,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),o(l($),{title:t.$t("Upload"),icon:l(_e),onClick:e[1]||(e[1]=s=>(r.value=2,p.value=[],v.value=[],y.value=[])),class:"pointer"},null,8,["title","icon"]),o(l($),{title:t.$t("Setting"),icon:l(he),onClick:e[2]||(e[2]=s=>r.value=v.value.length>0?3:2),class:"pointer"},null,8,["title","icon"]),o(l($),{title:t.$t("Generate"),icon:l(ye),onClick:e[3]||(e[3]=s=>r.value=y.value.length>0?4:3),class:"pointer"},null,8,["title","icon"])]),_:1},8,["active","direction"])]),o(l(fe),null,{default:i(()=>[r.value===1?(u(),c("div",Oe,[f.value.length===0?(u(),c("div",Pe,[o(l(D),{title:t.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])])):(u(),c("div",xe,[r.value===1?(u(),V(l(oe),{key:0,ref_key:"ruleFormRef",ref:x,model:h,rules:G,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[o(L,{label:t.$t("ModelName")},{default:i(()=>[o(d,{modelValue:h.model_name,"onUpdate:modelValue":e[4]||(e[4]=s=>h.model_name=s)},{default:i(()=>[(u(!0),c(F,null,B(f.value,(s,S)=>(u(),V(a,{label:s,value:s,key:S},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),o(L,null,{default:i(()=>[o(l(M),{type:"primary",onClick:e[5]||(e[5]=s=>J(x.value))},{default:i(()=>[I(g(t.$t("ModelSet")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])):w("",!0)]))])):w("",!0),r.value===2?(u(),c("div",Le,[o(l(M),{type:"success",onClick:e[6]||(e[6]=s=>Z())},{default:i(()=>[I(g(t.$t("Upload")),1)]),_:1}),o(l(R)),o(l(ce),{class:"upload-drag-img","file-list":p.value,"onUpdate:fileList":e[7]||(e[7]=s=>p.value=s),action:"/api/infer_ocr","list-type":"picture-card","auto-upload":!1,"on-preview":Y,"on-remove":X,multiple:"",drag:""},{tip:i(()=>[m("div",Te,g(t.$t("UploadImg")),1),m("div",Be,g(t.$t("StashSpaceUploadImageConfigureFirst")),1)]),default:i(()=>[o(l(Ie),null,{default:i(()=>[o(l(we))]),_:1})]),_:1},8,["file-list"]),o(l(de),{modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=s=>C.value=s)},{default:i(()=>[m("img",{"w-full":"",src:O.value,alt:"Preview Image"},null,8,Me)]),_:1},8,["modelValue"])])):w("",!0),ue(m("div",{ref_key:"contentRef",ref:U},[o(l(ve),{modelValue:k.value,"onUpdate:modelValue":e[9]||(e[9]=s=>k.value=s)},{default:i(()=>[I(g(t.$t("Label.UsingTemporaryStorageSpace")),1)]),_:1},8,["modelValue"]),m("div",De,[k.value?(u(),c("div",ze,[o(Fe,{"is-on-page":"","is-upload":""}),m("span",Ae,g(t.$t("UploadImg")),1)])):w("",!0)]),m("div",null,[v.value[0]&&b.value&&E.value?(u(),V(Ee,{key:0,img:v.value[0],width:b.value,height:E.value,"visible-tools":["rect","eraser","zoom-in","zoom-out","move"],"set-info":q,"single-label-name":"","single-image":"","show-right-area":!1,"tool-position":{x:125,y:-52}},null,8,["img","width","height"])):w("",!0)])],512),[[me,r.value===3&&v.value.length!==0]]),r.value===4&&y.value.length!==0?(u(),c("div",je,[o(Ve,null,{default:i(()=>[m("div",Ke,[(u(!0),c(F,null,B(y.value,(s,S)=>(u(),c("div",{key:S,class:"inline-block"},[o(l(D),{title:P.value[S],type:"success",closable:!1},null,8,["title"]),o(l(ge),{style:{width:"300px",height:"300px",margin:"10px"},src:s,"preview-src-list":y.value,"initial-index":S,fit:"scale-down"},null,8,["src","preview-src-list","initial-index"]),o(l(R))]))),128))])]),_:1})])):w("",!0)]),_:1})])],64)}}});const to=Re(We,[["__scopeId","data-v-38fbfe22"]]);export{to as default};
