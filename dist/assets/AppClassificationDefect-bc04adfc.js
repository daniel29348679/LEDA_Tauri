import{b as D}from"./quasar-ff3737c6.js";import"./base-23d00206.js";import{a as k}from"./el-button-ded9ecc1.js";import{E as c,a as P}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as S,a as M}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as G}from"./el-divider-67eeba91.js";import{E as q,a as J}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as C}from"./el-main-e0dc383b.js";import{E as L}from"./el-alert-65b82b76.js";/* empty css                */import{E as K}from"./el-image-viewer-1a9f012d.js";import{E as X}from"./el-switch-30a59a69.js";import{u as Y,i as E,f as d,o as z}from"./index-d07dfee2.js";import{b as Z}from"./earthApi-baaacd65.js";import{u as x}from"./app_camera-ba436274.js";import{u as ee}from"./app_defect_cls-7b84f4d7.js";import{y as ae,b as _,p as H,F as te,h as le,c as g,a as V,bf as $,ag as i,u as e,bI as r,a7 as m,a8 as p,S as I,o as n,b0 as O,af as h}from"./@vue-19632928.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./typescript-defaf979.js";import"./validator-7d68535e.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";const oe={class:"step-page"},se={class:"step-nav"},ie={key:1},re={key:0},xe=ae({__name:"AppClassificationDefect",setup(ne){const T=Y(),u=x(),l=ee();let v=!1;const F=_(),R=_(),f=_(1),b=_([""]),o=H({model_name:"",cam_name:"",bypass:!1,pass_values:[]}),N=H({model_name:[{required:!0,message:E.global.t("NoModelName"),trigger:"blur"}],cam_name:[{required:!0,message:E.global.t("Label.PleaseSelect",{name:E.global.t("Label.Camera")}),trigger:"blur"}]}),B=async()=>{const a=await Z.api.listdirsApiListdirsPost({model:"CLS"});if(a===void 0||a.data.code===void 0){d("list cls weights fail");return}const t=a.data;if(console.log("result =>",t),t.code!==0){d(`list cls weights fail: ${t.code}`);return}b.value=t.result.folder_list,o.model_name=b.value.length>0?b.value[0]:""},A=async(a,t)=>{a&&await a.validate(async(s,y)=>{s?(console.log("submit!"),console.log(o),t?await Q():(await W(),await U())):console.log("error submit!",y)})},Q=async()=>{const a=z();try{const t=await l.startInfer(o.cam_name,o.bypass,o.pass_values);if(t!==0){d(`cls poc live inferencing fail : ${t}`);return}v=!0,await w()}finally{a.close()}},W=async()=>{const a=z();try{const t=await l.init(o.model_name);if(t!==0){d(`cls poc model init fail : ${t}`);return}}finally{a.close()}},j=async()=>{await B(),f.value=1},U=async()=>{if(l.info.load){f.value=2;const a=await u.loadCameraList();if(a!==0){d(`load casmera list fail : ${a}`);return}u.cameraList.length>0&&o.cam_name===""&&(o.cam_name=u.cameraList[0].name);return}f.value=1},w=async()=>{if(!(!l.info.doing||!v))try{const a=await l.getInferResult();if(a!==0){d(`cls inference result API Error : ${a}`);return}}finally{setTimeout(w,40)}};return te(()=>v=!1),le(async()=>{console.log("CL Control POC Infer");let a=await l.checkInfo();if(a!==0){d(`check cls poc info fail : ${a}`);return}if(!l.info.load){await B();return}if(f.value=2,a=await l.checkDetectInfo(),a!==0){d(`check cls defect info fail : ${a}`);return}if(o.bypass=l.info.bypass??!1,o.pass_values=l.info.pass_values??[],a=await u.loadCameraList(),a!==0&&d(`load casmera list fail : ${a}`),u.cameraList.length===0?o.cam_name="":l.info.cam_name!==""&&~u.cameraList.findIndex(t=>t.name===l.info.cam_name)?o.cam_name=l.info.cam_name:o.cam_name=u.cameraList[0].name,l.info.doing){v=!0,await w();return}}),(a,t)=>(n(),g(I,null,[V("h4",null,$(a.$t("Dashboard.Defect_CLS")),1),i(e(G)),V("div",oe,[V("div",se,[i(e(J),{active:f.value,"finish-status":"success",class:"w3-margin-bottom",direction:e(T).lt.md?"horizontal":"vertical"},{default:r(()=>[i(e(q),{title:a.$t("ModelSet"),onClick:t[0]||(t[0]=s=>j()),class:"pointer"},{icon:r(()=>[i(D,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),i(e(q),{title:a.$t("Inference"),onClick:t[1]||(t[1]=s=>U()),class:"pointer"},{icon:r(()=>[i(D,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),f.value===1?(n(),m(e(C),{key:0},{default:r(()=>[b.value.length===0?(n(),m(e(C),{key:0,style:{height:"10vh"}},{default:r(()=>[i(e(L),{title:a.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(n(),m(e(C),{key:1},{default:r(()=>[i(e(P),{ref_key:"ruleFormRef",ref:F,model:o,rules:N,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:r(()=>[i(e(c),{label:a.$t("ModelName")},{default:r(()=>[i(e(S),{modelValue:o.model_name,"onUpdate:modelValue":t[2]||(t[2]=s=>o.model_name=s)},{default:r(()=>[(n(!0),g(I,null,O(b.value,(s,y)=>(n(),m(e(M),{label:s,value:s,key:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),i(e(c),null,{default:r(()=>[i(e(k),{type:"primary",onClick:t[3]||(t[3]=s=>A(F.value,!1))},{default:r(()=>[h($(a.$t("ModelSet")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),_:1})):p("",!0),f.value===2?(n(),g("div",ie,[i(e(P),{ref_key:"inferFormRef",ref:R,model:o,rules:N,"label-position":"left","status-icon":""},{default:r(()=>[e(u).cameraList.length===0?(n(),m(e(L),{key:0,type:"warning",title:a.$t("Hint.AddCameraFirst"),center:"","show-icon":"",closable:!1},null,8,["title"])):p("",!0),i(e(c),{label:a.$t("Button.Select",{name:a.$t("Label.Camera")})},{default:r(()=>[i(e(S),{modelValue:o.cam_name,"onUpdate:modelValue":t[4]||(t[4]=s=>o.cam_name=s),filterable:"","no-data-text":"No camera",placeholder:"No camera",disabled:e(l).info.doing},{default:r(()=>[(n(!0),g(I,null,O(e(u).cameraList,(s,y)=>(n(),m(e(M),{label:`${s.name} (${s.cam_type==="cv"?s.src:s.cam_type})`,value:s.name,key:y},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),i(e(c),{label:a.$t("Label.ByPass")},{default:r(()=>[i(e(X),{modelValue:o.bypass,"onUpdate:modelValue":t[5]||(t[5]=s=>o.bypass=s),disabled:e(l).info.doing},null,8,["modelValue","disabled"])]),_:1},8,["label"]),o.bypass?p("",!0):(n(),m(e(c),{key:1,label:a.$t("Label.PassValues")},{default:r(()=>[i(e(S),{modelValue:o.pass_values,"onUpdate:modelValue":t[6]||(t[6]=s=>o.pass_values=s),disabled:e(l).info.doing,placeholder:a.$t("Hint.AddPassValue"),filterable:"","allow-create":"",clearable:"",multiple:""},null,8,["modelValue","disabled","placeholder"])]),_:1},8,["label"])),i(e(c),null,{default:r(()=>[e(l).info.doing?(n(),m(e(k),{key:1,type:"danger",onClick:t[8]||(t[8]=s=>e(l).stopInfer())},{default:r(()=>[h($(a.$t("Button.Stop",{name:a.$t("Inference")})),1)]),_:1})):(n(),m(e(k),{key:0,type:"primary",onClick:t[7]||(t[7]=s=>A(R.value,!0)),disabled:o.cam_name===""},{default:r(()=>[h($(a.$t("Button.Start",{name:a.$t("Inference")})),1)]),_:1},8,["disabled"]))]),_:1})]),_:1},8,["model","rules"]),e(l).info.doing?(n(),g("div",re,[e(l).detectResult!==""?(n(),m(e(L),{key:0,title:`${e(l).detectResult.toUpperCase()} (${e(l).inferResult})`,type:e(l).detectResult==="pass"?"success":"error",closable:!1},null,8,["title","type"])):p("",!0),i(e(K),{src:e(l).imgURL,"preview-src-list":[e(l).imgURL],fit:"scale-down"},null,8,["src","preview-src-list"])])):p("",!0)])):p("",!0)])],64))}});export{xe as default};
