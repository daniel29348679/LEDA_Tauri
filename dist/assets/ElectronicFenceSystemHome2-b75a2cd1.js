import"./base-23d00206.js";import{E as G,a as N}from"./el-row-67417f48.js";import{E as B}from"./el-card-a6aa41d5.js";import{E as Z}from"./el-image-viewer-1a9f012d.js";import{E as P,a as J}from"./el-skeleton-item-b52dbad9.js";import{f as A,w as V}from"./index-d07dfee2.js";import{u as W}from"./app_efs2-b194c67d.js";import{u as X}from"./app_aoi_od-9abe0b5f.js";import{u as Y}from"./app_aoi_ad-0e4a855e.js";import{u as ee}from"./app_aoi_seg-13fc56b9.js";import{Q as I}from"./QuartCard-b656d875.js";import{L as te}from"./vue-chartjs-22160128.js";import{C as oe,p as ae,a as le,b as ne,P as re,c as se,d as ie,e as ue}from"./chart.js-1176e628.js";import{y as ce,b as d,i as $,h as fe,F as me,c as pe,a7 as j,bI as i,aP as de,u as n,a8 as H,ag as a,S as ge,o as D,a as _,bf as ve}from"./@vue-19632928.js";import{_ as _e}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./typescript-defaf979.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./earthApi-baaacd65.js";import"./axios-439bb627.js";import"./quasar-ff3737c6.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./@kurkle-36ca2f10.js";import"./jsoneditor-5f1e2c9e.js";const he={class:"card"},be={style:{"font-size":"44px","font-weight":"bold",textAlign:"center"}},ye={class:"text-white"},g="poc-efs",h=30,Se=ce({__name:"ElectronicFenceSystemHome2",setup(we){const b=ee(),y=X(),S=Y(),M=W();oe.register(ae,le,ne,re,se,ie,ue);const w=["rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(201, 203, 207)","rgb(153, 102, 255)","rgb(255, 159, 64)","rgb(54, 162, 235)","rgb(255, 99, 132)"],e=d("OD");let C=!1,u=[],f=[],c=[];const E=d(""),R=d(0),k=d(0),O=d({labels:[],datasets:[]}),T=d({responsive:!0,animation:{duration:t=>t.dataIndex===h-1?600:0},animations:{},scales:{y:{beginAtZero:!0,stacked:!0}},interaction:{intersect:!1,mode:"index"}}),z=()=>{console.log("efs result => ",c),console.log("objects => ",u),console.log("timeline => ",f);const t=f.map(o=>o.toLocaleTimeString()),p=u.map((o,v)=>({label:o,fill:!0,backgroundColor:w[v%w.length],borderColor:w[v%w.length],data:f.map((s,l)=>{const x=c[l].findIndex(K=>K.label===o);return~x?c[l][x].number:0})}));return{labels:t,datasets:p}},m=$(()=>e.value==="OD"?y.info:e.value==="AD"?S.info:e.value==="SEG"?b.info:null),L=async()=>e.value==="OD"?y.getInferResult(g):e.value==="AD"?S.getInferResult(g):e.value==="SEG"?b.getInferResult(g):0,r=$(()=>e.value==="OD"?y.inferResult:e.value==="AD"?S.inferResult:e.value==="SEG"?b.inferResult:[]),Q=async()=>e.value==="OD"?y.checkInfo(g):e.value==="AD"?S.checkInfo(g):e.value==="SEG"?b.checkInfo(g):0,U=async()=>{var t,p,o,v;try{console.log("checkLoadInfo => ",m.value);let s=await Q();if(s!==0){A(`check od poc info fail : ${s}`);return}if(!e.value){V("請先至後台設定電子圍籬應用");return}if(!((t=m.value)!=null&&t.doing)||!C)return;if((p=m.value)!=null&&p.load||V("請先至後台設定電子圍籬應用"),(o=m.value)!=null&&o.doing){if(E.value=((v=m.value)==null?void 0:v.result_image)??"",s=await L(),console.log("code => ",s),s!==0){A(`get live inference result fail: ${s}`);return}if(r.value&&typeof r.value!="string"){c.push(r.value),r.value.length>0&&u.push(...r.value.map(l=>l.label)),k.value=0;for(const l of r.value)k.value+=l==null?void 0:l.number}else{const l=[{label:r.value??"",number:1}];c.push(l),u.push(r.value??""),k.value=1}c.length>h&&(c=c.slice(1,h+1)),u=u.filter((l,x)=>u.indexOf(l)===x),f.push(new Date),f.length>h&&(f=f.slice(1,h+1)),R.value=u.length,O.value=z()}}catch(s){A(`get live inference result fail: ${s}`)}},q=async()=>{const t=await M.getEfsModel("poc-efs");console.log("doing_model => ",t),e.value=t},F=async()=>{await q(),await U();try{const t=await L();if(t!==0){A(`od inference result API Error : ${t}`);return}}finally{setTimeout(F,1e3)}};return fe(async()=>{console.log("電子圍籬應用 mounted"),C=!0,await F()}),me(async()=>{console.log("電子圍籬應用 unmounted"),C=!1}),(t,p)=>(D(),pe(ge,null,[e.value==="AD"?(D(),j(n(B),{key:0,class:"q-mt-sm",style:de({width:"250px",height:"200px","background-color":r.value==="NG"?"#f56c6c":"#67c23a",display:"flex","justify-content":"center","align-items":"center"})},{default:i(()=>[_("div",he,[_("div",be,[_("b",null,[_("span",ye,ve(r.value),1)])])])]),_:1},8,["style"])):H("",!0),e.value!=="AD"?(D(),j(n(G),{key:1,gutter:16,class:"w3-margin-top"},{default:i(()=>[a(I,{title:"Counting Numbers",value:k.value,diff:"2%",color:"red",info:"since last week",icon:""},null,8,["value"]),a(I,{title:"Specification",value:R.value,diff:"0.75%",color:"green",info:"since yesterday",icon:""},null,8,["value"]),a(I,{title:"Cameras Online",value:"1",diff:"OK",color:"green",info:"All systems are",suffix:""}),a(I,{title:"Vilolations",value:"8",diff:"2%",color:"red",info:"since last week",icon:""})]),_:1})):H("",!0),a(n(G),{gutter:16,class:"w3-margin-top"},{default:i(()=>[a(n(N),{span:12},{default:i(()=>[a(n(B),null,{default:i(()=>{var o;return[p[0]||(p[0]=_("b",null,"Timeline Statistics",-1)),a(n(P),{rows:4,style:{height:"100%"},loading:!((o=m.value)!=null&&o.doing),throttle:500,animated:""},{default:i(()=>[a(n(te),{data:O.value,options:T.value},null,8,["data","options"])]),_:1},8,["loading"])]}),_:1})]),_:1}),a(n(N),{span:12},{default:i(()=>{var o;return[a(n(P),{style:{height:"100%"},loading:!((o=m.value)!=null&&o.doing)||E.value==="",throttle:500,animated:""},{template:i(()=>[a(n(J),{variant:"image",style:{height:"100%"}})]),default:i(()=>[a(n(Z),{src:E.value,"preview-src-list":[E.value]},null,8,["src","preview-src-list"])]),_:1},8,["loading"])]}),_:1})]),_:1})],64))}});const at=_e(Se,[["__scopeId","data-v-21bb5b9e"]]);export{at as default};
