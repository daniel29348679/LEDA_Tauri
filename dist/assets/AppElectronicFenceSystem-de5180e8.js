import{b as L}from"./quasar-ff3737c6.js";import{y as le,b as u,d as oe,p as O,F as re,h as ie,c as $,a as c,bf as S,ag as r,u as a,bI as i,B as q,bC as H,a7 as d,a8 as E,S as V,o as m,b0 as K,af as A}from"./@vue-19632928.js";import"./base-23d00206.js";import{a as N}from"./el-button-ded9ecc1.js";import{E as _,a as W}from"./el-form-item-62aac1b2.js";/* empty css               */import{E as j,a as Q}from"./el-select-99a9cb58.js";import"./el-scrollbar-e3b486eb.js";import{E as ne}from"./el-divider-67eeba91.js";import{E as R,a as se}from"./el-steps-c8cdef54.js";/* empty css                  */import{a as k}from"./el-main-e0dc383b.js";import{E as Z}from"./el-alert-65b82b76.js";/* empty css                */import{E as me}from"./el-image-viewer-1a9f012d.js";import{E as ue}from"./el-slider-07e60acd.js";import"./el-input-51d05b2a.js";import"./el-input-number-815f9c07.js";import"./el-tooltip-4ed993c7.js";import{a as x,E as de}from"./el-table-column-5047dc3a.js";import"./el-checkbox-d46297b7.js";import{u as fe,i as B,f,o as G}from"./index-d07dfee2.js";import{b as ce}from"./earthApi-baaacd65.js";import{u as pe}from"./app_camera-ba436274.js";import{u as ve}from"./app_efs-f5115dc2.js";import{K as ge}from"./KonvaPaint-e9087f28.js";import{j as _e,g as ye}from"./label-61e62ece.js";import{_ as be}from"./json-editor-vue3-5344cb8d.js";import"./lodash-es-cc4652a2.js";import"./index-b8931eed.js";import"./@vueuse-0d360189.js";import"./index-711061c4.js";import"./@ctrl-f8748455.js";import"./error-78e43d3e.js";import"./async-validator-dee29e8b.js";import"./index-32075738.js";import"./event-9519ab40.js";import"./index-6127babd.js";import"./vnode-18f2a975.js";import"./typescript-defaf979.js";import"./normalize-wheel-es-ed76fb12.js";import"./pinia-71cafef5.js";import"./vue-konva-50f8b9a5.js";import"./konva-364a8bb7.js";import"./@logicflow-db5a80c3.js";import"./vue-router-841924de.js";import"./vue-i18n-76143ed6.js";import"./@intlify-0ef9a929.js";import"./axios-439bb627.js";import"./tiff.js-f0b72392.js";import"./jszip-0fc1db0a.js";import"./@quasar-a9c09e53.js";import"./vue-drag-resize-6bf710ae.js";import"./lodash-3dc9162a.js";import"./decimal.js-d133ee8e.js";import"./jsoneditor-5f1e2c9e.js";const he={class:"step-page"},we={class:"step-nav"},$e={key:0},Se={class:"infer-content"},Ee={class:"left"},ke=le({__name:"AppElectronicFenceSystem",setup(Fe){const J=fe(),p=pe(),n=ve();let y=u(!1);const D=u(),P=u(),s=u(0),b=u([""]),v=u(""),F=u(),h=u(0),w=u(0);oe(()=>v.value,async()=>{if(F.value){h.value=0,w.value=0;const{width:e,height:t}=await ye(v.value,F);h.value=e,w.value=t}});const l=O({model_name:"",cam_name:"",device:"cuda",img_size:640,threshold:.7,alert_area:[]}),T=O({model_name:[{required:!0,message:B.global.t("NoModelName"),trigger:"blur"}],cam_name:[{required:!0,message:B.global.t("Label.PleaseSelect",{name:B.global.t("Label.Camera")}),trigger:"blur"}]}),X=async e=>{if(console.log(e),l.alert_area=e.map(t=>_e(t))??[],console.log("座標資訊 => ",l.alert_area),l.alert_area.length===0){f("Please draw the alert area");return}await C(),s.value=1},C=async()=>{try{const{data:e}=await ce.api.listdirsApiListdirsPost({model:"OD"}),{code:t,result:o}=e??{};if(t!==0){f(`list od weights fail: ${t}`);return}b.value=(o==null?void 0:o.folder_list)??[],l.model_name=b.value[0]??""}catch(e){f(`list od weights fail: ${e.message}`)}},U=async()=>{v.value=`/api/camera/frame?name=${l.cam_name}&t=${Date.now()}`},M=async(e,t)=>{e&&await e.validate(async(o,g)=>{o?(console.log("submit!"),console.log(l),t?await Y():(await ee(),await z())):console.log("error submit!",g)})},Y=async()=>{const e=G();try{const t=await n.startInfer(l.cam_name,l.threshold);if(t!==0){f(`efs poc live inferencing fail : ${t}`);return}y.value=!0,await I()}finally{e.close()}},ee=async()=>{const e=G();try{const t=await n.init(l.model_name,l.alert_area);if(t!==0){f(`efs poc model init fail : ${t}`);return}}finally{e.close()}},ae=async()=>{s.value=0},te=async()=>{if(l.cam_name===""||l.alert_area.length===0){s.value=0;return}await C(),s.value=1},z=async()=>{if(l.cam_name===""){s.value=0;return}if(n.info.load){s.value=2;return}s.value=1},I=async()=>{if(!(!n.info.doing||!y.value))try{const e=await n.getInferResult();if(e!==0){f(`od inference result API Error : ${e}`);return}}finally{setTimeout(I,40)}};return re(()=>y.value=!1),ie(async()=>{console.log("EFS POC Infer");let e=await n.checkInfo();if(e!==0){f(`check efs poc info fail : ${e}`);return}if(n.info.load?s.value=2:await C(),e=await p.loadCameraList(),e!==0&&f(`load camera list fail : ${e}`),p.cameraList.length===0?(l.cam_name="",s.value=0):n.info.cam_name!==""&&~p.cameraList.findIndex(t=>t.name===n.info.cam_name)?l.cam_name=n.info.cam_name:l.cam_name=p.cameraList[0].name,l.cam_name!==""&&await U(),n.info.doing){y.value=!0,await I();return}}),(e,t)=>(m(),$(V,null,[c("h4",null,S(e.$t("Dashboard.EFS")),1),r(a(ne)),c("div",he,[c("div",we,[r(a(se),{active:s.value,"finish-status":"success",class:"w3-margin-bottom",direction:a(J).lt.md?"horizontal":"vertical"},{default:i(()=>[r(a(R),{title:e.$t("App.CameraSetting"),onClick:t[0]||(t[0]=o=>ae()),class:"pointer"},{icon:i(()=>[r(L,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),r(a(R),{title:e.$t("ModelSet"),onClick:t[1]||(t[1]=o=>te()),class:"pointer"},{icon:i(()=>[r(L,{name:"fa-solid fa-gear",class:"w3-large"})]),_:1},8,["title"]),r(a(R),{title:e.$t("Inference"),onClick:t[2]||(t[2]=o=>z()),class:"pointer"},{icon:i(()=>[r(L,{name:"fa-solid fa-brain",class:"w3-large"})]),_:1},8,["title"])]),_:1},8,["active","direction"])]),q(c("div",{class:"camera-settings",ref_key:"contentRef",ref:F},[a(p).cameraList.length===0?(m(),d(a(Z),{key:0,type:"warning",title:e.$t("Hint.AddCameraFirst"),center:"","show-icon":"",closable:!1},null,8,["title"])):E("",!0),r(a(_),{label:e.$t("Button.Select",{name:e.$t("Label.Camera")})},{default:i(()=>[r(a(j),{modelValue:l.cam_name,"onUpdate:modelValue":t[3]||(t[3]=o=>l.cam_name=o),filterable:"","no-data-text":"No camera",placeholder:"No camera",onChange:t[4]||(t[4]=o=>U())},{default:i(()=>[(m(!0),$(V,null,K(a(p).cameraList,(o,g)=>(m(),d(a(Q),{label:`${o.name} (${o.cam_type==="cv"?o.src:o.cam_type})`,value:o.name,key:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),q(c("div",null,[v.value&&h.value&&w.value?(m(),d(ge,{key:0,img:v.value,width:h.value,height:w.value,"set-info":X,"single-label-name":"","single-image":""},null,8,["img","width","height"])):E("",!0)],512),[[H,l.cam_name!==""]])],512),[[H,s.value===0]]),s.value===1?(m(),d(a(k),{key:0},{default:i(()=>[b.value.length===0?(m(),d(a(k),{key:0,style:{height:"10vh"}},{default:i(()=>[r(a(Z),{title:e.$t("NoWeight"),type:"warning",closable:!1,"show-icon":"",style:{"--el-alert-title-font-size":"1em"}},null,8,["title"])]),_:1})):(m(),d(a(k),{key:1},{default:i(()=>[r(a(W),{ref_key:"ruleFormRef",ref:D,model:l,rules:T,"label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[r(a(_),{label:e.$t("ModelName")},{default:i(()=>[r(a(j),{modelValue:l.model_name,"onUpdate:modelValue":t[5]||(t[5]=o=>l.model_name=o)},{default:i(()=>[(m(!0),$(V,null,K(b.value,(o,g)=>(m(),d(a(Q),{label:o,value:o,key:g},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"]),r(a(_),null,{default:i(()=>[r(a(N),{type:"primary",onClick:t[6]||(t[6]=o=>M(D.value,!1))},{default:i(()=>[A(S(e.$t("ModelSet")),1)]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1}))]),_:1})):E("",!0),s.value===2?(m(),d(a(k),{key:1},{default:i(()=>[a(n).info.doing?(m(),$("div",$e,[r(a(N),{type:"danger",onClick:t[7]||(t[7]=o=>a(n).stopInfer())},{default:i(()=>[A(S(e.$t("Button.Stop",{name:e.$t("Inference")})),1)]),_:1}),c("div",Se,[c("div",Ee,[r(a(de),{data:a(n).inferResult},{default:i(()=>[r(a(x),{prop:"label",label:"Label","min-width":80}),r(a(x),{prop:"number",label:"Number","min-width":100})]),_:1},8,["data"])]),r(a(me),{src:a(n).imgURL,"preview-src-list":[a(n).imgURL],fit:"scale-down",style:{height:"100%","max-height":"800px","max-width":"1000px"}},null,8,["src","preview-src-list"])])])):(m(),d(a(W),{key:1,ref_key:"inferFormRef",ref:P,model:l,rules:T,"label-width":"100px","label-position":"left",class:"demo-ruleForm","status-icon":""},{default:i(()=>[r(a(_),{label:e.$t("Threshold")},{default:i(()=>[r(a(ue),{modelValue:l.threshold,"onUpdate:modelValue":t[8]||(t[8]=o=>l.threshold=o),min:.1,max:1,step:.01,style:{width:"600px"}},null,8,["modelValue"])]),_:1},8,["label"]),r(a(_),null,{default:i(()=>[r(a(N),{type:"primary",onClick:t[9]||(t[9]=o=>M(P.value,!0)),disabled:l.cam_name===""},{default:i(()=>[A(S(e.$t("Button.Start",{name:e.$t("Inference")})),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model","rules"]))]),_:1})):E("",!0)])],64))}});const La=be(ke,[["__scopeId","data-v-e4f146a3"]]);export{La as default};
