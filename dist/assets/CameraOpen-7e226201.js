import"./base-23d00206.js";/* empty css                */import{E as w,a as K}from"./el-form-item-62aac1b2.js";import{E as k}from"./el-input-51d05b2a.js";import{E as I,a as F}from"./el-select-99a9cb58.js";/* empty css               */import"./el-scrollbar-e3b486eb.js";import{a as E}from"./el-button-ded9ecc1.js";import{E as Q,a as N}from"./el-row-67417f48.js";import{E as X}from"./el-upload-5677c5b6.js";import"./el-progress-ed4e49af.js";import{o as S,i as D,f as _}from"./index-d07dfee2.js";import{u as Y}from"./stashSpace-391fdb88.js";import{b as U}from"./earthApi-baaacd65.js";import{y as Z,h as x,b as m,i as ee,F as ae,o as n,c,ag as r,bI as s,a7 as v,u as t,a8 as b,S as B,b0 as T,af as h,bf as f,a as A,aP as le,aN as q}from"./@vue-19632928.js";import{_ as oe}from"./json-editor-vue3-5344cb8d.js";const te={class:"w3-bar"},se={key:0},ne=["disabled"],re=["disabled"],ue=["disabled"],ie=Z({__name:"CameraOpen",props:{auto_close:{type:Boolean},need_name:{type:Boolean},isCapture:{type:Boolean},afterOpen:{type:Function},afterClose:{type:Function}},setup(R){x(()=>{V.fetchSpaceIsLocal()});const V=Y(),u=R,z=[{value:"webcam",label:"Webcam"},{value:"ipcam",label:"IP Camera"},{value:"file",label:"Video File"},{value:"pylon",label:"Basler"},{value:"tis",label:"TIS"},{value:"mvs",label:"MVS"}],o=m("webcam"),y=m(""),g=m(""),C=m(),d=m(!1),L=m([]),$=m(""),p=m(""),O=ee(()=>(u.need_name??!1)&&y.value===""||o.value==="ipcam"&&g.value===""||o.value==="file"&&C.value===void 0),H=async e=>{const l=e.target.files;console.log("上傳影片 = ",l),l&&l.length>0&&(C.value=l[0])},M=async()=>{const e=S(o.value==="tis"?D.global.t("Hint.CameraOpeningTIS"):D.global.t("Hint.CameraOpening"));try{const l={name:y.value,cam_type:o.value==="pylon"?"pylon":o.value==="tis"?"tis":o.value==="mvs"?"mvs":"cv"};o.value==="webcam"?l.src="0":o.value==="ipcam"?l.src=g.value:o.value==="file"&&(l.file=C.value),u.isCapture&&(l.is_capture=!0),(o.value==="pylon"||o.value==="tis"||o.value==="mvs")&&(l.feature_path=p.value,l.src=$.value);const a=await U.api.openCameraApiCameraOpenPost(l);if(!a)return;const i=a.data;if(console.log("result =>",i),i.code!==0){_("open camera error : "+i.code);return}d.value=!0,u.afterOpen&&await u.afterOpen(i.result.live_image)}finally{e.close()}},P=async()=>{const e=S();try{const l={name:y.value},a=await U.api.closeCameraApiCameraClosePost(l);if(!a){_("close camera api error: no response");return}const i=a.data;if(console.log("result =>",i),i.code!==0){_("close camera api error: "+i.code);return}d.value=!1,u.afterClose&&u.afterClose()}finally{e.close()}},G=async()=>{var l;L.value=[];const e=S();try{const a=await U.api.deviceListApiCameraDevicesGet({cam_type:o.value});if(a==null||a.data.code==null)return;if(((l=a==null?void 0:a.data)==null?void 0:l.code)!==0)throw new Error(`Code ${a.data.code}`);L.value=a.data.result.devices}catch(a){_(`${a}`)}finally{e.close()}},W=e=>{$.value="",p.value="",(e==="pylon"||e==="tis"||e==="mvs")&&G()},j=e=>{p.value=e.result.file},J=async()=>{const e=await V.selectLocalFile();e&&(p.value=e)};return ae(async()=>{u.auto_close&&(console.log("自動關閉鏡頭"),await P())}),(e,l)=>(n(),c(B,null,[r(t(K),{"label-position":"left","label-width":"100px"},{default:s(()=>[u.need_name??!1?(n(),v(t(w),{key:0,label:e.$t("Label.Name"),required:""},{default:s(()=>[r(t(k),{modelValue:y.value,"onUpdate:modelValue":l[0]||(l[0]=a=>y.value=a),placeholder:e.$t("Label.PleaseInput",{name:e.$t("Label.Name")}),disabled:d.value},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"])):b("",!0),r(t(w),{label:e.$t("Label.CameraType"),required:""},{default:s(()=>[r(t(I),{modelValue:o.value,"onUpdate:modelValue":l[1]||(l[1]=a=>o.value=a),disabled:d.value,onChange:W},{default:s(()=>[(n(),c(B,null,T(z,(a,i)=>r(t(F),{key:i,value:a.value,label:a.label},null,8,["value","label"])),64))]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),o.value==="pylon"||o.value==="tis"||o.value==="mvs"?(n(),v(t(w),{key:1,label:e.$t("CameraDevice")},{default:s(()=>[r(t(I),{modelValue:$.value,"onUpdate:modelValue":l[2]||(l[2]=a=>$.value=a),placeholder:e.$t("PleaseSelect"),style:{width:"100%"},clearable:""},{default:s(()=>[(n(!0),c(B,null,T(L.value,a=>(n(),v(t(F),{key:a.src,label:a.name,value:a.src},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"])):b("",!0),o.value==="pylon"||o.value==="tis"||o.value==="mvs"?(n(),v(t(w),{key:2,label:e.$t("CameraParameters")},{default:s(()=>[r(t(Q),{style:{width:"100%"}},{default:s(()=>[r(t(N),{span:12},{default:s(()=>[r(t(k),{modelValue:p.value,"onUpdate:modelValue":l[3]||(l[3]=a=>p.value=a),placeholder:e.$t("ParameterSettingPath"),disabled:""},null,8,["modelValue","placeholder"])]),_:1}),r(t(N),{span:12},{default:s(()=>[t(V).isLocal?(n(),v(t(E),{key:0,class:"ml-3",onClick:J},{default:s(()=>[h(f(e.$t("Upload")),1)]),_:1})):(n(),v(t(X),{key:1,class:"upload-file",action:"/api/upload_file_for_path","on-success":j,"show-file-list":!1,limit:1},{default:s(()=>[r(t(E),null,{default:s(()=>[h(f(e.$t("Upload")),1)]),_:1})]),_:1})),r(t(E),{class:"ml-3",onClick:l[4]||(l[4]=a=>p.value=""),link:""},{default:s(()=>[h(f(e.$t("Button.Empty")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["label"])):b("",!0),o.value==="ipcam"?(n(),v(t(w),{key:3,label:e.$t("Label.CameraURL"),required:""},{default:s(()=>[r(t(k),{modelValue:g.value,"onUpdate:modelValue":l[5]||(l[5]=a=>g.value=a),placeholder:e.$t("Label.PleaseInput",{name:e.$t("Label.CameraURL")}),disabled:d.value,clearable:""},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"])):b("",!0)]),_:1}),A("div",te,[o.value==="file"?(n(),c("label",{key:0,for:"upload-video",class:"w3-btn w3-mobile w3-round w3-border w3-border-theme",style:le({cursor:d.value?"not-allowed":"auto"})},[h(f(e.$t("Button.Upload",{name:e.$t("Label.Video")}))+" ",1),C.value?(n(),c("span",se," ("+f(C.value.name)+")",1)):b("",!0)],4)):b("",!0),A("input",{id:"upload-video",class:"w3-hide",type:"file",accept:"image/*,video/*",onChange:H,disabled:d.value},null,40,ne),d.value?(n(),c("button",{key:1,class:q(["w3-btn w3-mobile w3-round w3-red",u.need_name?"w3-right":""]),disabled:O.value,onClick:l[6]||(l[6]=a=>P())},f(e.$t("Button.Close",{name:e.$t("Label.Camera")})),11,re)):(n(),c("button",{key:2,class:q(["w3-btn w3-mobile w3-round w3-theme",u.need_name?"w3-right":""]),disabled:O.value,onClick:l[7]||(l[7]=a=>M())},f(e.$t("Button.Open",{name:e.$t("Label.Camera")})),11,ue))])],64))}});const ke=oe(ie,[["__scopeId","data-v-5e1bd177"]]);export{ke as C};
